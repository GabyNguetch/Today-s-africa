================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\login\page.tsx
================================================================================

"use client";

import React, { useState } from "react";
import Link from "next/link";
import { Eye, EyeOff, Globe, AlertCircle } from "lucide-react"; // Ajout AlertCircle
import { APP_CONFIG, LOGIN_TEXT } from "@/lib/constant";
import { Button } from "@/components/ui/Button";
import { Input } from "@/components/ui/Input";
import { cn } from "@/lib/utils";
import { authService } from "@/services/auth";
import { useRouter } from "next/navigation";
import { useAuth } from "@/context/AuthContext";

// Composant SVG Google (inchangé)
const GoogleIcon = () => (
  <svg className="w-5 h-5 mr-2" viewBox="0 0 24 24">
    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.26.81-.58z" />
    <path fill="#EA4335" d="M12 4.81c1.6 0 3.03.55 4.15 1.62l3.11-3.11C17.45 1.51 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
  </svg>
);

export default function LoginPage() {
  const [activeTab, setActiveTab] = useState<"login" | "register">("login");
  const router = useRouter();
    // On utilise le context
  const { login } = useAuth(); 
  
  // États formulaire
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  // Ajout champs pour inscription
  const [firstName, setFirstName] = useState(""); 
  const [lastName, setLastName] = useState("");

  const [showPassword, setShowPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [errorMessage, setErrorMessage] = useState<string | null>(null);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setErrorMessage(null);

    try {
        if (activeTab === 'login') {
            // ✅ Utilisation du Context Login (gère la redirection interne)
            await login(email, password); 
        } else {
            // Register reste dans le service direct car pas de maj du state User immediat
            await authService.register({
                email,
                motDePasse: password,
                prenom: firstName,
                nom: lastName
            });
            alert("Compte créé avec succès ! Connectez-vous maintenant.");
            setActiveTab("login");
        }
    } catch (err: any) {
        setErrorMessage(err.message || "Une erreur est survenue");
    } finally {
        setIsLoading(false);
    }
  };

  return (
    <div className="flex min-h-screen w-full font-sans bg-white dark:bg-[#0a0a0a]">
      {/* COLONNE GAUCHE (inchangée) */}
      <div className="hidden lg:flex w-[45%] flex-col justify-between px-16 py-12 relative bg-[#F9F9F7] dark:bg-zinc-900 dark:border-r dark:border-zinc-800">
        <div className="flex items-center gap-3 font-bold text-lg tracking-wider text-[#111] dark:text-gray-100">
           <Globe className="w-6 h-6 text-black dark:text-white" strokeWidth={2.5} /> 
           {APP_CONFIG.name}
        </div>
        <div className="flex flex-col gap-6 max-w-lg">
          <h1 className="text-5xl font-bold tracking-tight text-gray-900 dark:text-white leading-[1.15]">
            {LOGIN_TEXT.header.leftTitle}
          </h1>
          <p className="text-xl text-gray-500 dark:text-gray-400 font-normal leading-relaxed">
            {LOGIN_TEXT.header.leftSubtitle}
          </p>
        </div>
        <p className="text-sm text-gray-400 dark:text-gray-600 font-medium">
          {LOGIN_TEXT.header.footer}
        </p>
      </div>

      {/* COLONNE DROITE */}
      <div className="flex-1 flex flex-col justify-center items-center p-6 sm:p-12 lg:p-8 bg-white dark:bg-[#0a0a0a]">
        <div className="w-full max-w-[420px] flex flex-col gap-8">
          
          <div className="text-center space-y-2">
            <h2 className="text-3xl font-extrabold tracking-tight text-gray-900 dark:text-white">
              {activeTab === "login" ? LOGIN_TEXT.form.title : "Créer un compte lecteur"}
            </h2>
            <p className="text-gray-500 dark:text-gray-400 text-[15px]">
              {LOGIN_TEXT.form.subtitle}
            </p>
          </div>

          {/* Affichage des erreurs */}
          {errorMessage && (
            <div className="p-3 rounded-lg bg-red-50 text-red-600 text-sm flex items-center gap-2 border border-red-100 animate-in fade-in slide-in-from-top-1">
                <AlertCircle size={16} /> {errorMessage}
            </div>
          )}

          <div className="bg-[#F7F7F5] dark:bg-zinc-800 p-1.5 rounded-xl flex gap-1">
            <button
              onClick={() => { setActiveTab("login"); setErrorMessage(null); }}
              className={cn(
                "flex-1 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200",
                activeTab === "login"
                  ? "bg-[#3E7B52] text-white shadow-md"
                  : "bg-transparent text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"
              )}
            >
              Connexion
            </button>
            <button
              onClick={() => { setActiveTab("register"); setErrorMessage(null); }}
              className={cn(
                "flex-1 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200",
                activeTab === "register"
                  ? "bg-[#3E7B52] text-white shadow-md"
                  : "bg-transparent text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"
              )}
            >
              Inscription
            </button>
          </div>

          <form onSubmit={handleSubmit} className="flex flex-col gap-4">
            
            {activeTab === "register" && (
                <div className="flex gap-4 animate-in fade-in slide-in-from-top-2 duration-300">
                    <Input 
                        label="Prénom"
                        placeholder="John"
                        value={firstName}
                        onChange={(e) => setFirstName(e.target.value)}
                        required={activeTab === 'register'}
                        className="dark:bg-zinc-900 dark:border-zinc-800 dark:text-white"
                    />
                    <Input 
                        label="Nom"
                        placeholder="Doe"
                        value={lastName}
                        onChange={(e) => setLastName(e.target.value)}
                        required={activeTab === 'register'}
                        className="dark:bg-zinc-900 dark:border-zinc-800 dark:text-white"
                    />
                </div>
            )}

            <Input 
              label="Email"
              placeholder={LOGIN_TEXT.form.emailPlaceholder}
              type="email"
              required
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="dark:bg-zinc-900 dark:border-zinc-800 dark:text-white"
            />
            
            <div className="space-y-4">
              <Input
                label="Mot de passe"
                placeholder={LOGIN_TEXT.form.passwordPlaceholder}
                type={showPassword ? "text" : "password"}
                rightIcon={showPassword ? <EyeOff size={18} className="dark:text-gray-400" /> : <Eye size={18} className="dark:text-gray-400" />}
                onRightIconClick={() => setShowPassword(!showPassword)}
                required
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                 className="dark:bg-zinc-900 dark:border-zinc-800 dark:text-white"
              />

              {activeTab === "login" && (
                <div className="flex justify-end pt-1">
                  <Link href="#" className="text-xs font-semibold text-[#3E7B52] hover:underline">
                    {LOGIN_TEXT.form.forgotPassword}
                  </Link>
                </div>
              )}
            </div>

            <Button type="submit" disabled={isLoading} className="mt-4 text-[15px]">
              {isLoading ? "Traitement..." : (activeTab === "login" ? "Se connecter" : "S'inscrire")}
            </Button>
          </form>

           {/* Séparateur et Google */}
           <div className="relative">
            <div className="absolute inset-0 flex items-center">
              <span className="w-full border-t border-gray-100 dark:border-zinc-800" />
            </div>
            <div className="relative flex justify-center text-xs uppercase">
              <span className="bg-white dark:bg-[#0a0a0a] px-3 text-gray-400 font-medium tracking-wide">
                OU
              </span>
            </div>
          </div>
           <Button variant="outline" className="font-semibold text-gray-700 h-[50px] dark:bg-transparent dark:border-zinc-700 dark:text-gray-300">
            <GoogleIcon />
            {activeTab === 'login' ? 'Se connecter avec Google' : 'S\'inscrire avec Google'}
          </Button>

        </div>
      </div>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\category\[slug]\page.tsx
================================================================================

"use client";

import React, { use, useEffect, useState } from "react";
import Link from "next/link";
import { notFound } from "next/navigation";
import { RefreshCw, FolderOpen, ArrowLeft, Loader2, Sparkles, TrendingUp } from "lucide-react";
import Navbar from "@/components/layout/Navbar";
import Footer from "@/components/layout/Footer";
import ArticleCard from "@/components/ui/ArticleCard";
import { PublicService } from "@/services/public";
import { ArticleReadDto, Rubrique } from "@/types/article";

interface PageProps {
  params: Promise<{ slug: string }>;
}

// --- SQUELETTE DE CHARGEMENT MODERNISÉ ---
const CategorySkeleton = () => (
    <div className="group relative flex flex-col h-full bg-gradient-to-br from-white to-gray-50 dark:from-zinc-900 dark:to-zinc-900/50 border border-gray-200 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm hover:shadow-lg transition-all duration-500">
        {/* Effet de brillance animé */}
        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full animate-[shimmer_2s_infinite]"></div>
        
        <div className="p-5 space-y-4">
            {/* Image Fake avec effet pulse */}
            <div className="relative h-48 w-full bg-gradient-to-br from-gray-200 to-gray-300 dark:from-zinc-800 dark:to-zinc-700 rounded-xl overflow-hidden">
                <div className="absolute inset-0 bg-gradient-to-t from-gray-300/50 to-transparent dark:from-zinc-900/50"></div>
            </div>
            
            {/* Contenu Fake */}
            <div className="space-y-3">
                <div className="h-3 w-1/4 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-zinc-800 dark:to-zinc-700 rounded-full"></div>
                <div className="h-6 w-full bg-gradient-to-r from-gray-200 to-gray-300 dark:from-zinc-800 dark:to-zinc-700 rounded-lg"></div>
                <div className="h-6 w-2/3 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-zinc-800 dark:to-zinc-700 rounded-lg"></div>
            </div>
            
            {/* Footer Card Fake */}
            <div className="pt-3 border-t border-gray-200 dark:border-zinc-800 mt-auto">
                <div className="h-3 w-1/3 bg-gradient-to-r from-gray-100 to-gray-200 dark:from-zinc-800 dark:to-zinc-700 rounded-full"></div>
            </div>
        </div>
    </div>
);

export default function CategoryPage({ params }: PageProps) {
  const { slug } = use(params);

  // États
  const [currentRubrique, setCurrentRubrique] = useState<Rubrique | null>(null);
  const [articles, setArticles] = useState<ArticleReadDto[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchData = async () => {
        console.group(`🔍 [CATEGORY PAGE] Recherche Rubrique : "${slug}"`);
        setLoading(true);

        try {
            const allRubriques = await PublicService.getRubriques();
            console.log("📥 Rubriques reçues du backend :", allRubriques);

            const decodedSlug = decodeURIComponent(slug).toLowerCase().trim();

            const matched = allRubriques.find(r => {
                const rId = String(r.id);
                const rSlug = r.slug?.toLowerCase() || ""; 
                const rNom = r.nom?.toLowerCase() || "";

                return (
                    rId === decodedSlug || 
                    rSlug === decodedSlug || 
                    rNom === decodedSlug
                );
            });

            if (!matched) {
                console.warn("⚠️ Aucune rubrique trouvée pour ce slug/id.");
                console.log("Liste dispo:", allRubriques.map(r => `${r.id} - ${r.nom}`));
                setLoading(false);
                return;
            }

            console.log("✅ Rubrique identifiée :", matched.nom, `(ID: ${matched.id})`);
            setCurrentRubrique(matched);

            console.log(`📡 Fetching articles pour ID: ${matched.id}`);
            const arts = await PublicService.getArticlesByRubrique(matched.id);
            console.log(`📦 ${arts.length} Articles reçus`);
            
            setArticles(arts);

        } catch(error) {
            console.error("❌ CRASH Fetch :", error);
        } finally {
            setLoading(false);
            console.groupEnd();
        }
    };

    fetchData();
  }, [slug]);

  if (!loading && !currentRubrique) {
      return notFound();
  }

  return (
    <div className="min-h-screen bg-[#FBFBFB] dark:bg-black font-sans selection:bg-[#3E7B52] selection:text-white flex flex-col">
      <Navbar />

      <main className="max-w-[1400px] mx-auto w-full px-6 md:px-12 py-12 flex-1">
        
        {/* --- 1. HEADER MODERNISÉ --- */}
        <div className="mb-16 relative">
            {/* Effet de fond décoratif */}
            <div className="absolute -top-8 -left-8 w-72 h-72 bg-[#3E7B52]/5 dark:bg-[#13EC13]/5 rounded-full blur-3xl animate-pulse"></div>
            <div className="absolute -bottom-8 -right-8 w-96 h-96 bg-[#3E7B52]/3 dark:bg-[#13EC13]/3 rounded-full blur-3xl animate-pulse delay-1000"></div>
            
            <div className="relative bg-gradient-to-br from-white to-gray-50/50 dark:from-zinc-900 dark:to-zinc-900/50 border border-gray-200 dark:border-zinc-800 rounded-3xl p-8 md:p-12 shadow-lg backdrop-blur-sm">
                {loading ? (
                    // SQUELETTE DU HEADER
                    <div className="space-y-6 animate-pulse">
                        <div className="h-4 w-40 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-zinc-800 dark:to-zinc-700 rounded-full"></div>
                        <div className="h-16 w-3/4 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-zinc-800 dark:to-zinc-700 rounded-2xl"></div>
                        <div className="h-6 w-full max-w-2xl bg-gradient-to-r from-gray-200 to-gray-300 dark:from-zinc-800 dark:to-zinc-700 rounded-xl"></div>
                    </div>
                ) : (
                    <div className="space-y-6">
                        {/* FIL D'ARIANE MODERNISÉ */}
                        <div className="flex items-center gap-3 text-[10px] font-bold uppercase tracking-[0.2em]">
                            <div className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#3E7B52]/10 to-[#3E7B52]/5 dark:from-[#13EC13]/10 dark:to-[#13EC13]/5 rounded-full border border-[#3E7B52]/20 dark:border-[#13EC13]/20">
                                <FolderOpen size={14} className="text-[#3E7B52] dark:text-[#13EC13]"/>
                                <span className="text-[#3E7B52] dark:text-[#13EC13]">Rubrique</span>
                            </div>
                            <div className="w-2 h-2 rounded-full bg-gray-300 dark:bg-zinc-700"></div>
                            <span className="text-gray-600 dark:text-zinc-400">{currentRubrique?.nom}</span>
                        </div>

                        {/* TITRE AVEC EFFET */}
                        <div className="space-y-4">
                            <h1 className="text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-[#111] to-[#3E7B52] dark:from-white dark:to-[#13EC13] tracking-tight uppercase leading-[0.95] animate-in fade-in slide-in-from-bottom-4 duration-700">
                                {currentRubrique?.nom}
                            </h1>
                            
                            {/* Badge compteur d'articles */}
                            <div className="flex items-center gap-3">
                                <div className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#3E7B52] to-[#2d5f3e] dark:from-[#13EC13] dark:to-[#0fc910] rounded-full shadow-lg shadow-[#3E7B52]/20 dark:shadow-[#13EC13]/20">
                                    <TrendingUp size={14} className="text-white animate-bounce"/>
                                    <span className="text-white text-xs font-bold">{articles.length} Articles</span>
                                </div>
                                <Sparkles size={20} className="text-[#3E7B52] dark:text-[#13EC13] animate-pulse"/>
                            </div>
                        </div>
                        
                        {/* DESCRIPTION */}
                        <p className="text-gray-600 dark:text-zinc-400 text-lg max-w-3xl leading-relaxed animate-in fade-in slide-in-from-bottom-3 duration-700 delay-100">
                            {`Toute l'actualité et les dossiers spéciaux concernant la rubrique ${currentRubrique?.nom}.`}
                        </p>
                    </div>
                )}
            </div>
        </div>

        {/* --- 2. CONTENU DES ARTICLES MODERNISÉ --- */}
        {loading ? (
            // GRILLE SQUELETTES
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {[1,2,3,4,5,6].map(i => (
                    <div key={i} className="animate-in fade-in duration-500" style={{animationDelay: `${i * 100}ms`}}>
                        <CategorySkeleton />
                    </div>
                ))}
            </div>
        ) : (
            // CONTENU RÉEL OU MESSAGE VIDE
            articles.length > 0 ? (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {articles.map((article, index) => (
                        <div 
                            key={article.id} 
                            className="animate-in fade-in slide-in-from-bottom-4 duration-700"
                            style={{animationDelay: `${index * 100}ms`}}
                        >
                            <ArticleCard article={article} />
                        </div>
                    ))}
                </div>
            ) : (
                <div className="relative animate-in fade-in zoom-in-95 duration-700">
                    {/* Effet de fond pour l'état vide */}
                    <div className="absolute inset-0 bg-gradient-to-br from-gray-100 to-transparent dark:from-zinc-900/50 dark:to-transparent rounded-3xl blur-2xl"></div>
                    
                    <div className="relative flex flex-col items-center justify-center py-32 bg-gradient-to-br from-white via-gray-50 to-white dark:from-zinc-900 dark:via-zinc-900/80 dark:to-zinc-900 border-2 border-dashed border-gray-300 dark:border-zinc-800 rounded-3xl text-center px-6 overflow-hidden">
                        {/* Décoration d'arrière-plan */}
                        <div className="absolute top-0 left-1/4 w-64 h-64 bg-[#3E7B52]/5 dark:bg-[#13EC13]/5 rounded-full blur-3xl animate-pulse"></div>
                        <div className="absolute bottom-0 right-1/4 w-80 h-80 bg-[#3E7B52]/3 dark:bg-[#13EC13]/3 rounded-full blur-3xl animate-pulse delay-1000"></div>
                        
                        {/* Contenu */}
                        <div className="relative z-10 space-y-6">
                            <div className="relative inline-block">
                                <div className="absolute inset-0 bg-gradient-to-br from-[#3E7B52]/20 to-[#3E7B52]/5 dark:from-[#13EC13]/20 dark:to-[#13EC13]/5 rounded-3xl blur-xl animate-pulse"></div>
                                <div className="relative bg-gradient-to-br from-gray-100 to-gray-200 dark:from-zinc-800 dark:to-zinc-700 p-6 rounded-3xl shadow-xl">
                                    <RefreshCw size={48} className="text-gray-400 dark:text-gray-500 animate-spin" style={{animationDuration: '3s'}}/>
                                </div>
                            </div>
                            
                            <div className="space-y-3">
                                <h3 className="text-2xl font-black text-gray-900 dark:text-white uppercase tracking-tight">
                                    Aucun article pour le moment
                                </h3>
                                <p className="text-gray-500 dark:text-zinc-400 text-base max-w-md mx-auto leading-relaxed">
                                    La rédaction n'a pas encore publié d'article dans la rubrique <span className="font-bold text-[#3E7B52] dark:text-[#13EC13]">{currentRubrique?.nom}</span>.
                                </p>
                            </div>
                            
                            <Link 
                                href="/" 
                                className="group inline-flex items-center gap-3 text-sm font-bold text-white bg-gradient-to-r from-[#3E7B52] to-[#2d5f3e] dark:from-[#13EC13] dark:to-[#0fc910] px-8 py-4 rounded-xl shadow-lg shadow-[#3E7B52]/30 dark:shadow-[#13EC13]/30 hover:shadow-xl hover:shadow-[#3E7B52]/40 dark:hover:shadow-[#13EC13]/40 hover:scale-105 transition-all duration-300"
                            >
                                <ArrowLeft size={18} className="group-hover:-translate-x-1 transition-transform duration-300"/>
                                <span>Retour à l'accueil</span>
                            </Link>
                        </div>
                    </div>
                </div>
            )
        )}
      </main>
      <Footer />

      <style jsx global>{`
        @keyframes shimmer {
          100% {
            transform: translateX(100%);
          }
        }
      `}</style>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\dashboard\page.tsx
================================================================================

"use client";

import React, { useEffect, useState } from "react";
import { useRouter } from "next/navigation";
import { 
  LayoutDashboard, PenSquare, FileText, Settings as SettingsIcon, 
  LogOut, Users, UserPlus, Globe,
  House
} from "lucide-react";
import { authService, User } from "@/services/auth";
import { APP_CONFIG } from "@/lib/constant";
import { cn } from "@/lib/utils";
import { useAuth } from "@/context/AuthContext";

// Composants (Restent identiques)
import Overview from "@/components/dashboard/Overview";
import NewArticle from "@/components/dashboard/NewArticle";
import MyArticles from "@/components/dashboard/MyArticles"; 
import AdminArticles from "@/components/dashboard/AdminArticles"; 
import Settings from "@/components/dashboard/Settings";
import CreateRedacteur from "@/components/dashboard/CreateRedacteur";
import AdminRedacteurs from "@/components/dashboard/AdminRedacteur";
import { OnboardingTour } from "@/components/ui/OnBoardingTour";
import Link from "next/link";

type TabType = "overview" | "new-article" | "articles" | "manage-redacteurs" | "create-redacteur" | "settings";

export default function DashboardPage() {
  const router = useRouter();
  const [activeTab, setActiveTab] = useState<TabType>("overview");
  const { user, isAuthenticated, isLoading } = useAuth();
  
  // Gestion d'État Edition
  const [editingId, setEditingId] = useState<number | null>(null);

 // Protection Route
  useEffect(() => {
    // Si chargement fini et pas authentifié -> Login
    if (!isLoading && !isAuthenticated) {
      console.log("⛔ [Dashboard] Accès refusé -> Redirection Login");
      router.push("/login");
    }
  }, [isLoading, isAuthenticated, router]);

  // Loader d'attente (évite d'afficher "Access Denied" pdt le check du localStorage)
  if (isLoading) {
      return <div className="flex h-screen items-center justify-center dark:bg-black"><span className="text-[#3E7B52] font-bold">Chargement session...</span></div>;
  }


  const isAdmin = user?.role === 'SUPER_ADMIN' || user?.role === 'ADMIN';

  // --- HANDLERS CLÉS POUR L'ÉDITION ---
  const handleEditRequest = (id: number) => {
      console.log(`✏️ Opening Editor for ID: ${id}`);
      setEditingId(id);
      setActiveTab("new-article");
  };

  const handleEditorClose = () => {
      // Retour à la liste après sauvegarde ou annulation
      setEditingId(null);
      // Redirection selon le rôle
      setActiveTab("articles"); 
  };

  const renderContent = () => {
    switch (activeTab) {
        case "overview": return <Overview />;
        case "new-article": return <NewArticle editArticleId={editingId} onSuccess={handleEditorClose} onCancel={handleEditorClose}/>;
        case "articles": return isAdmin ? <AdminArticles /> : <MyArticles onEdit={handleEditRequest} />;
        case "manage-redacteurs": return <AdminRedacteurs />;
        case "create-redacteur": return <CreateRedacteur />; // Fallback si modal pas utilisé directement
        case "settings": return <Settings />;
        default: return <Overview />;
    }
  };

  // --- MENU CONFIG ---
  const getMenuItems = () => {
      const base = [
          { id: "overview", label: "Vue d'ensemble", icon: LayoutDashboard },
          { id: "new-article", label: "Rédiger", icon: PenSquare },
      ];
      
      const adminItems = [
          { id: "articles", label: "Articles", icon: FileText },
          { id: "manage-redacteurs", label: "Équipe", icon: Users },
      ];
      
      const redacteurItems = [
          { id: "articles", label: "Mes Articles", icon: FileText },
      ];

      const footerItems = [
          { id: "settings", label: "Paramètres", icon: SettingsIcon }
      ];

      return [ ...base, ...(isAdmin ? adminItems : redacteurItems), ...footerItems ];
  };

  const menuItems = getMenuItems();

  if (!user) return null; // ou Loading...

  return (
    <div className="flex h-screen bg-[#FBFBFB] dark:bg-black font-sans overflow-hidden">
      
      {/* ============================================================ */}
      {/* 1. SIDEBAR DESKTOP (lg:flex)                                 */}
      {/* ============================================================ */}
      <aside className="w-64 bg-white dark:bg-zinc-900 border-r border-gray-100 shadow-sm dark:border-zinc-800 flex-col hidden lg:flex shrink-0">
        
        {/* LOGO */}
        <div className="h-16 flex items-center px-6 border-b border-gray-100 dark:border-zinc-800">
            <span className="font-extrabold uppercase tracking-wider text-lg flex items-center gap-2 text-gray-900 dark:text-white">
               <Globe className="bg-[#3E7B52] text-white w-8 h-8 p-1.5 rounded-lg shadow-sm shadow-green-900/20"/> 
               {APP_CONFIG.name}
            </span>
        </div>

        {/* NAVIGATION LINKS */}
        <div className="flex-1 py-6 space-y-1 px-3 overflow-y-auto">
            {menuItems.map((item) => (
                <button
                    key={item.id}
                    id={item.id === "new-article" ? "nav-dashboard-new-article" 
                        : item.id === "articles" ? "nav-dashboard-articles" 
                        : item.id === "manage-redacteurs" ? "nav-dashboard-users" : undefined}
                    onClick={() => { setActiveTab(item.id as TabType); setEditingId(null); }}
                    className={cn(
                        "w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all group relative",
                        activeTab === item.id 
                            ? "bg-[#3E7B52]/10 text-[#3E7B52] dark:bg-[#13EC13]/10 dark:text-[#13EC13] shadow-sm" 
                            : "text-gray-500 hover:bg-gray-100 dark:hover:bg-zinc-800/50 dark:text-zinc-400"
                    )}
                >
                    {/* Indicateur Actif Vertical */}
                    {activeTab === item.id && (
                        <span className="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-[#3E7B52] dark:bg-[#13EC13] rounded-r-full"/>
                    )}
                    <item.icon size={18} className={activeTab === item.id ? "text-[#3E7B52] dark:text-[#13EC13]" : "text-gray-400 group-hover:text-gray-600 dark:group-hover:text-zinc-300 transition-colors"}/> 
                    {item.label}
                </button>
            ))}
        </div>
        
        {/* USER PROFILE CARD */}
        <div className="p-4 mt-auto">
             <div className="p-3 bg-gray-50 dark:bg-zinc-950/50 border border-gray-100 dark:border-zinc-800 rounded-xl mb-2 flex items-center gap-3 shadow-sm">
                <div className="w-9 h-9 rounded-full bg-gradient-to-tr from-[#3E7B52] to-green-400 flex items-center justify-center text-white font-black shadow-md text-xs">
                    {user.nom?.substring(0, 2).toUpperCase()}
                </div>
                <div className="overflow-hidden">
                    <p className="text-xs font-bold text-gray-900 dark:text-white truncate max-w-[120px]">{user.prenom}</p>
                    <p className="text-[10px] text-gray-400 font-medium uppercase tracking-wider">{user.role}</p>
                </div>
            </div>

            <Link href="/" >
                <button 
                    className="w-full pl-2 flex items-center justify gap-2 text-[10px] font-bold uppercase text-zinc-500 hover:text-zinc-600 hover:bg-zinc-50 dark:hover:bg-zinc-900/10 py-2.5 rounded-lg transition-colors border border-transparent hover:border-zinc-100"
                >
                    <House size={14}/> Retour à l'accueil
                </button>
            </Link>

            <button 
                onClick={() => authService.logout()} 
                className="w-full flex pl-2 items-center justify gap-2 text-[10px] font-bold uppercase text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/10 py-2.5 rounded-lg transition-colors border border-transparent hover:border-red-100"
            >
                <LogOut size={14}/> Déconnexion
            </button>
        </div>
      </aside>


      {/* ============================================================ */}
      {/* 2. BOTTOM NAVIGATION MOBILE (visible only small screens)     */}
      {/* ============================================================ */}
      <nav className="fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-zinc-900 border-t border-gray-200 dark:border-zinc-800 flex lg:hidden items-center justify-around h-16 pb-safe safe-area-inset-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        
        {/* On limite à 4-5 items max pour mobile, sinon ça déborde */}
        {menuItems.slice(0, 5).map((item) => (
            <button
                key={item.id}
                onClick={() => { setActiveTab(item.id as TabType); setEditingId(null); }}
                className={cn(
                    "flex flex-col items-center justify-center gap-1 w-full h-full relative transition-colors",
                    activeTab === item.id 
                        ? "text-[#3E7B52] dark:text-[#13EC13]" 
                        : "text-gray-400 hover:text-gray-600 dark:hover:text-zinc-300"
                )}
            >
                {activeTab === item.id && (
                     <span className="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-1 bg-[#3E7B52] dark:bg-[#13EC13] rounded-b-full shadow-[0_2px_8px_rgba(62,123,82,0.4)]"/>
                )}
                <item.icon size={22} strokeWidth={activeTab === item.id ? 2.5 : 2} className="mt-1"/>
                <span className="text-[9px] font-bold uppercase tracking-tight truncate max-w-[60px]">{item.label}</span>
            </button>
        ))}
        
        {/* Bouton More / Menu si besoin (Optionnel) */}
      </nav>


      {/* ============================================================ */}
      {/* 3. MAIN CONTENT AREA (Padding bas pour la bottom nav)        */}
      {/* ============================================================ */}
      <div className="flex-1 flex flex-col overflow-hidden relative">
         {/* HEADER MOBILE (LOGO + LOGOUT) */}
         <header className="lg:hidden h-14 bg-white dark:bg-zinc-900 border-b border-gray-100 dark:border-zinc-800 flex items-center justify-between px-4 shrink-0">
             <div className="flex items-center gap-2 font-black text-gray-900 dark:text-white uppercase tracking-wider text-sm">
                <Globe className="text-[#3E7B52] w-5 h-5"/> {APP_CONFIG.name}
             </div>
             <button onClick={() => authService.logout()} className="p-2 text-gray-400 hover:text-red-500">
                <LogOut size={18}/>
             </button>
         </header>

         {/* Contenu Scrollable (pb-20 important pour ne pas cacher sous la navbar mobile) */}
         <main className="flex-1 overflow-auto p-4 md:p-8 scroll-smooth pb-24 lg:pb-8 bg-[#FBFBFB] dark:bg-black">
            <div className="max-w-7xl mx-auto h-full">
                {renderContent()}
            </div>
         </main>
         <OnboardingTour />
      </div>

    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\article\[id]\page.tsx
================================================================================

"use client";

import React, { useEffect, useState, use, useRef } from "react";
import Image from "next/image";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { ArticleReadDto } from "@/types/article";
import { PublicService } from "@/services/public";
import { useAuth } from "@/context/AuthContext";
import { 
  Share2, Heart, Copy, Facebook, Twitter, CheckCircle
} from "lucide-react";
import { format, isValid } from "date-fns";
import { fr } from "date-fns/locale";
import { cn, getImageUrl } from "@/lib/utils";
import Navbar from "@/components/layout/Navbar";
import Footer from "@/components/layout/Footer";
import { Button } from "@/components/ui/Button";
import CommentSystem from "@/components/article/CommentSystem";
import SimilarArticles from "@/components/article/SimilarArticles";

// ==========================================
// UTILITIES
// ==========================================
const compactNumber = (num?: number) => {
  if (num === undefined || num === null) return "0";
  return new Intl.NumberFormat("en-US", {
    notation: "compact",
    maximumFractionDigits: 1,
  }).format(num);
};

const formatDate = (dateStr?: string) => {
  if (!dateStr) return "";
  const d = new Date(dateStr);
  return isValid(d) ? format(d, "d MMMM yyyy", { locale: fr }) : "";
};

// ==========================================
// SKELETON COMPONENT
// ==========================================
const ArticleSkeleton = () => (
  <div className="bg-[#FDFDFD] dark:bg-black min-h-screen animate-pulse">
    <Navbar /> 
    <div className="max-w-[1100px] mx-auto w-full px-6 md:px-12 py-12">
      <div className="border-b border-gray-100 dark:border-zinc-800 pb-10 mb-12">
        <div className="h-6 w-32 bg-gray-200 dark:bg-zinc-800 rounded-full mb-8"></div>
        <div className="space-y-4 mb-8">
          <div className="h-12 w-[90%] bg-gray-300 dark:bg-zinc-800 rounded-lg"></div>
          <div className="h-12 w-[70%] bg-gray-300 dark:bg-zinc-800 rounded-lg"></div>
        </div>
        <div className="h-4 w-[85%] bg-gray-100 dark:bg-zinc-900 rounded"></div>
      </div>
      <div className="grid grid-cols-1 lg:grid-cols-12 gap-12">
        <div className="lg:col-span-8">
          <div className="w-full aspect-[16/10] bg-gray-200 dark:bg-zinc-800 rounded-xl mb-12"></div>
          <div className="space-y-6">
            {[1, 2, 3].map(i => <div key={i} className="h-4 w-full bg-gray-100 dark:bg-zinc-900 rounded"></div>)}
          </div>
        </div>
        <aside className="lg:col-span-4 h-64 bg-gray-50 dark:bg-zinc-900 rounded-xl"></aside>
      </div>
    </div>
  </div>
);

// ==========================================
// CONTENT BLOCK RENDERER
// ==========================================
function ContentBlock({ bloc }: { bloc: any }) {
  switch(bloc.type) {
    case 'IMAGE': 
      return (
        <figure className="my-10 w-full group">
          <div className="relative w-full aspect-[16/9] md:aspect-[2/1] rounded-lg overflow-hidden shadow-md bg-gray-100 dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800">
            <Image src={getImageUrl(bloc.url || bloc.contenu)} alt={bloc.altText || "Illustration"} fill className="object-cover" unoptimized/>
          </div>
          {bloc.legende && <figcaption className="mt-3 text-xs text-gray-500 dark:text-zinc-500 font-mono tracking-wide text-center">▲ {bloc.legende}</figcaption>}
        </figure>
      );
    case 'CITATION':
      return (
        <div className="my-10 pl-6 border-l-4 border-[#3E7B52] py-2">
          <blockquote className="font-serif text-2xl text-gray-800 dark:text-white italic leading-relaxed">
            "{bloc.contenu}"
          </blockquote>
        </div>
      );
    case 'VIDEO':
      return (
        <div className="my-10 w-full aspect-video bg-black rounded-lg overflow-hidden">
          <iframe src={bloc.url || bloc.contenu} className="w-full h-full border-0" allowFullScreen></iframe>
        </div>
      );
    case 'TEXTE':
    default:
      return <div dangerouslySetInnerHTML={{__html: bloc.contenu}} />;
  }
}

// ==========================================
// SHARE MENU COMPONENT
// ==========================================
function ShareMenu({ 
  article, 
  showShare, 
  onClose, 
  onCopy 
}: { 
  article: ArticleReadDto;
  showShare: boolean;
  onClose: () => void;
  onCopy: () => void;
}) {
  if (!showShare) return null;

  return (
    <div className="absolute right-0 top-full mt-2 w-48 bg-white dark:bg-zinc-900 shadow-xl border border-gray-100 dark:border-zinc-800 rounded-xl p-1 z-30 flex flex-col gap-1 animate-in fade-in zoom-in-95 origin-top-right">
      <button onClick={onCopy} className="flex items-center gap-3 w-full px-3 py-2 hover:bg-gray-50 dark:hover:bg-zinc-800 rounded-lg text-xs font-bold transition-colors">
        <Copy size={14} /> Copier le lien
      </button>
      <div className="h-px bg-gray-100 dark:bg-zinc-800 my-1"/>
      <a 
        href={`https://twitter.com/intent/tweet?text=${article.titre}&url=${typeof window !== 'undefined' ? window.location.href : ''}`} 
        target="_blank" 
        className="flex items-center gap-3 w-full px-3 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-500 rounded-lg text-xs font-medium transition-colors"
      >
        <Twitter size={14}/> Twitter
      </a>
      <a 
        href={`https://www.facebook.com/sharer/sharer.php?u=${typeof window !== 'undefined' ? window.location.href : ''}`} 
        target="_blank" 
        className="flex items-center gap-3 w-full px-3 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-700 rounded-lg text-xs font-medium transition-colors"
      >
        <Facebook size={14}/> Facebook
      </a>
    </div>
  );
}

// ==========================================
// ARTICLE HEADER COMPONENT
// ==========================================
function ArticleHeader({ 
  article, 
  isLiked, 
  onToggleLike,
  showShare,
  onToggleShare 
}: {
  article: ArticleReadDto;
  isLiked: boolean;
  onToggleLike: () => void;
  showShare: boolean;
  onToggleShare: () => void;
}) {
  return (
    <header className="mb-12 border-b border-gray-200 dark:border-zinc-800 pb-10">
      {/* Meta Info & Actions */}
      <div className="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-6">
        <div className="flex items-center gap-3">
          <span className="text-[11px] font-black uppercase tracking-[0.2em] text-[#3E7B52] dark:text-[#13EC13] px-3 py-1 bg-[#3E7B52]/5 rounded-md border border-[#3E7B52]/10">
            {article.rubriqueNom || "Actualité"}
          </span>
          <span className="h-1 w-1 bg-gray-300 rounded-full"></span>
          <span className="text-gray-400 dark:text-zinc-500 text-xs font-mono">
            {formatDate(article.datePublication)}
          </span>
        </div>
        
        <div className="flex items-center gap-3">
          <button 
            onClick={onToggleLike} 
            className={cn("p-2.5 rounded-full border transition-all duration-300 active:scale-95 group", 
              isLiked ? "bg-red-50 border-red-200 text-red-500 shadow-inner" : "border-gray-100 hover:border-red-200 hover:bg-red-50 text-gray-400 hover:text-red-500 bg-white dark:bg-zinc-900 dark:border-zinc-800"
            )}
            title="Favori"
          >
            <Heart size={20} className={cn("transition-transform", isLiked && "fill-current scale-110")} />
          </button>

          <div className="relative">
            <button 
              onClick={onToggleShare} 
              className="p-2.5 rounded-full border border-gray-100 hover:border-gray-300 hover:bg-gray-50 text-gray-500 hover:text-black dark:border-zinc-800 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:text-white transition-all active:scale-95"
            >
              <Share2 size={20} />
            </button>
          </div>
        </div>
      </div>

      {/* Title & Description */}
      <h1 className="text-4xl md:text-5xl lg:text-[4rem] font-[900] text-gray-900 dark:text-white leading-[1.05] tracking-tight mb-8">
        {article.titre}
      </h1>

      <p className="text-xl md:text-2xl text-gray-600 dark:text-zinc-300 leading-relaxed font-serif font-light max-w-4xl border-l-[3px] border-[#3E7B52] pl-6 md:pl-8 py-2">
        {article.description}
      </p>

      {/* Author Info */}
      <div className="mt-8 flex items-center gap-4">
        <div className="w-12 h-12 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-zinc-800 dark:to-zinc-700 rounded-full flex items-center justify-center font-bold text-lg text-gray-500 overflow-hidden ring-2 ring-white dark:ring-black">
          {article.auteurNom ? article.auteurNom.substring(0,1).toUpperCase() : "R"}
        </div>
        <div className="flex flex-col">
          <span className="text-sm font-bold text-gray-900 dark:text-white flex items-center gap-2">
            {article.auteurNom || "La Rédaction"} 
            {article.region && <span className="px-2 py-0.5 rounded-full bg-gray-100 dark:bg-zinc-800 text-[10px] font-medium text-gray-500 uppercase tracking-wide border border-gray-200 dark:border-zinc-700">Bureau {article.region}</span>}
          </span>
          <span className="text-xs text-gray-400 mt-0.5">Journaliste TODAY'S AFRICA</span>
        </div>
      </div>
    </header>
  );
}

// ==========================================
// SIDEBAR STATS COMPONENT
// ==========================================
function SidebarStats({ 
  views, 
  likes 
}: { 
  views?: number;
  likes: number;
}) {
  return (
    <div className="flex gap-4 items-center justify-between px-6 py-4 bg-white dark:bg-zinc-900/50 rounded-2xl border border-gray-100 dark:border-zinc-800 shadow-[0_2px_10px_rgba(0,0,0,0.02)]">
      <div className="text-center">
        <span className="block font-black text-2xl text-gray-900 dark:text-white">{compactNumber(views)}</span>
        <span className="text-[10px] uppercase text-gray-400 font-extrabold tracking-wider">Lectures</span>
      </div>
      <div className="h-8 w-px bg-gray-200 dark:bg-zinc-700"></div>
      <div className="text-center">
        <span className="block font-black text-2xl text-[#3E7B52] dark:text-[#13EC13] transition-all">{compactNumber(likes)}</span>
        <span className="text-[10px] uppercase text-gray-400 font-extrabold tracking-wider">Favoris</span>
      </div>
    </div>
  );
}

// ==========================================
// MAIN PAGE COMPONENT
// ==========================================
interface PageProps {
  params: Promise<{ id: string }>;
}

export default function ArticlePage({ params }: PageProps) {
  const { id } = use(params);
  const articleId = parseInt(id);
  const router = useRouter();
  const { user } = useAuth();

  // --- STATE ---
  const [article, setArticle] = useState<ArticleReadDto | null>(null);
  const [loading, setLoading] = useState(true);
  const [notFound, setNotFound] = useState(false);
  const [isLiked, setIsLiked] = useState(false);
  const [likesCount, setLikesCount] = useState(0);
  const [showShare, setShowShare] = useState(false);

  // --- TRACKING REFS ---
  const startTime = useRef(Date.now());
  const maxScroll = useRef(0);

  // --- DATA LOADING ---
  useEffect(() => {
    if (isNaN(articleId)) {
      setNotFound(true);
      setLoading(false);
      return;
    }

    const initPage = async () => {
      setLoading(true);
      try {
        const [fetchedArticle, fetchedLikeStatus] = await Promise.all([
          PublicService.getById(articleId),
          user ? PublicService.checkIfLiked(articleId) : Promise.resolve(false)
        ]);

        if (!fetchedArticle) {
          setNotFound(true);
        } else {
          setArticle(fetchedArticle);
          setIsLiked(fetchedLikeStatus);
          setLikesCount(fetchedArticle.partages || 0);
        }
      } catch (err) {
        console.error(err);
        setNotFound(true);
      } finally {
        setLoading(false);
      }
    };

    initPage();
  }, [articleId, user]);

  // --- ANALYTICS TRACKING ---
  useEffect(() => {
    const handleScroll = () => {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const percentage = Math.round((scrollTop / docHeight) * 100);
      if (percentage > maxScroll.current) maxScroll.current = percentage;
    };

    window.addEventListener("scroll", handleScroll);

    return () => {
      window.removeEventListener("scroll", handleScroll);
      
      if (articleId && !loading && !notFound) {
        const durationSeconds = Math.round((Date.now() - startTime.current) / 1000);
        const finalScroll = Math.min(100, Math.max(0, maxScroll.current));
        
        if (durationSeconds > 5) {
          PublicService.recordView(articleId, {
            dureeVue: durationSeconds,
            scrollDepth: finalScroll,
            userId: user?.id
          });
        }
      }
    };
  }, [articleId, user?.id, loading, notFound]);

  // --- HANDLERS ---
  const handleToggleLike = async () => {
    if (!user) { 
      router.push("/login"); 
      return; 
    }
    
    const prevLiked = isLiked;
    setIsLiked(!prevLiked);
    setLikesCount(prev => isLiked ? prev - 1 : prev + 1);

    try {
      await PublicService.toggleLike(articleId, isLiked);
    } catch {
      setIsLiked(prevLiked);
      setLikesCount(prev => isLiked ? prev + 1 : prev - 1);
    }
  };

  const copyToClipboard = () => {
    navigator.clipboard.writeText(window.location.href);
    setShowShare(false);
    alert("Lien copié !");
  };

  // --- RENDER STATES ---
  if (loading) return <ArticleSkeleton />;
  
  if (notFound || !article) {
    return (
      <div className="min-h-screen bg-white dark:bg-black flex flex-col items-center justify-center">
        <Navbar/>
        <div className="text-center space-y-4 mt-20">
          <h1 className="text-4xl font-black">404</h1>
          <p>Article introuvable.</p>
          <Button onClick={() => router.push('/')} className="w-auto px-6">Retour accueil</Button>
        </div>
      </div>
    );
  }

  // --- MAIN RENDER ---
  return (
    <div className="bg-[#FDFDFD] dark:bg-black min-h-screen font-sans selection:bg-[#3E7B52] selection:text-white flex flex-col">
      <Navbar />

      <main className="max-w-[1100px] mx-auto w-full px-6 md:px-12 py-12 relative flex-1 animate-in fade-in duration-500">
        
        {/* Article Header */}
        <ArticleHeader 
          article={article}
          isLiked={isLiked}
          onToggleLike={handleToggleLike}
          showShare={showShare}
          onToggleShare={() => setShowShare(!showShare)}
        />

        {/* Share Menu (positioned absolutely) */}
        <div className="relative">
          <ShareMenu 
            article={article}
            showShare={showShare}
            onClose={() => setShowShare(false)}
            onCopy={copyToClipboard}
          />
        </div>

        {/* Main Content Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12">
          
          {/* Article Content */}
          <div className="lg:col-span-8">
            
            {/* Cover Image */}
            {article.imageCouvertureUrl && (
              <figure className="mb-12 group cursor-zoom-in">
                <div className="relative w-full aspect-[16/10] rounded-xl overflow-hidden shadow-sm border border-gray-100 dark:border-zinc-800 bg-gray-50">
                  <Image 
                    src={getImageUrl(article.imageCouvertureUrl)} 
                    alt={article.titre} 
                    fill 
                    className="object-cover transition-transform duration-700 group-hover:scale-105" 
                    unoptimized 
                    priority
                  />
                </div>
                <figcaption className="mt-3 text-[11px] text-gray-400 text-right font-mono uppercase tracking-wider flex items-center justify-end gap-2">
                  Crédit: Tody Africa ©
                </figcaption>
              </figure>
            )}

            {/* Article Body */}
            <div className="article-body font-serif text-[18px] md:text-[20px] leading-[1.8] text-[#1a1a1a] dark:text-[#d4d4d8]">
              {article.blocsContenu && article.blocsContenu
                .sort((a,b) => a.ordre - b.ordre)
                .map((bloc, i) => (
                  <ContentBlock key={i} bloc={bloc} />
                ))
              }
            </div>
            
            {/* Tags */}
            <div className="mt-16 pt-8 border-t border-dashed border-gray-200 dark:border-zinc-800">
              <p className="text-xs font-bold uppercase tracking-wider text-gray-400 mb-4">Mots-clés</p>
              <div className="flex flex-wrap gap-2">
                {article.tags && article.tags.map(t => (
                  <span key={t} className="px-4 py-2 bg-gray-50 dark:bg-zinc-900 border border-gray-200 dark:border-zinc-700 text-gray-700 dark:text-zinc-300 text-xs font-bold rounded-full uppercase tracking-wide hover:bg-[#3E7B52] hover:text-white transition-all cursor-default">
                    #{t}
                  </span>
                ))}
              </div>
            </div>
          </div>

          {/* Sidebar */}
          <aside className="lg:col-span-4">
            <div className="sticky top-24 space-y-8">
              
              {/* Stats */}
              <SidebarStats views={article.vues} likes={likesCount} />
              
              {/* Similar Articles */}
              <SimilarArticles currentArticleId={articleId} />
              
              {/* Comments */}
              <div className="min-h-[500px]">
                <CommentSystem articleId={articleId} />
              </div>
              
            </div>
          </aside>

        </div>
      </main>

      <Footer />
      
      {/* Article Body Styles */}
      <style jsx global>{`
        .article-body p { margin-bottom: 1.5em; }
        .article-body h2 { font-weight: 900; margin-top: 2em; margin-bottom: 0.5em; font-size: 1.75em; line-height: 1.1; letter-spacing: -0.02em; font-family: var(--font-sans); }
        .article-body h3 { font-weight: 800; margin-top: 1.5em; margin-bottom: 0.5em; font-size: 1.5em; font-family: var(--font-sans); }
        .article-body a { color: #3E7B52; text-decoration: underline; text-underline-offset: 4px; font-weight: 600; }
        .article-body ul, .article-body ol { margin-bottom: 1.5em; padding-left: 1.5em; }
        .article-body li { margin-bottom: 0.5em; position: relative; }
        .dark .article-body p { color: #d4d4d8; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 4px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; }
      `}</style>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\profil\page.tsx
================================================================================

// FICHIER: app/profil/page.tsx
"use client";

import React from "react";
import { useAuth } from "@/context/AuthContext";
import { useRouter } from "next/navigation";
import Navbar from "@/components/layout/Navbar";
import Footer from "@/components/layout/Footer";
import { LogOut, BookOpen, MessageSquare } from "lucide-react";
import { Button } from "@/components/ui/Button";

export default function ProfilPage() {
    const { user, logout, isAuthenticated, isLoading } = useAuth();
    const router = useRouter();

    React.useEffect(() => {
        if (!isLoading && !isAuthenticated) {
            router.push('/login');
        }
    }, [isLoading, isAuthenticated, router]);

    if (!user) return null;

    return (
        <div className="min-h-screen bg-[#FBFBFB] dark:bg-black font-sans flex flex-col">
            <Navbar />
            
            <main className="max-w-4xl mx-auto w-full px-6 py-12 flex-1">
                <div className="bg-white dark:bg-zinc-900 rounded-2xl border border-gray-200 dark:border-zinc-800 p-8 shadow-sm">
                    
                    <div className="flex flex-col md:flex-row items-center gap-8 mb-12">
                        <div className="w-24 h-24 bg-gradient-to-tr from-[#3E7B52] to-green-300 rounded-full flex items-center justify-center text-4xl font-bold text-white shadow-lg">
                            {user.prenom?.[0]}
                        </div>
                        <div className="text-center md:text-left">
                            <h1 className="text-3xl font-black text-gray-900 dark:text-white mb-2">
                                {user.prenom} {user.nom}
                            </h1>
                            <p className="text-gray-500 font-mono text-sm">{user.email}</p>
                            <span className="inline-block mt-3 px-3 py-1 bg-green-50 text-[#3E7B52] text-xs font-bold rounded-full uppercase">
                                Membre {user.role}
                            </span>
                        </div>
                        <div className="md:ml-auto">
                            <Button variant="outline" onClick={logout} className="text-red-500 border-red-100 p-3 hover:bg-red-50">
                                <LogOut size={16} className="mr-2"/> Déconnexion
                            </Button>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="p-6 bg-gray-50 dark:bg-zinc-800/50 rounded-xl border border-gray-100 dark:border-zinc-800">
                            <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                                <BookOpen size={20} className="text-[#3E7B52]"/> Historique de lecture
                            </h3>
                            <p className="text-sm text-gray-500 italic">Bientôt disponible...</p>
                        </div>
                        <div className="p-6 bg-gray-50 dark:bg-zinc-800/50 rounded-xl border border-gray-100 dark:border-zinc-800">
                            <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                                <MessageSquare size={20} className="text-blue-500"/> Mes Commentaires
                            </h3>
                            <p className="text-sm text-gray-500 italic">Bientôt disponible...</p>
                        </div>
                    </div>
                </div>
            </main>
            
            <Footer />
        </div>
    );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\consulting-cabinet\page.tsx
================================================================================

"use client";

import React from "react";
import Link from "next/link";
import { 
  ArrowRight, 
  Building2, 
  Users, 
  Globe, 
  Target, 
  Newspaper, 
  Mail, 
  Phone, 
  MapPin,
  CheckCircle,
  Briefcase,
  Radio,
  TrendingUp,
  Megaphone
} from "lucide-react";
import Image from "next/image"; // <--- CETTE LIGNE ETAIT MANQUANTE
import { Button } from "@/components/ui/Button";
import Navbar from "@/components/layout/Navbar";
import Footer from "@/components/layout/Footer";

// Services adaptés à un Groupe Média/Presse & Intelligence
const services = [
  {
    icon: Newspaper,
    title: "Édition & Publication",
    description: "Production d'informations de qualité suivant les standards du journalisme britannique.",
    features: ["Quotidien d'actualité", "Éditoriaux exclusifs", "Dossiers d'investigation"]
  },
  {
    icon: TrendingUp,
    title: "Intelligence Économique",
    description: "Analyse des marchés et veille stratégique pour les décideurs du continent.",
    features: ["Rapports sectoriels", "Analyses boursières", "Veille concurrentielle"]
  },
  {
    icon: Megaphone,
    title: "Communication Stratégique",
    description: "Diffusion de vos messages institutionnels auprès d'une audience qualifiée.",
    features: ["Publireportages", "Relations presse", "Brand Content"]
  },
  {
    icon: Globe,
    title: "Public Affairs & Lobbying",
    description: "Mise en relation et influence auprès des sphères décisionnelles.",
    features: ["Médiation institutionnelle", "Forums d'influence", "Networking"]
  }
];

// L'équipe dirigeante fictive (ou placeholders) pour Today's Africa
const team = [
  {
    name: "Direction de la Rédaction",
    role: "Siège Social",
    location: "Yaoundé, Cameroun",
    description: "Le cœur de notre production éditoriale, garant de l'éthique et de la ligne anglo-saxonne."
  },
  {
    name: "Bureau International",
    role: "Correspondants",
    location: "Londres, Royaume-Uni",
    description: "Assurant le lien stratégique entre l'actualité africaine et la diaspora britannique."
  }
];

// Zones de couverture
const regions = [
  "Cameroun (Siège)",
  "Nigeria", 
  "Ghana",
  "Rwanda",
  "Afrique du Sud"
];

export default function TodaysAfricaPage() {
  return (
    <div className="min-h-screen bg-white dark:bg-black font-sans selection:bg-[#3E7B52] selection:text-white flex flex-col">
      <Navbar />

      <main className="max-w-[1400px] mx-auto w-full px-6 md:px-12 py-12 space-y-20">
        
        {/* ================================================================
            1. HERO SECTION (Journal Britannique)
           ================================================================ */}
        <section className="bg-gradient-to-br from-green-50 to-emerald-100 dark:from-[#051F10] dark:to-zinc-900 p-8 md:p-16 rounded-3xl border border-green-100 dark:border-zinc-800 relative overflow-hidden">
          {/* Décoration d'arrière-plan */}
          <div className="absolute -top-20 -right-20 w-64 h-64 bg-[#13EC13]/10 rounded-full blur-3xl pointer-events-none" />
          <div className="absolute -bottom-20 -left-20 w-64 h-64 bg-[#3E7B52]/10 rounded-full blur-3xl pointer-events-none" />
          
          <div className="relative z-10 max-w-6xl mx-auto">
            <div className="grid lg:grid-cols-2 gap-12 items-center">
              <div className="space-y-8">
                
                {/* Badge Haut */}
                <div className="flex items-center gap-3 mb-6">
                  <div className="bg-[#3E7B52] text-white p-3 rounded-xl shadow-lg shadow-green-900/10">
                    <Newspaper size={32} />
                  </div>
                  <span className="text-[#3E7B52] dark:text-[#13EC13] font-bold tracking-widest text-sm uppercase">
                    The Voice of Authority
                  </span>
                </div>
                
                <h1 className="text-4xl sm:text-5xl lg:text-[64px] font-extrabold text-gray-900 dark:text-white leading-[1.1]">
                  <span className="text-[#3E7B52]">TODAY'S</span>
                  <br />AFRICA
                </h1>
                
                <h2 className="text-xl font-medium text-gray-500 dark:text-gray-400 border-l-4 border-[#13EC13] pl-4 italic">
                  "Excellence journalistique britannique, au cœur du Cameroun."
                </h2>
                
                <p className="text-lg text-gray-600 dark:text-gray-300 leading-relaxed max-w-md">
                  Premier groupe média et cabinet d'intelligence basé à Yaoundé. Nous offrons une perspective anglo-saxonne sur les enjeux économiques et politiques qui façonnent le continent.
                </p>

                <div className="flex flex-wrap gap-4 pt-4">
                  <Button className="h-12 px-8 bg-[#3E7B52] hover:bg-[#2d5c3d] text-white font-bold shadow-xl shadow-[#3E7B52]/20">
                    Découvrir nos Analyses
                    <ArrowRight size={16} className="ml-2" />
                  </Button>
                  <Button variant="outline" className="h-12 px-8 border-green-200 dark:border-green-800 text-[#3E7B52] dark:text-[#13EC13] hover:bg-green-50 dark:hover:bg-zinc-800 font-bold">
                    Abonnements Corporate
                  </Button>
                </div>
              </div>

              {/* Card Droit : Info Siège */}
              <div className="relative">
                <div className="absolute -inset-1 bg-gradient-to-r from-[#3E7B52] to-[#13EC13] rounded-2xl blur opacity-20 dark:opacity-40"></div>
                <div className="relative bg-white dark:bg-zinc-900 p-8 rounded-2xl shadow-2xl border border-gray-100 dark:border-zinc-800">
                  <div className="flex justify-between items-start mb-6">
                    <div>
                        <h3 className="text-2xl font-bold text-gray-900 dark:text-white">
                            Siège Editorial
                        </h3>
                        <p className="text-sm text-gray-500">Headquarters</p>
                    </div>
                    <Radio className="text-[#13EC13] animate-pulse" size={24}/>
                  </div>
                  
                  <div className="space-y-6">
                    <div className="flex items-center gap-4 p-4 bg-gray-50 dark:bg-zinc-800/50 rounded-lg">
                      <div className="bg-white dark:bg-zinc-800 p-2 rounded-full border border-gray-100 dark:border-zinc-700">
                         <MapPin className="text-[#3E7B52]" size={20} />
                      </div>
                      <div>
                          <p className="text-xs text-gray-500 uppercase font-bold">Localisation</p>
                          <span className="text-gray-800 dark:text-gray-200 font-semibold">Yaoundé, Cameroun</span>
                      </div>
                    </div>
                    
                    <div className="flex items-center gap-4 p-4 bg-gray-50 dark:bg-zinc-800/50 rounded-lg">
                       <div className="bg-white dark:bg-zinc-800 p-2 rounded-full border border-gray-100 dark:border-zinc-700">
                          <Building2 className="text-[#3E7B52]" size={20} />
                       </div>
                       <div>
                          <p className="text-xs text-gray-500 uppercase font-bold">Standard</p>
                          <span className="text-gray-800 dark:text-gray-200 font-semibold">Anglo-Saxon Standard</span>
                       </div>
                    </div>

                    <div className="flex items-center gap-4 p-4 bg-gray-50 dark:bg-zinc-800/50 rounded-lg">
                       <div className="bg-white dark:bg-zinc-800 p-2 rounded-full border border-gray-100 dark:border-zinc-700">
                          <Target className="text-[#3E7B52]" size={20} />
                       </div>
                       <div>
                          <p className="text-xs text-gray-500 uppercase font-bold">Expertise</p>
                          <span className="text-gray-800 dark:text-gray-200 font-semibold">Politique & Économie</span>
                       </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* ================================================================
            2. SERVICES (Intelligence & Média)
           ================================================================ */}
        <section className="space-y-12">
          <div className="text-center space-y-4">
            <span className="text-[#3E7B52] dark:text-[#13EC13] font-bold tracking-widest text-xs uppercase bg-green-50 dark:bg-green-900/30 px-3 py-1 rounded-full">
              Nos Piliers
            </span>
            <h2 className="text-3xl md:text-4xl font-black text-gray-900 dark:text-white">
              Information & Intelligence Stratégique
            </h2>
            <p className="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto text-lg">
              Au-delà de l'actualité, nous fournissons les clés de lecture pour naviguer l'environnement complexe de l'Afrique Centrale.
            </p>
          </div>

          <div className="grid md:grid-cols-2 gap-8">
            {services.map((service, index) => (
              <div key={index} className="bg-white dark:bg-zinc-900 p-8 rounded-2xl border border-gray-100 dark:border-zinc-800 hover:border-[#3E7B52]/50 hover:shadow-xl hover:shadow-[#3E7B52]/5 transition-all duration-300 group">
                <div className="flex items-start gap-6">
                  <div className="bg-green-50 dark:bg-green-900/20 p-4 rounded-2xl group-hover:bg-[#3E7B52] group-hover:text-white transition-colors duration-300">
                    <service.icon size={28} className="text-[#3E7B52] group-hover:text-white" />
                  </div>
                  <div className="flex-1 space-y-4">
                    <h3 className="text-xl font-bold text-gray-900 dark:text-white">
                      {service.title}
                    </h3>
                    <p className="text-gray-600 dark:text-gray-400 leading-relaxed">
                      {service.description}
                    </p>
                    <ul className="space-y-3 pt-2">
                      {service.features.map((feature, idx) => (
                        <li key={idx} className="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                          <CheckCircle size={16} className="text-[#13EC13]" />
                          {feature}
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </section>

        {/* ================================================================
            3. ÉQUIPE & COUVERTURE
           ================================================================ */}
        <section className="bg-gray-50 dark:bg-zinc-900/50 rounded-3xl p-8 md:p-16 space-y-12 border border-gray-100 dark:border-zinc-800">
          <div className="grid lg:grid-cols-2 gap-16">
            
            {/* Colonne Equipe */}
            <div className="space-y-8">
                <div>
                    <span className="text-[#3E7B52] dark:text-[#13EC13] font-bold tracking-widest text-xs uppercase mb-2 block">
                    Leadership
                    </span>
                    <h2 className="text-3xl font-black text-gray-900 dark:text-white mb-6">
                    Structure Editoriale
                    </h2>
                </div>

                <div className="space-y-6">
                    {team.map((member, index) => (
                    <div key={index} className="bg-white dark:bg-zinc-900 p-6 rounded-xl border border-gray-200 dark:border-zinc-700 shadow-sm flex gap-4 items-center">
                        <div className="w-16 h-16 bg-[#3E7B52]/10 rounded-full flex items-center justify-center shrink-0">
                             <Users size={24} className="text-[#3E7B52]" />
                        </div>
                        <div>
                        <h3 className="text-lg font-bold text-gray-900 dark:text-white">
                            {member.name}
                        </h3>
                        <p className="text-[#3E7B52] dark:text-[#13EC13] font-bold text-sm">
                            {member.role}
                        </p>
                        <p className="text-xs text-gray-500 mt-1 flex items-center gap-1">
                            <MapPin size={12}/> {member.location}
                        </p>
                        </div>
                    </div>
                    ))}
                </div>
            </div>

            {/* Colonne Couverture (Map Vibes) */}
            <div className="bg-[#3E7B52] rounded-3xl p-8 md:p-10 text-white relative overflow-hidden flex flex-col justify-center">
                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                <Globe className="text-[#13EC13]/20 absolute -right-12 -bottom-12 w-64 h-64 animate-spin-slow" />
                
                <h3 className="text-2xl font-bold mb-6 relative z-10">Couverture Pan-Africaine</h3>
                <p className="text-green-100 mb-8 relative z-10">
                    Depuis Yaoundé, Today's Africa étend son influence à travers le Commonwealth et la Francophonie.
                </p>

                <div className="grid grid-cols-2 gap-3 relative z-10">
                    {regions.map((region, idx) => (
                        <div key={idx} className="bg-white/10 backdrop-blur-sm border border-white/10 rounded-lg px-4 py-2 text-sm font-semibold flex items-center gap-2 hover:bg-white/20 transition-colors cursor-default">
                             <div className="w-2 h-2 rounded-full bg-[#13EC13]"></div>
                             {region}
                        </div>
                    ))}
                </div>
            </div>
          </div>
        </section>

        {/* ================================================================
            4. CONTACT (NEWSROOM)
           ================================================================ */}
        <section className="bg-gradient-to-r from-gray-900 to-black rounded-3xl p-8 md:p-16 text-white relative overflow-hidden">
          <div className="absolute inset-0 opacity-30">
             <Image src="/images/noise.png" alt="texture" fill className="object-cover opacity-10" />
          </div>
          {/* Accent Line Top */}
          <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#3E7B52] to-[#13EC13]"></div>

          <div className="relative z-10 max-w-5xl mx-auto">
            <div className="grid lg:grid-cols-2 gap-12 items-center">
              <div className="space-y-6">
                <h3 className="text-3xl md:text-4xl font-black text-white">
                  Contacter la Rédaction
                </h3>
                <p className="text-gray-400 text-lg">
                  Vous souhaitez soumettre une tribune, devenir annonceur ou solliciter une analyse stratégique ?
                </p>
                
                <div className="space-y-4 pt-4">
                  <div className="flex items-center gap-4 group cursor-pointer">
                    <div className="w-10 h-10 rounded-full bg-[#3E7B52]/20 flex items-center justify-center group-hover:bg-[#13EC13] transition-colors">
                        <Mail size={18} className="text-[#13EC13] group-hover:text-black" />
                    </div>
                    <span className="font-mono text-gray-300">newsroom@todaysafrica.com</span>
                  </div>
                  <div className="flex items-center gap-4 group cursor-pointer">
                    <div className="w-10 h-10 rounded-full bg-[#3E7B52]/20 flex items-center justify-center group-hover:bg-[#13EC13] transition-colors">
                        <Phone size={18} className="text-[#13EC13] group-hover:text-black" />
                    </div>
                    <span className="font-mono text-gray-300">+237 (Service Abonnement)</span>
                  </div>
                </div>
              </div>

              {/* Mini Form */}
              <div className="bg-white/5 backdrop-blur-md p-8 rounded-2xl border border-white/10 shadow-2xl">
                <h4 className="text-xl font-bold mb-6 text-white">Formulaire de contact</h4>
                <form className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <input 
                        type="text" 
                        placeholder="Prénom" 
                        className="w-full h-11 px-4 rounded-lg bg-black/40 border border-white/10 text-white focus:border-[#13EC13] outline-none text-sm"
                    />
                    <input 
                        type="text" 
                        placeholder="Nom" 
                        className="w-full h-11 px-4 rounded-lg bg-black/40 border border-white/10 text-white focus:border-[#13EC13] outline-none text-sm"
                    />
                  </div>
                  <input 
                    type="email" 
                    placeholder="Email professionnel" 
                    className="w-full h-11 px-4 rounded-lg bg-black/40 border border-white/10 text-white focus:border-[#13EC13] outline-none text-sm"
                  />
                  <select className="w-full h-11 px-4 rounded-lg bg-black/40 border border-white/10 text-gray-400 focus:border-[#13EC13] outline-none text-sm">
                      <option>Sujet de la demande</option>
                      <option>Proposer un Article</option>
                      <option>Service Commercial / Publicité</option>
                      <option>Conseil & Intelligence</option>
                  </select>
                  
                  <Button className="w-full h-12 bg-[#3E7B52] hover:bg-[#2d5c3d] text-white font-bold mt-2">
                    Envoyer
                  </Button>
                </form>
              </div>
            </div>
          </div>
        </section>

      </main>
      
      <Footer />
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\intelligence-interculturelle\page.tsx
================================================================================

"use client";

import React, { useEffect, useState } from "react";
import Image from "next/image";
import Link from "next/link";
import { 
  ArrowRight, 
  BookOpen, 
  Users, 
  Globe, 
  Brain,
  Sparkles,
  TrendingUp,
  Award,
  Eye
} from "lucide-react";
import { Button } from "@/components/ui/Button";
import { APP_CONFIG } from "@/lib/constant";
import ArticleCard from "@/components/ui/ArticleCard";
import Navbar from "@/components/layout/Navbar";
import Footer from "@/components/layout/Footer";
import { PublicService } from "@/services/public";
import { ArticleReadDto } from "@/types/article";
import { PageResponse } from "@/types/dashboard";

const SkeletonCard = () => (
  <div className="group relative flex flex-col h-full bg-white dark:bg-zinc-900 border border-emerald-100 dark:border-emerald-900/30 rounded-2xl overflow-hidden animate-pulse">
    <div className="relative h-56 w-full bg-gradient-to-br from-emerald-100 to-teal-100 dark:from-emerald-950 dark:to-teal-950 overflow-hidden">
      <div className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
      <div className="absolute top-4 left-4 flex gap-2">
        <div className="h-6 w-20 bg-emerald-200 dark:bg-emerald-800 rounded-full"></div>
      </div>
    </div>
    
    <div className="p-6 space-y-4 flex-1 flex flex-col">
      <div className="space-y-3">
        <div className="h-3 w-24 bg-emerald-100 dark:bg-emerald-900 rounded-full"></div>
        <div className="h-6 w-full bg-gray-200 dark:bg-zinc-800 rounded"></div>
        <div className="h-6 w-4/5 bg-gray-200 dark:bg-zinc-800 rounded"></div>
      </div>
      
      <div className="space-y-2 pt-2">
        <div className="h-4 w-full bg-gray-100 dark:bg-zinc-800/50 rounded"></div>
        <div className="h-4 w-full bg-gray-100 dark:bg-zinc-800/50 rounded"></div>
        <div className="h-4 w-3/4 bg-gray-100 dark:bg-zinc-800/50 rounded"></div>
      </div>
      
      <div className="mt-auto pt-4 flex items-center justify-between border-t border-gray-100 dark:border-zinc-800">
        <div className="h-4 w-32 bg-gray-200 dark:bg-zinc-800 rounded"></div>
        <div className="h-8 w-8 bg-emerald-100 dark:bg-emerald-900 rounded-full"></div>
      </div>
    </div>
  </div>
);

export default function IntelligenceInterculturelle() {
  const [articles, setArticles] = useState<ArticleReadDto[]>([]);
  const [loading, setLoading] = useState(true);
  const [currentPage, setCurrentPage] = useState(0);
  const [totalPages, setTotalPages] = useState(0);

  useEffect(() => {
    const fetchAdminArticles = async () => {
      setLoading(true);
      try {
        const response: PageResponse<ArticleReadDto> = await PublicService.getAdminArticles(currentPage, 12);
        setArticles(response.content);
        setTotalPages(response.totalPages);
      } catch (error) {
        console.error("Erreur lors du chargement des articles admin:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchAdminArticles();
  }, [currentPage]);

  return (
    <div className="min-h-screen bg-gradient-to-b from-white via-emerald-50/30 to-white dark:from-black dark:via-emerald-950/10 dark:to-black font-sans selection:bg-emerald-600 selection:text-white flex flex-col transition-colors duration-300">
      <Navbar />

      <main className="max-w-[1400px] mx-auto w-full px-6 md:px-12 py-12 space-y-20">
        
        {/* Hero Section */}
        <section className="relative">
          <div className="absolute inset-0 bg-gradient-to-br from-emerald-100 via-teal-50 to-green-100 dark:from-emerald-950 dark:via-teal-950 dark:to-green-950 rounded-[2.5rem] opacity-50 blur-3xl -z-10"></div>
          
          <div className="bg-gradient-to-br from-emerald-50 to-teal-100 dark:from-emerald-950/50 dark:to-teal-950/50 p-8 md:p-16 lg:p-20 rounded-[2.5rem] border border-emerald-200 dark:border-emerald-800/30 relative overflow-hidden backdrop-blur-sm">
            {/* Animated background elements */}
            <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
              <div className="absolute -top-20 -right-20 w-72 h-72 bg-emerald-500/10 dark:bg-emerald-400/5 rounded-full blur-3xl animate-pulse"></div>
              <div className="absolute -bottom-20 -left-20 w-72 h-72 bg-teal-500/10 dark:bg-teal-400/5 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '1s' }}></div>
              <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-green-500/5 dark:bg-green-400/3 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '2s' }}></div>
            </div>
            
            <div className="relative z-10 max-w-5xl mx-auto text-center space-y-10">
              {/* Icon Badge */}
              <div className="flex justify-center mb-8 animate-float">
                <div className="relative group">
                  <div className="absolute inset-0 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition-opacity"></div>
                  <div className="relative bg-gradient-to-br from-emerald-600 to-teal-600 text-white p-5 rounded-2xl shadow-2xl transform group-hover:scale-110 transition-transform duration-300">
                    <Brain size={56} strokeWidth={1.5} />
                  </div>
                </div>
              </div>
              
              {/* Main Title */}
              <div className="space-y-4">
                <div className="inline-flex items-center gap-2 bg-emerald-100 dark:bg-emerald-900/30 px-4 py-2 rounded-full border border-emerald-300 dark:border-emerald-700">
                  <Sparkles size={16} className="text-emerald-600 dark:text-emerald-400" />
                  <span className="text-sm font-bold text-emerald-700 dark:text-emerald-300 tracking-wide">TODAY'S AFRICA EDITORIAL</span>
                </div>
                
                <h1 className="text-4xl sm:text-5xl lg:text-7xl font-black text-gray-900 dark:text-white leading-tight tracking-tight">
                  Introduction à la Théorie de 
                  <span className="block mt-2 bg-gradient-to-r from-emerald-600 via-teal-600 to-green-600 dark:from-emerald-400 dark:via-teal-400 dark:to-green-400 bg-clip-text text-transparent animate-gradient">
                    l'Intelligence Interculturelle
                  </span>
                </h1>
              </div>
              
              {/* Description */}
              <p className="text-xl sm:text-2xl text-gray-700 dark:text-gray-300 max-w-4xl mx-auto leading-relaxed font-light">
                Découvrez les analyses approfondies et les perspectives uniques de notre équipe éditoriale sur les enjeux interculturels qui façonnent l'Afrique moderne.
              </p>

              {/* Feature Pills */}
              <div className="flex flex-wrap justify-center gap-4 pt-6">
                <div className="group flex items-center gap-3 bg-white/80 dark:bg-emerald-900/20 backdrop-blur-sm px-6 py-3.5 rounded-full border border-emerald-200 dark:border-emerald-700/50 hover:border-emerald-400 dark:hover:border-emerald-500 transition-all duration-300 hover:scale-105 hover:shadow-lg">
                  <div className="bg-emerald-100 dark:bg-emerald-800 p-2 rounded-full group-hover:bg-emerald-200 dark:group-hover:bg-emerald-700 transition-colors">
                    <Award className="text-emerald-600 dark:text-emerald-400" size={18} />
                  </div>
                  <span className="font-semibold text-gray-800 dark:text-gray-200">Analyses Expertes</span>
                </div>
                
                <div className="group flex items-center gap-3 bg-white/80 dark:bg-emerald-900/20 backdrop-blur-sm px-6 py-3.5 rounded-full border border-emerald-200 dark:border-emerald-700/50 hover:border-emerald-400 dark:hover:border-emerald-500 transition-all duration-300 hover:scale-105 hover:shadow-lg">
                  <div className="bg-teal-100 dark:bg-teal-800 p-2 rounded-full group-hover:bg-teal-200 dark:group-hover:bg-teal-700 transition-colors">
                    <Globe className="text-teal-600 dark:text-teal-400" size={18} />
                  </div>
                  <span className="font-semibold text-gray-800 dark:text-gray-200">Vision Continentale</span>
                </div>
                
                <div className="group flex items-center gap-3 bg-white/80 dark:bg-emerald-900/20 backdrop-blur-sm px-6 py-3.5 rounded-full border border-emerald-200 dark:border-emerald-700/50 hover:border-emerald-400 dark:hover:border-emerald-500 transition-all duration-300 hover:scale-105 hover:shadow-lg">
                  <div className="bg-green-100 dark:bg-green-800 p-2 rounded-full group-hover:bg-green-200 dark:group-hover:bg-green-700 transition-colors">
                    <TrendingUp className="text-green-600 dark:text-green-400" size={18} />
                  </div>
                  <span className="font-semibold text-gray-800 dark:text-gray-200">Recherche Approfondie</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* Section Articles */}
        <section className="space-y-10">
          <div className="text-center space-y-5">
            <div className="inline-flex items-center gap-2 bg-emerald-100 dark:bg-emerald-900/30 px-4 py-2 rounded-full border border-emerald-300 dark:border-emerald-700">
              <Eye size={16} className="text-emerald-600 dark:text-emerald-400" />
              <span className="text-emerald-700 dark:text-emerald-300 font-bold tracking-widest text-xs uppercase">Publications Spécialisées</span>
            </div>
            
            <h2 className="text-4xl md:text-5xl font-black text-gray-900 dark:text-white tracking-tight">
              Articles de Recherche et d'Analyse
            </h2>
            
            <p className="text-lg text-gray-600 dark:text-gray-400 max-w-3xl mx-auto leading-relaxed">
              Une collection d'articles approfondis explorant les dimensions culturelles, sociales et économiques de l'Afrique contemporaine.
            </p>
          </div>

          {loading ? (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-8">
              {Array.from({ length: 8 }).map((_, i) => (
                <SkeletonCard key={i} />
              ))}
            </div>
          ) : articles.length > 0 ? (
            <>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-8">
                {articles.map((article, index) => (
                  <div 
                    key={article.id}
                    className="animate-fade-in-up"
                    style={{ animationDelay: `${index * 50}ms` }}
                  >
                    <ArticleCard 
                      article={article}
                      className="h-full hover:shadow-2xl hover:scale-[1.02] transition-all duration-300 border-emerald-100 dark:border-emerald-900/30"
                      imageHeight="h-56"
                    />
                  </div>
                ))}
              </div>

              {/* Pagination */}
              {totalPages > 1 && (
                <div className="flex justify-center items-center gap-6 pt-12">
                  <Button
                    variant="outline"
                    onClick={() => setCurrentPage(prev => Math.max(0, prev - 1))}
                    disabled={currentPage === 0}
                    className="px-8 py-6 font-semibold border-2 border-emerald-300 dark:border-emerald-700 hover:bg-emerald-50 dark:hover:bg-emerald-900/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-300"
                  >
                    ← Précédent
                  </Button>
                  
                  <div className="flex items-center gap-3 bg-emerald-100 dark:bg-emerald-900/30 px-6 py-3 rounded-full border border-emerald-300 dark:border-emerald-700">
                    <span className="text-gray-800 dark:text-gray-200 font-bold">
                      Page {currentPage + 1}
                    </span>
                    <span className="text-gray-500 dark:text-gray-400">sur</span>
                    <span className="text-emerald-600 dark:text-emerald-400 font-bold">
                      {totalPages}
                    </span>
                  </div>
                  
                  <Button
                    variant="outline"
                    onClick={() => setCurrentPage(prev => Math.min(totalPages - 1, prev + 1))}
                    disabled={currentPage >= totalPages - 1}
                    className="px-8 py-6 font-semibold border-2 border-emerald-300 dark:border-emerald-700 hover:bg-emerald-50 dark:hover:bg-emerald-900/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-300"
                  >
                    Suivant →
                  </Button>
                </div>
              )}
            </>
          ) : (
            <div className="text-center py-20 space-y-6">
              <div className="relative inline-flex items-center justify-center">
                <div className="absolute inset-0 bg-emerald-500/20 dark:bg-emerald-400/10 rounded-full blur-2xl"></div>
                <div className="relative bg-gradient-to-br from-emerald-100 to-teal-100 dark:from-emerald-900/30 dark:to-teal-900/30 rounded-full w-28 h-28 flex items-center justify-center border border-emerald-200 dark:border-emerald-800">
                  <BookOpen size={40} className="text-emerald-600 dark:text-emerald-400" strokeWidth={1.5} />
                </div>
              </div>
              
              <div className="space-y-3">
                <h3 className="text-2xl font-bold text-gray-800 dark:text-gray-200">
                  Aucun article disponible pour le moment
                </h3>
                <p className="text-gray-600 dark:text-gray-400 text-lg max-w-md mx-auto">
                  Les publications spécialisées seront bientôt disponibles. Revenez prochainement !
                </p>
              </div>
            </div>
          )}
        </section>

        {/* CTA Section */}
        <section className="relative">
          <div className="absolute inset-0 bg-gradient-to-br from-emerald-600 to-teal-600 rounded-[2.5rem] opacity-90 blur-2xl -z-10"></div>
          
          <div className="bg-gradient-to-br from-emerald-600 via-teal-600 to-green-600 rounded-[2.5rem] p-8 md:p-16 lg:p-20 text-center text-white relative overflow-hidden border border-emerald-400/30 shadow-2xl">
            {/* Animated Pattern Background */}
            <div className="absolute inset-0 opacity-10">
              <div className="absolute inset-0" style={{ 
                backgroundImage: `url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,
              }}></div>
            </div>
            
            {/* Floating elements */}
            <div className="absolute top-10 right-10 w-20 h-20 bg-white/10 rounded-full blur-xl animate-float"></div>
            <div className="absolute bottom-10 left-10 w-32 h-32 bg-white/10 rounded-full blur-xl animate-float" style={{ animationDelay: '1s' }}></div>
            
            <div className="relative z-10 max-w-3xl mx-auto space-y-8">
              <div className="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full border border-white/30">
                <Sparkles size={16} className="text-white" />
                <span className="text-sm font-bold text-white tracking-wide">REJOIGNEZ-NOUS</span>
              </div>
              
              <h3 className="text-4xl md:text-5xl font-black leading-tight">
                Approfondissez vos connaissances
              </h3>
              
              <p className="text-emerald-50 text-xl max-w-2xl mx-auto leading-relaxed">
                Rejoignez notre communauté de lecteurs passionnés par l'intelligence interculturelle et les enjeux africains.
              </p>
              
              <div className="flex flex-wrap justify-center gap-4 pt-6">
                <Link href="/">
                  <Button className="h-14 px-10 bg-white text-emerald-600 hover:bg-emerald-50 font-bold shadow-2xl rounded-full text-lg group transition-all duration-300 hover:scale-105">
                    Retour à l'accueil
                    <ArrowRight size={20} className="ml-3 group-hover:translate-x-1 transition-transform" />
                  </Button>
                </Link>
                
                <Button className="h-14 px-10 bg-emerald-800/50 backdrop-blur-sm border-2 border-white/30 text-white hover:bg-emerald-700/50 font-bold shadow-xl rounded-full text-lg transition-all duration-300 hover:scale-105">
                  <Users size={20} className="mr-3" />
                  S'abonner
                </Button>
              </div>
            </div>
          </div>
        </section>

      </main>
      
      <Footer />

      <style jsx>{`
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        
        @keyframes gradient {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
        }
        
        @keyframes fade-in-up {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .animate-float {
          animation: float 3s ease-in-out infinite;
        }
        
        .animate-gradient {
          background-size: 200% 200%;
          animation: gradient 3s ease infinite;
        }
        
        .animate-fade-in-up {
          animation: fade-in-up 0.6s ease-out forwards;
          opacity: 0;
        }
      `}</style>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\page.tsx
================================================================================

// FICHIER: app/page.tsx
"use client";

import React, { useEffect, useState } from "react";
import Image from "next/image";
import Link from "next/link";
import { ArrowRight, FolderOpen, Loader2, Clock, ArrowLeft, ChevronLeft, Quote } from "lucide-react"; 
import { Button } from "@/components/ui/Button";
import ArticleCard from "@/components/ui/ArticleCard";
import Navbar from "@/components/layout/Navbar";
import Footer from "@/components/layout/Footer";
import { PublicService } from "@/services/public";
import { ArticleReadDto, Rubrique } from "@/types/article";
import { OnboardingTour } from "@/components/ui/OnBoardingTour";

// Nouveaux imports
import InterculturelSidebar from "@/components/layout/InterculturalSidebar";
import ConsultingSidebar from "@/components/layout/ConsultingSidebar";
import { cn, getImageUrl } from "@/lib/utils";
import LandingArticleCard from "@/components/ui/LandingCard";

// --- COMPOSANT SKELETON CARD (Adapté à la nouvelle grille) ---
const SectionSkeleton = () => (
  <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 animate-pulse">
      {/* Grand article (2 colonnes) */}
      <div className="md:col-span-2 lg:col-span-2 flex flex-col h-full bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl overflow-hidden p-4 space-y-4">
        <div className="h-48 w-full bg-gray-200 dark:bg-zinc-800 rounded-lg"></div>
        <div className="space-y-2">
           <div className="h-6 w-full bg-gray-200 dark:bg-zinc-800 rounded"></div>
           <div className="h-6 w-2/3 bg-gray-200 dark:bg-zinc-800 rounded"></div>
        </div>
      </div>
      {/* Petits articles (1 colonne chacun - 4 fois) */}
      {[1, 2, 3, 4].map(i => (
        <div key={i} className="col-span-1 flex flex-col h-full bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl overflow-hidden p-4 space-y-4">
            <div className="h-32 w-full bg-gray-200 dark:bg-zinc-800 rounded-lg"></div>
            <div className="space-y-2">
               <div className="h-4 w-full bg-gray-200 dark:bg-zinc-800 rounded"></div>
            </div>
        </div>
      ))}
  </div>
);

type SectionData = {
  rubrique: Rubrique;
  articles: ArticleReadDto[];
};

export default function Home() {
  const [heroArticles, setHeroArticles] = useState<ArticleReadDto[]>([]);
  const [latestArticles, setLatestArticles] = useState<ArticleReadDto[]>([]);
  const [sections, setSections] = useState<SectionData[]>([]);
  const [loading, setLoading] = useState(true);
  
  // --- STATES CARROUSEL ---
  const [currentSlide, setCurrentSlide] = useState(0);
  const [isTransitioning, setIsTransitioning] = useState(false);
  const [direction, setDirection] = useState<'left' | 'right'>('left');

  useEffect(() => {
    const initData = async () => {
      setLoading(true);
      try {
        console.log("📥 [HOME] Chargement données API Public...");

        const [trendingData, feedData, allRubriques] = await Promise.all([
          PublicService.getTrendingArticles(),
          PublicService.getAllArticles(0, 6),
          PublicService.getRubriques()
        ]);

        console.log("✅ [HOME] Données Trending:", trendingData);
        console.log("✅ [HOME] Données Feed:", feedData);

        // On prend les 5 premiers pour le carrousel
        const carouselSource = trendingData.length > 0 ? trendingData : feedData.content || [];
        const heroData = carouselSource.slice(0, 5);
        
        setHeroArticles(heroData);
        console.log("🎠 [CAROUSEL] Articles chargés:", heroData.length, "articles");
        heroData.forEach((art, idx) => {
          console.log(`   [${idx}] ID: ${art.id}, Titre: ${art.titre}, Image: ${art.imageCouvertureUrl}`);
        });
        
        setLatestArticles(feedData.content || []);

        const rootCategories = allRubriques.filter(r => r.parentId === null);
        
        const sectionsPromises = rootCategories.map(async (rub) => {
          const arts = await PublicService.getArticlesByRubrique(rub.id);
          return { 
            rubrique: rub, 
            articles: arts ? arts.slice(0, 5) : [] 
          };
        });

        const loadedSections = await Promise.all(sectionsPromises);
        setSections(loadedSections);

      } catch(e) {
        console.error("❌ [HOME] Erreur chargement:", e);
      } finally {
        setLoading(false);
      }
    };
    initData();
  }, []);

  // 2. Logique du Timer (5 secondes) - Auto-play
  useEffect(() => {
    if (heroArticles.length <= 1) return;

    const timer = setInterval(() => {
      console.log("⏰ [CAROUSEL] Timer déclenché - Passage automatique");
      goToNextSlide();
    }, 5000);

    return () => clearInterval(timer);
  }, [heroArticles.length, currentSlide]);

  // Fonctions de navigation avec transition
  const goToNextSlide = () => {
    if (isTransitioning) return;
    console.log(`➡️ [CAROUSEL] Navigation: ${currentSlide} → ${(currentSlide + 1) % heroArticles.length}`);
    setDirection('left');
    setIsTransitioning(true);
    setTimeout(() => {
      setCurrentSlide((prev) => (prev + 1) % heroArticles.length);
      setIsTransitioning(false);
    }, 300);
  };

  const goToPrevSlide = () => {
    if (isTransitioning) return;
    console.log(`⬅️ [CAROUSEL] Navigation: ${currentSlide} → ${(currentSlide - 1 + heroArticles.length) % heroArticles.length}`);
    setDirection('right');
    setIsTransitioning(true);
    setTimeout(() => {
      setCurrentSlide((prev) => (prev - 1 + heroArticles.length) % heroArticles.length);
      setIsTransitioning(false);
    }, 300);
  };

  const goToSlide = (index: number) => {
    if (isTransitioning || index === currentSlide) return;
    console.log(`🎯 [CAROUSEL] Navigation directe: ${currentSlide} → ${index}`);
    setDirection(index > currentSlide ? 'left' : 'right');
    setIsTransitioning(true);
    setTimeout(() => {
      setCurrentSlide(index);
      setIsTransitioning(false);
    }, 300);
  };

  // Article affiché actuellement
  const activeArticle = heroArticles[currentSlide];

  return (
    <div className="min-h-screen bg-[#F9F9F9] dark:bg-black font-sans selection:bg-[#3E7B52] selection:text-white flex flex-col relative">
      <Navbar />

      {/* --- GRID LAYOUT 3 COLONNES --- */}
      <div className="w-full max-w-[1600px] mx-auto px-4 md:px-6 py-8">
        <div className="grid grid-cols-1 lg:grid-cols-16 gap-8 items-start relative">
            
            {/* --- SIDEBAR GAUCHE : INTERCULTUREL --- */}
            <div className="hidden lg:block lg:col-span-4 sticky top-28 h-[calc(100vh-8rem)] overflow-y-auto no-scrollbar">
                <InterculturelSidebar />
            </div>

            {/* --- COLONNE CENTRALE : CONTENU --- */}
            <div className="col-span-1 lg:col-span-9 space-y-12">
                <main className="w-full space-y-5">
                    
                {/* === HERO CAROUSEL MODERNISÉ === */}
                <section className="relative w-full rounded-3xl overflow-hidden group">
                  {loading ? (
                    <div className="w-full aspect-[21/9] bg-gray-200 dark:bg-zinc-800 rounded-2xl animate-pulse" />
                  ) : activeArticle ? (
                    <div className="flex flex-col gap-0 w-full">
                      
                      {/* --- PARTIE IMAGE & TITRE (CARD) --- */}
                      <div className="relative w-full aspect-[21/9] md:aspect-[21/9] rounded-2xl overflow-hidden shadow-xl border border-gray-100 dark:border-zinc-800">
                        
                        {/* Conteneur des slides avec animation */}
                        <div className="relative w-full h-full">
                          {heroArticles.map((article, idx) => (
                            <div
                              key={article.id}
                              className={cn(
                                "absolute inset-0 transition-all duration-500 ease-in-out",
                                idx === currentSlide 
                                  ? "opacity-100 translate-x-0 z-10" 
                                  : idx < currentSlide
                                  ? "opacity-0 -translate-x-full z-0"
                                  : "opacity-0 translate-x-full z-0"
                              )}
                            >
                              <Link href={`/article/${article.id}`}>
                                <Image 
                                  src={getImageUrl(article.imageCouvertureUrl)} 
                                  alt={article.titre}
                                  fill
                                  priority={idx === 0}
                                  className="object-cover group-hover:scale-105 transition-transform duration-1000 ease-out"
                                  unoptimized={true}
                                />
                                <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-90" />
                                
                                {/* Overlay Titre */}
                                <div className="absolute bottom-0 left-0 p-6 md:p-8 w-full z-20">
                                  <div className="flex flex-col items-start gap-3">
                                    {/* Badge animé */}
                                    <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#3E7B52] text-white text-[10px] font-black uppercase tracking-wider shadow-lg">
                                      <div className="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></div> 
                                      À la une
                                    </span>
                                    
                                    {/* Titre */}
                                    <h1 className="text-xl md:text-3xl lg:text-4xl font-extrabold text-white leading-[1.1] tracking-tight drop-shadow-lg line-clamp-3">
                                      {article.titre}
                                    </h1>

                                    {/* Metadata */}
                                    <div className="flex items-center gap-4 text-xs font-medium text-gray-300">
                                      <span className="flex items-center gap-1.5">
                                        <FolderOpen size={14} className="text-[#3E7B52]"/> 
                                        <span className="uppercase tracking-wide">{article.rubriqueNom || "Actualité"}</span>
                                      </span>
                                    </div>
                                  </div>
                                </div>
                              </Link>
                            </div>
                          ))}
                        </div>

                        {/* Navigation Arrows Overlay */}
                        <div className="absolute inset-x-0 top-1/2 -translate-y-1/2 flex justify-between px-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-30">
                          <button 
                            onClick={goToPrevSlide}
                            disabled={isTransitioning}
                            className="p-3 bg-black/40 backdrop-blur hover:bg-[#3E7B52] text-white rounded-full transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                          >
                            <ArrowLeft size={20}/>
                          </button>
                          <button 
                            onClick={goToNextSlide}
                            disabled={isTransitioning}
                            className="p-3 bg-black/40 backdrop-blur hover:bg-[#3E7B52] text-white rounded-full transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                          >
                            <ArrowRight size={20}/>
                          </button>
                        </div>
                      </div>

                      {/* --- PARTIE DESCRIPTION SÉPARÉE --- */}
                      <div className="pt-4 px-2 min-h-[90px]">
                        <div className="flex gap-4 items-start">
                          <Quote size={20} className="text-[#3E7B52]/50 rotate-180 shrink-0 mt-1" />
                          
                          <div className="flex-1 space-y-2">
                            <p 
                              key={`desc-${currentSlide}`}
                              className="text-sm italic font-serif text-gray-600 dark:text-zinc-400 leading-relaxed animate-in fade-in slide-in-from-bottom-2 duration-500"
                            >
                              "{activeArticle.description || "L'Afrique centrale amorce une transformation décisive. Découvrez les détails de cette analyse exclusive réservée à nos abonnés..."}"
                            </p>
                            
                            {/* Indicateurs (Dots) */}
                            <div className="flex gap-1.5 pt-2">
                              {heroArticles.map((_, idx) => (
                                <button
                                  key={idx}
                                  onClick={() => goToSlide(idx)}
                                  disabled={isTransitioning}
                                  className={cn(
                                    "h-1 rounded-full transition-all duration-500 cursor-pointer disabled:cursor-not-allowed",
                                    idx === currentSlide 
                                      ? "w-8 bg-[#3E7B52]" 
                                      : "w-2 bg-gray-300 dark:bg-zinc-700 hover:bg-[#3E7B52]/50"
                                  )}
                                />
                              ))}
                            </div>
                          </div>
                        </div>
                      </div>

                    </div>
                  ) : null}
                </section>
                
                {/* ================================================================
                        2. SECTIONS DYNAMIQUES (MARQUEE INFINI)
                    ================================================================ */}
                    {loading ? (
                      <div className="space-y-16">
                          {[1, 2].map((k) => (
                            <div key={k}>
                                <div className="h-8 w-48 bg-gray-200 dark:bg-zinc-800 rounded mb-6 animate-pulse"/>
                                {/* Skeleton Horizontal */}
                                <div className="flex gap-4 overflow-hidden mask-fade-sides">
                                     {[1,2,3,4].map(i => <div key={i} className="min-w-[280px] h-64 bg-gray-200 dark:bg-zinc-800 rounded-xl shrink-0"></div>)}
                                </div>
                            </div>
                          ))}
                      </div>
                    ) : (
                        sections.map((section) => {
                          if (section.articles.length === 0) return null;
                          
                          // On duplique les articles pour l'effet de boucle infinie (Seamless loop)
                          // Si moins de 4 articles, on duplique plusieurs fois pour remplir la largeur
                          const marqueeContent = section.articles.length < 5 
                              ? [...section.articles, ...section.articles, ...section.articles, ...section.articles] 
                              : [...section.articles, ...section.articles];

                          return (
                            <section key={section.rubrique.id} className="pt-8 border-t border-dashed border-gray-200 dark:border-zinc-800 animate-in fade-in slide-in-from-bottom-4 duration-700 overflow-hidden">
                                
                                {/* --- Header de Section --- */}
                                <div className="flex flex-row items-center justify-between gap-4 mb-6 px-1">
                                    <h2 className="text-xl md:text-2xl font-black text-[#111] dark:text-white uppercase flex items-center gap-2">
                                        <span className="w-1.5 h-6 bg-[#3E7B52] rounded-full"></span>
                                        {section.rubrique.nom}
                                    </h2>
                                    <Link href={`/category/${section.rubrique.id}`}>
                                        <button className="text-xs font-bold text-gray-500 hover:text-[#3E7B52] flex items-center gap-1 transition-colors px-3 py-1 rounded-full border border-transparent hover:border-gray-200 dark:hover:border-zinc-800">
                                            Tout voir <ArrowRight size={12}/>
                                        </button>
                                    </Link>
                                </div>

                                {/* --- ZONE MARQUEE AUTOMATIQUE --- */}
                                {/* Mask CSS pour fondre les bords (optionnel pour l'élégance) */}
                                <div className="relative w-full [mask-image:_linear-gradient(to_right,transparent_0,_black_128px,_black_calc(100%-128px),transparent_100%)]">
                                    
                                    <div 
                                        className="flex gap-5 py-4 w-max animate-scroll hover:[animation-play-state:paused]"
                                        style={{ 
                                            // La vitesse s'ajuste selon le nombre d'éléments pour garder un rythme constant
                                            animationDuration: `${marqueeContent.length * 6}s` 
                                        }}
                                    >
                                        {marqueeContent.map((art, idx) => (
                                            <div 
                                                // La clé idx est nécessaire ici car on a dupliqué les articles (mêmes IDs)
                                                key={`${art.id}-${idx}`} 
                                                className="w-[280px] md:w-[300px] shrink-0" 
                                            >
                                                <LandingArticleCard 
                                                    article={art} 
                                                    // Tous la même taille compacte
                                                    imageHeight="h-40" 
                                                    className="h-full bg-white dark:bg-zinc-900 shadow-sm hover:shadow-lg hover:scale-[1.02] border border-gray-100 dark:border-zinc-800"
                                                />
                                            </div>
                                        ))}
                                    </div>

                                </div>
                            </section>
                          );
                        })
                    )}

                    {/* Styles Globaux injectés pour l'animation scroll */}
                    <style jsx global>{`
                        @keyframes scroll {
                            0% { transform: translateX(0); }
                            100% { transform: translateX(-50%); }
                        }
                        .animate-scroll {
                            animation: scroll 40s linear infinite;
                        }
                        /* Ajout d'une pause au survol pour permettre le clic facile */
                        .animate-scroll:hover {
                            animation-play-state: paused;
                        }
                    `}</style>

                    {/* ================================================================
                        3. CTA FOOTER
                    ================================================================ */}
                    <section className="bg-[#111] dark:bg-zinc-900 rounded-[2rem] p-8 md:p-12 text-center relative overflow-hidden shadow-2xl">
                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20"></div>
                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-green-500 to-yellow-500"></div>
                    
                    <div className="relative z-10 max-w-lg mx-auto space-y-6">
                        <h3 className="text-2xl md:text-3xl font-black text-white">
                        L'Afrique change, nos récits aussi.
                        </h3>
                        <p className="text-gray-400 text-sm md:text-base">
                        Rejoignez notre newsletter pour recevoir l'essentiel de l'économie et de la politique continentale.
                        </p>
                        <div className="flex flex-col sm:flex-row gap-3 justify-center pt-2">
                        <input 
                            type="email" 
                            placeholder="Email professionnel" 
                            className="h-11 px-6 rounded-full bg-white/10 border border-white/20 text-white placeholder:text-gray-500 outline-none focus:border-[#13EC13] focus:bg-white/20 w-full text-sm transition-all"
                        />
                        <Button className="h-11 px-8 rounded-full bg-[#13EC13] hover:bg-[#0fd60f] text-black font-bold text-sm">
                            S'inscrire
                        </Button>
                        </div>
                    </div>
                    </section>
                </main>
            </div>

            {/* --- SIDEBAR DROITE : CONSULTING --- */}
            <div className="hidden lg:block lg:col-span-3 sticky top-28 h-[calc(100vh-8rem)] overflow-y-auto no-scrollbar">
                <ConsultingSidebar />
            </div>

        </div>

        {/* --- MOBILE ONLY FOOTER LINKS --- */}
        <div className="lg:hidden mt-16 pt-8 border-t border-gray-200 dark:border-zinc-800 grid grid-cols-2 gap-4">
             <Link href="/intelligence-interculturelle" className="p-4 bg-green-50 dark:bg-green-900/10 rounded-xl text-center">
                 <h4 className="font-bold text-[#3E7B52] text-sm mb-1">Analyse</h4>
                 <p className="text-[10px] text-gray-500">Intelligence Interculturelle</p>
             </Link>
             <Link href="/consulting-cabinet" className="p-4 bg-gray-50 dark:bg-zinc-900 rounded-xl text-center">
                 <h4 className="font-bold text-gray-800 dark:text-gray-200 text-sm mb-1">Cabinet</h4>
                 <p className="text-[10px] text-gray-500">Services & Conseil</p>
             </Link>
        </div>

      </div>
      
      <Footer />
      <OnboardingTour /> 
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\globals.css
================================================================================

@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}



================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\app\layout.tsx
================================================================================

import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { AuthProvider } from "@/context/AuthContext";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "TODAYS Africa",
  description: "Bienvenue sur l'espace contributeur, votre voix est essentielle pour éclairer, informer et façonner l'avenir de l'Afrique.",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <AuthProvider>
          {children}
        </AuthProvider>
        
      </body>
    </html>
  );
}



================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\ui\Button.tsx
================================================================================

// FICHIER: components/ui/Button.tsx
import React from "react";
import { cn } from "@/lib/utils";

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: "primary" | "outline" | "ghost";
}

export const Button = ({ className, variant = "primary", ...props }: ButtonProps) => {
  const baseStyles = "h-12 w-full rounded-lg font-medium transition-all duration-200 flex items-center justify-center text-sm disabled:opacity-50 disabled:cursor-not-allowed";
  
  const variants = {
    primary: "bg-[#3E7B52] text-white hover:bg-[#326342] shadow-sm",
    outline: "border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300",
    ghost: "bg-transparent text-gray-600 hover:text-gray-900",
  };

  return (
    <button className={cn(baseStyles, variants[variant], className)} {...props} />
  );
};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\ui\Input.tsx
================================================================================

import React from "react";
import { cn } from "@/lib/utils";

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label: string;
  rightIcon?: React.ReactNode;
  onRightIconClick?: () => void;
}

export const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, label, rightIcon, onRightIconClick, ...props }, ref) => {
    return (
      <div className="flex flex-col gap-1.5 w-full">
        <label className="text-xs font-semibold text-gray-900 ml-0.5">
          {label}
        </label>
        <div className="relative">
          <input
            ref={ref}
            className={cn(
              "flex h-12 w-full rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#3E7B52] focus:border-transparent transition-all",
              className
            )}
            {...props}
          />
          {rightIcon && (
            <button
              type="button"
              onClick={onRightIconClick}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 cursor-pointer"
            >
              {rightIcon}
            </button>
          )}
        </div>
      </div>
    );
  }
);
Input.displayName = "Input";


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\ui\OnBoardingTour.tsx
================================================================================

"use client";

import React, { useEffect, useState, useRef } from 'react';
import { createPortal } from 'react-dom';
import { motion, AnimatePresence } from 'framer-motion'; // Installation nécessaire: npm install framer-motion
import { X, ChevronRight, Check, Sparkles } from 'lucide-react';
import { useAuth } from '@/context/AuthContext';
import { cn } from '@/lib/utils';

// --- CONFIGURATION DU CONTENU (DATA) ---
// IDs doivent correspondre aux IDs ajoutés dans le HTML des pages
export const TOUR_STEPS = {
  REDACTEUR: [
    {
      targetId: 'nav-dashboard-new-article',
      title: 'Commencez ici !',
      content: 'C\'est ici que vous rédigez vos chefs-d\'œuvre. Cliquez pour accéder à l\'éditeur.',
      position: 'right' as const,
    },
    {
      targetId: 'dashboard-stats-card',
      title: 'Suivez votre impact',
      content: 'Analysez les vues et commentaires de vos articles en temps réel.',
      position: 'bottom' as const,
    },
    {
        targetId: 'btn-action-profile',
        title: 'Gérez votre profil',
        content: 'Mettez à jour vos infos et notifications ici.',
        position: 'bottom' as const, // Adapté mobile
    }
  ],
  ADMIN: [
    {
        targetId: 'nav-dashboard-articles',
        title: 'Flux de Validation',
        content: 'Validez, publiez ou rejetez les articles soumis par votre équipe.',
        position: 'right' as const,
    },
    {
        targetId: 'nav-dashboard-users',
        title: 'Gestion d\'équipe',
        content: 'Ajoutez de nouveaux rédacteurs et supervisez les comptes.',
        position: 'right' as const,
    }
  ],
  USER: [
    {
        targetId: 'nav-categories',
        title: 'Explorez par thèmes',
        content: 'Politique, Économie... Filtrez l\'actualité selon vos intérêts.',
        position: 'bottom' as const,
    },
    {
        targetId: 'cta-subscribe',
        title: 'Ne manquez rien',
        content: 'Créez un compte pour commenter et sauvegarder vos lectures.',
        position: 'top' as const,
    }
  ]
};

type Step = { targetId: string; title: string; content: string; position: 'top'|'bottom'|'left'|'right' };

// --- LE COMPOSANT ---
export const OnboardingTour = () => {
  const { user } = useAuth();
  const [stepIndex, setStepIndex] = useState(0);
  const [isActive, setIsActive] = useState(false);
  const [targetRect, setTargetRect] = useState<DOMRect | null>(null);
  
  // Clé de stockage unique par rôle pour ne pas répéter le tour
  const storageKey = user ? `tody_tour_done_${user.role}` : `tody_tour_done_GUEST`;
  
  // Sélection des étapes selon le rôle
  const steps: Step[] = user 
    ? (user.role === 'ADMIN' || user.role === 'SUPER_ADMIN' ? TOUR_STEPS.ADMIN : TOUR_STEPS.REDACTEUR)
    : TOUR_STEPS.USER;

  useEffect(() => {
    // Vérification : A-t-on déjà fait le tour ?
    const isDone = localStorage.getItem(storageKey);
    // Petit délai pour laisser le UI se charger
    const timer = setTimeout(() => {
        if (!isDone) setIsActive(true);
    }, 1500);
    return () => clearTimeout(timer);
  }, [storageKey]);

  useEffect(() => {
    if (!isActive) return;

    const updatePosition = () => {
        const el = document.getElementById(steps[stepIndex]?.targetId);
        if (el) {
            setTargetRect(el.getBoundingClientRect());
            // Scroll smooth vers l'élément
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
            // Si l'élément n'est pas trouvé (ex: mobile menu fermé), on skip ou on attend
            // Pour la démo simple : on arrête
            console.warn(`Target ${steps[stepIndex]?.targetId} not found`);
        }
    };

    updatePosition();
    // Écouter le resize
    window.addEventListener('resize', updatePosition);
    return () => window.removeEventListener('resize', updatePosition);
  }, [stepIndex, isActive, steps]);

  const handleNext = () => {
    if (stepIndex < steps.length - 1) {
      setStepIndex(prev => prev + 1);
    } else {
      handleClose();
    }
  };

  const handleClose = () => {
    setIsActive(false);
    localStorage.setItem(storageKey, 'true');
  };

  if (!isActive || !targetRect || steps.length === 0) return null;

  // Calcul Position Popover
  const popoverStyles: React.CSSProperties = {
    position: 'fixed',
    zIndex: 100,
  };

  // Logique simple de positionnement (améliorable avec floating-ui)
  const margin = 15;
  const currentStep = steps[stepIndex];
  
  if (currentStep.position === 'right') {
      popoverStyles.top = targetRect.top;
      popoverStyles.left = targetRect.right + margin;
  } else if (currentStep.position === 'bottom') {
      popoverStyles.top = targetRect.bottom + margin;
      popoverStyles.left = targetRect.left;
  } 
  // ... autres positions à implémenter si besoin

  // Création d'un portail pour "sortir" du flux HTML normal et être au dessus de tout
  return createPortal(
    <div className="fixed inset-0 z-[9999] pointer-events-none">
        
      {/* 1. Backdrop (Fait le noir autour sauf sur l'élément) */}
      {/* SVG Mask Techique pour faire un trou propre */}
      <svg className="absolute inset-0 w-full h-full pointer-events-auto">
        <defs>
          <mask id="tour-mask">
            <rect x="0" y="0" width="100%" height="100%" fill="white" />
            <rect 
                x={targetRect.left - 5} 
                y={targetRect.top - 5} 
                width={targetRect.width + 10} 
                height={targetRect.height + 10} 
                rx="8" // Border radius du trou
                fill="black" 
            />
          </mask>
        </defs>
        <rect 
            x="0" y="0" width="100%" height="100%" 
            className="fill-black/60 dark:fill-black/80 transition-all duration-500 ease-out" 
            mask="url(#tour-mask)" 
        />
      </svg>

      {/* 2. Spotlight Border Animé (Anneau Vert autour de la cible) */}
      <motion.div
        layout
        className="absolute rounded-lg border-2 border-[#3E7B52] dark:border-[#13EC13] pointer-events-none shadow-[0_0_30px_-5px_rgba(62,123,82,0.6)] dark:shadow-[0_0_30px_-5px_rgba(19,236,19,0.5)]"
        initial={false}
        animate={{
            top: targetRect.top - 5,
            left: targetRect.left - 5,
            width: targetRect.width + 10,
            height: targetRect.height + 10,
        }}
        transition={{ type: "spring", stiffness: 300, damping: 30 }}
      />

      {/* 3. La Carte TIP (Interactive) */}
      <AnimatePresence mode='wait'>
        <motion.div
            key={stepIndex}
            initial={{ opacity: 0, y: 10, scale: 0.95 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -10, scale: 0.95 }}
            transition={{ duration: 0.3 }}
            style={popoverStyles}
            className="pointer-events-auto w-80 bg-white/95 dark:bg-zinc-900/95 backdrop-blur-xl border border-gray-200 dark:border-zinc-700 p-5 rounded-2xl shadow-2xl relative"
        >
            {/* Déco */}
            <div className="absolute -top-3 -left-3 bg-gradient-to-br from-[#3E7B52] to-green-600 dark:from-[#13EC13] dark:to-green-600 w-8 h-8 rounded-lg rotate-12 flex items-center justify-center text-white shadow-lg">
                <Sparkles size={16} />
            </div>

            <button 
                onClick={handleClose} 
                className="absolute top-3 right-3 text-gray-400 hover:text-red-500 transition-colors"
            >
                <X size={16} />
            </button>

            <div className="mt-2 space-y-2">
                <h4 className="font-extrabold text-lg text-gray-900 dark:text-white leading-tight">
                    {currentStep.title}
                </h4>
                <p className="text-sm text-gray-600 dark:text-zinc-300 leading-relaxed">
                    {currentStep.content}
                </p>
            </div>

            <div className="flex items-center justify-between mt-6 pt-4 border-t border-gray-100 dark:border-zinc-800">
                <div className="flex gap-1">
                    {steps.map((_, i) => (
                        <div 
                            key={i} 
                            className={cn(
                                "w-1.5 h-1.5 rounded-full transition-all duration-300",
                                i === stepIndex ? "bg-[#3E7B52] dark:bg-[#13EC13] w-4" : "bg-gray-300 dark:bg-zinc-700"
                            )} 
                        />
                    ))}
                </div>
                
                <button
                    onClick={handleNext}
                    className="flex items-center gap-2 bg-[#111] dark:bg-white text-white dark:text-black px-4 py-2 rounded-lg text-xs font-bold hover:opacity-90 transition-opacity"
                >
                    {stepIndex === steps.length - 1 ? 'Terminer' : 'Suivant'}
                    {stepIndex === steps.length - 1 ? <Check size={14}/> : <ChevronRight size={14}/>}
                </button>
            </div>
        </motion.div>
      </AnimatePresence>

    </div>
  , document.body);
};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\ui\ArticleCard.tsx
================================================================================

"use client";

import React, { useMemo } from "react";
import Image from "next/image";
import Link from "next/link";
import { cn, getImageUrl } from "@/lib/utils";
import { ArticleReadDto } from "@/types/article";
import { Clock, User, Eye, MessageCircle, Share2, Heart } from "lucide-react";
import { format, isValid } from "date-fns";
import { fr } from "date-fns/locale";

interface ArticleCardProps {
  article: ArticleReadDto;
  className?: string;
  imageHeight?: string; 
}

// Helper pour formater les gros chiffres (ex: 1200 -> 1.2k)
const compactNumber = (num?: number) => {
  if (num === undefined || num === null) return 0;
  return new Intl.NumberFormat("en-US", {
    notation: "compact",
    maximumFractionDigits: 1,
  }).format(num);
};

export default function ArticleCard({ article, className, imageHeight = "h-48" }: ArticleCardProps) {
  
  // 1. Logique d'image optimisée avec la nouvelle fonction utilitaire
  const imageUrl = useMemo(() => {
    // Priorité 1: Image de couverture
    if (article.imageCouvertureUrl) {
      return getImageUrl(article.imageCouvertureUrl);
    }

    // Priorité 2: Première image dans les blocs de contenu
    if (Array.isArray(article.blocsContenu)) {
        const firstImg = article.blocsContenu.find(b => b.type === 'IMAGE' && (b.url || b.contenu));
        if (firstImg) {
          return getImageUrl(firstImg.url || firstImg.contenu);
        }
    }
    
    // Fallback: Image par défaut
    return getImageUrl(null);
  }, [article.imageCouvertureUrl, article.blocsContenu]);

  // 2. Formatage de date sécurisé
  const formattedDate = useMemo(() => {
      if (!article.datePublication) return "Récemment";
      const dateObj = new Date(article.datePublication);
      return isValid(dateObj) 
        ? format(dateObj, 'dd MMM yyyy', { locale: fr }) 
        : "Date inconnue";
  }, [article.datePublication]);

  return (
    <Link 
      href={`/article/${article.id}`} 
      className={cn(
        "group flex flex-col h-full bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl overflow-hidden shadow-sm transition-all duration-300", 
        "hover:shadow-lg hover:-translate-y-1 hover:border-gray-200 dark:hover:border-[#13EC13]/30",
        className
      )}
    >
      {/* --- ZONE IMAGE --- */}
      <div className={cn("relative w-full bg-gray-200 dark:bg-zinc-800 overflow-hidden shrink-0", imageHeight)}>
        <Image 
          src={imageUrl} 
          alt={article.titre || "Image de l'article"}
          fill
          className="object-cover group-hover:scale-105 transition-transform duration-700 ease-out"
          unoptimized={true} 
        />
        
        <div className="absolute top-3 left-3 z-10">
             <span className="bg-white/95 dark:bg-black/90 backdrop-blur-md px-2.5 py-1 rounded-md text-[10px] font-black uppercase tracking-widest text-[#3E7B52] dark:text-[#13EC13] border border-gray-100 dark:border-zinc-800 shadow-sm">
                {article.rubriqueNom || "Actualité"}
             </span>
        </div>
      </div>
      
      {/* --- ZONE CONTENU --- */}
      <div className="p-5 flex flex-col flex-1 gap-3">
        {/* Titre */}
        <h3 className="text-lg font-bold text-gray-900 dark:text-white leading-snug line-clamp-2 group-hover:text-[#3E7B52] dark:group-hover:text-[#13EC13] transition-colors" title={article.titre}>
          {article.titre || "Sans titre"}
        </h3>
        
        {/* Extrait */}
        <p className="text-xs text-gray-500 dark:text-zinc-400 line-clamp-2 leading-relaxed">
          {article.description || "Cliquez pour découvrir cet article..."}
        </p>
        
        {/* --- STATS ROW (Nouveau Bloc) --- */}
        {/* On pousse ce bloc vers le bas grâce à 'mt-auto' pour aligner toutes les cartes */}
        <div className="flex items-center gap-4 mt-auto py-2 text-xs font-medium text-gray-400 dark:text-zinc-500">
             <div className="flex items-center gap-1" title="Vues">
                 <Eye size={14} className="group-hover:text-[#3E7B52] dark:group-hover:text-[#13EC13] transition-colors"/>
                 <span>{compactNumber(article.vues)}</span>
             </div>
             <div className="flex items-center gap-1" title="Commentaires">
                 <MessageCircle size={14} className="group-hover:text-blue-500 transition-colors"/>
                 <span>{compactNumber(article.commentaires)}</span>
             </div>
             <div className="flex items-center gap-1" title="Partages">
                 <Share2 size={14} className="group-hover:text-indigo-500 transition-colors"/>
                 <span>{compactNumber(article.partages)}</span>
             </div>
             {/* Note: 'favoris' n'étant pas dans ArticleReadDto par défaut, j'utilise un champ fictif ou partages ici, 
                 ajustez si votre backend renvoie bien 'favoris' ou 'likes' */}
             {/* <div className="flex items-center gap-1 ml-auto" title="Likes">
                 <Heart size={14} className="group-hover:text-red-500 transition-colors"/>
                 <span>{compactNumber(article.telechargements)}</span> 
             </div> */}
        </div>

        {/* Footer Card (Divider + Auteur + Date) */}
        <div className="pt-3 border-t border-gray-100 dark:border-zinc-800 flex items-center justify-between text-gray-400">
          
          <div className="flex items-center gap-2 max-w-[65%]">
            <span className="p-1 rounded-full bg-gray-50 dark:bg-zinc-800 text-[#3E7B52] dark:text-[#13EC13]">
               <User size={10}/>
            </span>
            <span className="text-[10px] font-semibold uppercase truncate text-gray-500 dark:text-zinc-400 group-hover:text-gray-800 dark:group-hover:text-zinc-200 transition-colors">
                {article.auteurNom || "Rédaction"}
            </span>
          </div>

          <span className="text-[10px] font-medium flex items-center gap-1.5 whitespace-nowrap bg-gray-50 dark:bg-zinc-800/50 px-2 py-1 rounded text-gray-500 dark:text-zinc-500">
            <Clock size={10} />
            {formattedDate}
          </span>
        </div>
      </div>
    </Link>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\ui\LandingCard.tsx
================================================================================

"use client";

import React, { useMemo } from "react";
import Image from "next/image";
import Link from "next/link";
import { cn, getImageUrl } from "@/lib/utils";
import { ArticleReadDto } from "@/types/article";
import { Clock, Eye, MessageCircle, User } from "lucide-react";
import { format, isValid } from "date-fns";
import { fr } from "date-fns/locale";

interface LandingArticleCardProps {
  article: ArticleReadDto;
  className?: string;
  imageHeight?: string; 
  hideDescription?: boolean; // Option pour gagner encore plus de place si besoin
}

// Helper pour formater les chiffres (1200 -> 1.2k)
const compactNumber = (num?: number) => {
  if (num === undefined || num === null) return 0;
  return new Intl.NumberFormat("en-US", {
    notation: "compact",
    maximumFractionDigits: 1,
  }).format(num);
};

export default function LandingArticleCard({ 
  article, 
  className, 
  imageHeight = "h-36", 
  hideDescription = false 
}: LandingArticleCardProps) {
  
  const imageUrl = useMemo(() => {
    if (article.imageCouvertureUrl) return getImageUrl(article.imageCouvertureUrl);
    if (Array.isArray(article.blocsContenu)) {
        const firstImg = article.blocsContenu.find(b => b.type === 'IMAGE' && (b.url || b.contenu));
        if (firstImg) return getImageUrl(firstImg.url || firstImg.contenu);
    }
    return getImageUrl(null);
  }, [article.imageCouvertureUrl, article.blocsContenu]);

  const formattedDate = useMemo(() => {
      if (!article.datePublication) return "";
      const dateObj = new Date(article.datePublication);
      return isValid(dateObj) ? format(dateObj, 'd MMM', { locale: fr }) : "";
  }, [article.datePublication]);

  return (
    <Link 
      href={`/article/${article.id}`} 
      className={cn(
        "group flex flex-col h-full bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-lg overflow-hidden shadow-sm transition-all duration-300", 
        "hover:shadow-md hover:border-[#3E7B52]/40 hover:-translate-y-0.5",
        className
      )}
    >
      {/* --- IMAGE AVEC BADGE INTÉGRÉ --- */}
      <div className={cn("relative w-full bg-gray-100 dark:bg-zinc-800 overflow-hidden shrink-0", imageHeight)}>
        <Image 
          src={imageUrl} 
          alt={article.titre || "Article"}
          fill
          className="object-cover group-hover:scale-105 transition-transform duration-500 ease-out"
          sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
          unoptimized
        />
        
        {/* Overlay ombré pour contraste badge */}
        <div className="absolute inset-x-0 top-0 h-10 bg-gradient-to-b from-black/40 to-transparent pointer-events-none" />

        <div className="absolute top-2 left-2 right-2 flex justify-between items-start">
             <span className="bg-white/95 dark:bg-black/80 backdrop-blur-[2px] px-2 py-0.5 rounded text-[9px] font-extrabold uppercase tracking-widest text-[#3E7B52] dark:text-[#13EC13] shadow-sm">
                {article.rubriqueNom?.substring(0, 15) || "Actu"}
             </span>
             {formattedDate && (
               <span className="text-[9px] font-bold text-white flex items-center gap-1 drop-shadow-md">
                 <Clock size={10} /> {formattedDate}
               </span>
             )}
        </div>
      </div>
      
      {/* --- CONTENU COMPACT --- */}
      <div className="p-3 flex flex-col flex-1">
        {/* Titre */}
        <h3 className="text-[13px] md:text-sm font-bold text-gray-900 dark:text-gray-100 leading-snug line-clamp-2 mb-1.5 group-hover:text-[#3E7B52] dark:group-hover:text-[#13EC13] transition-colors" title={article.titre}>
          {article.titre}
        </h3>
        
        {/* Extrait (optionnel ou très court) */}
        {!hideDescription && (
          <p className="text-[10px] text-gray-500 dark:text-gray-400 line-clamp-2 leading-relaxed mb-3">
            {article.description}
          </p>
        )}
        
        {/* Footer Minimaliste : Auteur à gauche, Stats à droite */}
        <div className="mt-auto flex items-center justify-between pt-2 border-t border-gray-50 dark:border-zinc-800/50">
           
           <div className="flex items-center gap-1.5 min-w-0 max-w-[50%]">
              <div className="w-5 h-5 rounded-full bg-gray-100 dark:bg-zinc-800 flex items-center justify-center shrink-0 text-[8px] text-gray-500">
                <User size={10} />
              </div>
              <span className="text-[10px] font-medium text-gray-400 truncate dark:text-zinc-500">
                {article.auteurNom?.split(" ").pop() || "Tody"}
              </span>
           </div>

           <div className="flex items-center gap-3 text-[10px] text-gray-400 dark:text-zinc-500 font-mono">
               <div className="flex items-center gap-1 group/stat" title="Vues">
                  <Eye size={12} className="group-hover/stat:text-[#3E7B52] transition-colors"/>
                  <span>{compactNumber(article.vues)}</span>
               </div>
               <div className="flex items-center gap-1 group/stat" title="Comms">
                  <MessageCircle size={12} className="group-hover/stat:text-blue-500 transition-colors"/>
                  <span>{compactNumber(article.commentaires)}</span>
               </div>
           </div>

        </div>
      </div>
    </Link>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\layout\Footer.tsx
================================================================================

"use client";

import React from "react";
import Link from "next/link";
import { ChevronDown, Globe } from "lucide-react";
import { APP_CONFIG, HOME_DATA } from "@/lib/constant";

export default function Footer() {
  return (
    <footer className="mt-auto border-t border-gray-100 dark:border-zinc-800 bg-[#FBFBFB] dark:bg-black py-16 px-6 md:px-12 w-full">
      <div className="max-w-[1400px] mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 lg:gap-8">
        
        <div className="flex flex-col gap-4">
          <div className="flex items-center gap-2">
             <Globe className="w-5 h-5 text-[#3E7B52] dark:text-[#13EC13]" />
             <h4 className="font-black text-sm uppercase tracking-wider text-black dark:text-white">
                {APP_CONFIG.name}
             </h4>
          </div>
          <p className="text-xs text-gray-500 dark:text-zinc-400 leading-relaxed max-w-xs">
            {HOME_DATA.footer.description}
          </p>
          
          {/* Devise de l'application */}
          <div className="mt-4 space-y-2">
            <div className="text-[10px] font-bold text-[#3E7B52] dark:text-[#13EC13] uppercase tracking-wider">
              Notre Mission
            </div>
            <div className="space-y-1 text-[10px] text-gray-600 dark:text-zinc-400 leading-relaxed">
              <div>AIDER L'AFRIQUE À MIEUX CONNAÎTRE</div>
              <div>AIDER L'AFRIQUE À MIEUX SE CONNAÎTRE</div>
              <div>AIDER À MIEUX CONNAÎTRE L'AFRIQUE</div>
            </div>
          </div>
        </div>

        {/* Colonne Sections Dynamique via le navLinks principal */}
        <div className="flex flex-col gap-4">
          <h4 className="font-bold text-xs uppercase tracking-wider text-black dark:text-white">
            Sections
          </h4>
          <ul className="space-y-2.5">
            {HOME_DATA.navLinks.slice(0, 5).map((item) => (
              <li key={item.slug}>
                <Link href={`/category/${item.slug}`} className="text-xs text-gray-500 hover:text-black dark:text-zinc-400 dark:hover:text-white transition-colors">
                  {item.label}
                </Link>
              </li>
            ))}
          </ul>
        </div>

        <div className="flex flex-col gap-4">
          <h4 className="font-bold text-xs uppercase tracking-wider text-black dark:text-white">
            À propos
          </h4>
          <ul className="space-y-2.5">
            {HOME_DATA.footer.about.map((item) => (
              <li key={item}>
                <Link href="#" className="text-xs text-gray-500 hover:text-black dark:text-zinc-400 dark:hover:text-white transition-colors">
                  {item}
                </Link>
              </li>
            ))}
          </ul>
        </div>

        <div className="flex flex-col gap-4">
          <h4 className="font-bold text-xs uppercase tracking-wider text-black dark:text-white">
            Langue
          </h4>
          <div className="relative max-w-[180px]">
            <select className="w-full appearance-none bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-700 text-gray-700 dark:text-gray-300 text-xs font-medium py-2.5 px-4 rounded hover:border-gray-400 focus:outline-none cursor-pointer">
              <option>Français</option>
              <option>English</option>
            </select>
            <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400" size={14} />
          </div>
        </div>
      </div>

      <div className="max-w-[1400px] mx-auto mt-16 pt-8 border-t border-gray-100 dark:border-zinc-800 flex justify-between items-center">
          <p className="text-[10px] text-gray-400 dark:text-zinc-600">
              © {APP_CONFIG.year} {APP_CONFIG.name}. Tous droits réservés.
          </p>
          <div className="flex gap-4">
             <Link href="#" className="text-[10px] text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">À propos</Link>
             <Link href="#" className="text-[10px] text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">Contact</Link>
             <Link href="#" className="text-[10px] text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">Politique de confidentialité</Link>
          </div>
      </div>
    </footer>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\layout\Navbar.tsx
================================================================================

// FICHIER: components/layout/Navbar.tsx
"use client";

import React, { useEffect, useState } from "react";
import Link from "next/link";
import { ArrowRight, ChevronDown, Globe, LayoutGrid, Menu, UserIcon, X } from "lucide-react";
import { Button } from "@/components/ui/Button";
import { APP_CONFIG } from "@/lib/constant";
import { PublicService } from "@/services/public";
import { Rubrique } from "@/types/article";
import { useRouter } from "next/navigation";
import { useAuth } from "@/context/AuthContext";

export default function Navbar() {
  const [rubriques, setRubriques] = useState<Rubrique[]>([]);
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const { user } = useAuth(); // Utilisation du contexte Auth
  const router = useRouter();
  
  // Hook de fetch simple au montage
  useEffect(() => {
    const fetchMenu = async () => {
        try {
            console.log("🧩 Chargement du Menu...");
            const all = await PublicService.getRubriques();
            
            // On filtre pour n'afficher que les parents (Niveau 1)
            // On peut aussi trier par 'ordre' si votre backend le gère
            const roots = all.filter(r => r.parentId === null); // .sort((a,b) => a.ordre - b.ordre)
            
            // Sécurité : On ne prend que les 7 premiers pour éviter de casser le design
            // Les autres pourraient aller dans un "Plus..."
            setRubriques(roots); // slice(0, 7) si besoin
        } catch (e) {
            console.error("Erreur chargement menu Navbar", e);
        }
    };
    fetchMenu();
  }, []);

  // --- 🔥 LOGIQUE DE REDIRECTION INTELLIGENTE ---
  const handleActionClick = () => {
      if (user) {
          // Si Staff (Rédacteur/Admin) -> Dashboard
          if (['REDACTEUR', 'ADMIN', 'SUPER_ADMIN'].includes(user.role)) {
              router.push("/dashboard");
          } else {
              // Si Utilisateur lambda -> Page Profil Lecteur
              router.push("/profil");
          }
      } else {
          // Si non connecté -> Login/Register
          router.push("/login");
      }
  };

    // 🔢 Séparation pour l'affichage (5 max + Dropdown)
  const VISIBLE_COUNT = 5;
  const visibleRubriques = rubriques.slice(0, VISIBLE_COUNT);
  const hiddenRubriques = rubriques.slice(VISIBLE_COUNT);
  const hasMore = hiddenRubriques.length > 0;

  return (
    <>
    <nav className="sticky top-0 z-50 w-full bg-white/80 dark:bg-[#0a0a0a]/80 backdrop-blur-md border-b border-gray-100 dark:border-zinc-800 py-3 px-6 md:px-12 flex items-center justify-between transition-all duration-300">
      
      {/* 1. LOGO */}
      <Link href="/" className="flex items-center gap-3 group mr-8 shrink-0">
        <div className="bg-[#111] dark:bg-white text-white dark:text-black p-1.5 rounded-lg shadow-lg group-hover:rotate-12 transition-transform duration-300">
          <Globe size={22} strokeWidth={2.5} />
        </div>
        <span className="font-black text-xl tracking-tighter text-black dark:text-white uppercase hidden sm:block">
            {APP_CONFIG.name}
        </span>
      </Link>
      {/* 3. LIENS RUBRIQUES (Desktop) */}
      <div id="nav-categories" className="hidden lg:flex items-center gap-6 ml-8">
        {rubriques.length === 0 ? (
            <div className="flex gap-4 animate-pulse">
                {[1,2,3,4].map(i => <div key={i} className="h-2 w-16 bg-gray-200 dark:bg-zinc-800 rounded"></div>)}
            </div>
        ) : (
            <>
                {/* Rubriques visibles directes */}
                {visibleRubriques.map((rub) => (
                    <Link 
                        key={rub.id} 
                        href={`/category/${rub.id}`}
                        className="text-[11px] font-bold uppercase tracking-wide text-gray-500 hover:text-[#3E7B52] dark:text-gray-400 dark:hover:text-white relative group py-2"
                    >
                        {rub.nom}
                        <span className="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-[#3E7B52] dark:bg-white transition-all duration-300 group-hover:w-full"></span>
                    </Link>
                ))}

                {/* Dropdown "Voir plus" */}
                {hasMore && (
                    <div className="relative group py-2">
                        <button className="flex items-center gap-1 text-[11px] font-bold uppercase tracking-wide text-gray-500 hover:text-[#3E7B52] dark:text-gray-400 dark:hover:text-white">
                            Plus <ChevronDown size={14} />
                        </button>
                        
                        {/* Menu déroulant */}
                        <div className="absolute top-full right-0 mt-2 w-56 bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 translate-y-2 group-hover:translate-y-0 p-2 grid gap-1">
                            {/* Titre optionnel */}
                            <div className="px-3 py-2 text-[10px] font-black uppercase text-gray-300 dark:text-zinc-600 tracking-wider">
                                Autres Rubriques
                            </div>
                            
                            {/* Liste Cachée */}
                            {hiddenRubriques.map((rub) => (
                                <Link 
                                    key={rub.id} 
                                    href={`/category/${rub.id}`}
                                    className="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-zinc-800 hover:text-[#3E7B52] dark:hover:text-[#13EC13] rounded-lg transition-colors"
                                >
                                    <LayoutGrid size={14} />
                                    {rub.nom}
                                </Link>
                            ))}
                        </div>
                    </div>
                )}
            </>
        )}
      </div>


 {/* 4. ACTIONS */}
      <div className="flex items-center gap-3 md:gap-4 shrink-0">
        
        {/* Affichage conditionnel Bouton Connexion */}
        {!user && (
            <Link href="/login" className="hidden sm:block">
                <Button variant="outline" className="h-9 px-5 text-xs font-bold border-gray-200 dark:border-zinc-700">
                    CONNEXION
                </Button>
            </Link>
        )}
        
        {/* Bouton Intelligent : Profil ou Abonnement */}
        <Button 
          id={user ? "btn-action-profile" : "cta-subscribe"} // ✅ ID dynamique
          onClick={handleActionClick}
          className="h-9 px-5 bg-[#3E7B52] hover:bg-[#326342] text-white rounded-lg text-xs font-bold uppercase shadow-lg shadow-green-900/20 flex items-center gap-2"
        >
          {user ? (
            <>
                <UserIcon size={14} /> 
                <span className="max-w-[100px] truncate">Mon Profil</span>
            </>
          ) : (
            "S'abonner"
          )}
        </Button>
        
        {/* Menu Mobile Toggle */}
        <button className="lg:hidden p-2 hover:bg-gray-100 dark:hover:bg-zinc-800 rounded" onClick={() => setMobileMenuOpen(true)}>
          <Menu size={24} />
        </button>
      </div>
    </nav>

    {/* 4. MENU MOBILE FULLSCREEN OVERLAY */}
    {mobileMenuOpen && (
        <div className="fixed inset-0 z-[60] bg-white dark:bg-black animate-in slide-in-from-right duration-300 flex flex-col">
            
            {/* Header Mobile */}
            <div className="flex justify-between items-center p-6 border-b border-gray-100 dark:border-zinc-900">
                <span className="font-black text-xl tracking-tighter uppercase">{APP_CONFIG.name}</span>
                <button 
                    onClick={() => setMobileMenuOpen(false)}
                    className="p-2 bg-gray-100 dark:bg-zinc-900 rounded-full"
                >
                    <X size={24}/>
                </button>
            </div>

            {/* Links Mobile */}
            <div className="flex-1 overflow-y-auto p-6 flex flex-col gap-6">
                {/* Nouveaux boutons principaux en mobile */}
                <Link 
                    href="/intelligence-interculturelle"
                    onClick={() => setMobileMenuOpen(false)}
                    className="text-lg font-bold uppercase text-blue-600 dark:text-blue-400 flex items-center justify-between border-b border-blue-100 dark:border-blue-900 pb-4"
                >
                    Intelligence Interculturelle
                    <ArrowRight size={20} className="-rotate-45 text-blue-300"/>
                </Link>
                
                <Link 
                    href="/"
                    onClick={() => setMobileMenuOpen(false)}
                    className="text-lg font-bold uppercase text-green-600 dark:text-green-400 flex items-center justify-between border-b border-green-100 dark:border-green-900 pb-4"
                >
                    Écran Principal (Actualité)
                    <ArrowRight size={20} className="-rotate-45 text-green-300"/>
                </Link>
                
                <Link 
                    href="/consulting-cabinet"
                    onClick={() => setMobileMenuOpen(false)}
                    className="text-lg font-bold uppercase text-purple-600 dark:text-purple-400 flex items-center justify-between border-b border-purple-100 dark:border-purple-900 pb-4"
                >
                    Consulting Cabinet
                    <ArrowRight size={20} className="-rotate-45 text-purple-300"/>
                </Link>
                
                {/* Séparateur */}
                <div className="border-t border-gray-200 dark:border-zinc-800 my-4"></div>
                
                {/* Rubriques existantes */}
                {rubriques.map(rub => (
                    <Link 
                        key={rub.id} 
                        href={`/category/${rub.id}`}
                        onClick={() => setMobileMenuOpen(false)}
                        className="text-xl font-bold uppercase text-gray-800 dark:text-white flex items-center justify-between border-b border-gray-50 dark:border-zinc-900 pb-4"
                    >
                        {rub.nom}
                        <ArrowRight size={20} className="-rotate-45 text-gray-300"/>
                    </Link>
                ))}
                
                <div className="mt-8 flex flex-col gap-4">
                    <Link href="/login" onClick={() => setMobileMenuOpen(false)}>
                        <Button variant="outline" className="h-12 text-sm font-bold w-full justify-center">Espace Rédacteur</Button>
                    </Link>
                    <Button className="h-12 text-sm font-bold w-full justify-center bg-[#3E7B52]">S'abonner au Premium</Button>
                </div>
            </div>
        </div>
    )}
    </>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\layout\InterculturalSidebar.tsx
================================================================================

// FICHIER: components/home/InterculturelSidebar.tsx
"use client";

import React, { useEffect, useState } from "react";
import Link from "next/link";
import Image from "next/image";
import { Brain, ArrowRight, BookOpen, Sparkles, TrendingUp } from "lucide-react";
import { PublicService } from "@/services/public";
import { ArticleReadDto } from "@/types/article";
import { PageResponse } from "@/types/dashboard";
import { cn, getImageUrl } from "@/lib/utils";

export default function InterculturelSidebar() {
  const [articles, setArticles] = useState<ArticleReadDto[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchArticles = async () => {
      try {
        const response: PageResponse<ArticleReadDto> = await PublicService.getAdminArticles(0, 4);
        setArticles(response.content || []);
      } catch (error) {
        console.error("Erreur Interculturel Sidebar:", error);
      } finally {
        setLoading(false);
      }
    };
    fetchArticles();
  }, []);

  return (
    <aside className="w-full h-full flex flex-col gap-6 animate-in fade-in slide-in-from-left-4 duration-700">
      
      {/* --- En-tête de section --- */}
      <div className="bg-gray-100 text-gray-900 dark:bg-zinc-900 p-6 rounded-2xl relative overflow-hidden group shadow-lg">
        <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full blur-2xl -mr-10 -mt-10 group-hover:bg-[#13EC13]/10 transition-colors duration-500"></div>
        
        <div className="relative z-10 space-y-4">
          <div className="flex items-center gap-3">
             <div className="p-2.5 bg-white/10 backdrop-blur-md rounded-xl shadow-inner border border-white/5">
                <Brain className="text-[#3E7B52] w-5 h-5 animate-pulse" />
             </div>
             <span className="text-[10px] font-bold text-[#3E7B52] tracking-widest uppercase border border-[#13EC13]/20 px-2 py-0.5 rounded-full bg-[#13EC13]/5">
                Editorial
             </span>
          </div>
          
          <div>
            <h3 className="text-xl font-extrabold text-zinc-900 dark:text-white leading-tight">
              Intelligence Interculturelle
            </h3>
            <p className="text-xs text-gray-400 mt-2 leading-relaxed">
              Analyses expertes et théories sur les dynamiques culturelles africaines.
            </p>
          </div>

          <Link href="/intelligence-interculturelle">
            <button className="text-xs font-bold text-gray-600 dark:text-white flex items-center gap-2 group-hover:gap-3 transition-all hover:text-[#13EC13]">
              Découvrir la théorie <ArrowRight size={14} />
            </button>
          </Link>
        </div>
      </div>

      {/* --- Liste des Articles --- */}
      <div className="flex flex-col gap-4">
        <h4 className="flex items-center gap-2 text-xs font-black uppercase tracking-widest text-gray-500 dark:text-gray-400 px-1">
            <TrendingUp size={14} className="text-[#3E7B52]" /> Dernières Analyses
        </h4>

        {loading ? (
           Array.from({ length: 3 }).map((_, i) => (
             <div key={i} className="flex gap-3 items-center animate-pulse">
                <div className="w-16 h-16 rounded-lg bg-gray-200 dark:bg-zinc-800 shrink-0"></div>
                <div className="space-y-2 flex-1">
                   <div className="h-3 bg-gray-200 dark:bg-zinc-800 rounded w-full"></div>
                   <div className="h-2 bg-gray-200 dark:bg-zinc-800 rounded w-2/3"></div>
                </div>
             </div>
           ))
        ) : (
           articles.map((article, idx) => (
             <Link href={`/article/${article.id}`} key={article.id} className="group">
                <div className="p-3 bg-white dark:bg-transparent border border-gray-100 dark:border-transparent rounded-xl hover:border-[#3E7B52]/30 dark:hover:border-[#3E7B52]/50 hover:shadow-md transition-all duration-300 flex gap-3 items-start">
                    
                    {/* Miniature */}
                    <div className="relative w-16 h-16 rounded-lg overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-700">
                        <Image 
                           src={getImageUrl(article.imageCouvertureUrl)} 
                           alt={article.titre}
                           fill
                           className="object-cover group-hover:scale-110 transition-transform duration-500"
                        />
                    </div>
                    
                    {/* Texte */}
                    <div className="flex-1 min-w-0">
                        <h5 className="text-xs font-bold text-gray-800 dark:text-gray-200 mt-1 leading-snug line-clamp-3 group-hover:text-[#3E7B52] transition-colors">
                            {article.titre}
                        </h5>
                    </div>
                </div>
             </Link>
           ))
        )}
      </div>

      {/* --- Widget Newsletter rapide --- */}
      <div className="mt-auto bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-100 dark:border-yellow-900/30 p-4 rounded-xl">
         <div className="flex items-start gap-3">
             <Sparkles size={16} className="text-yellow-600 dark:text-yellow-500 mt-1"/>
             <div>
                 <h4 className="text-xs font-bold text-yellow-800 dark:text-yellow-400 uppercase">Newsletter Expert</h4>
                 <p className="text-[10px] text-yellow-700 dark:text-yellow-500/80 mt-1">
                    Recevez chaque semaine le condensé de l'intelligence interculturelle.
                 </p>
             </div>
         </div>
      </div>

    </aside>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\layout\ConsultingSidebar.tsx
================================================================================

// FICHIER: components/layout/ConsultingSidebar.tsx
"use client";

import React, { useState } from "react";
import Link from "next/link";
import { 
  Building2, MapPin, Users, Briefcase, 
  ShieldCheck, Network, ChevronRight, UserPlus, 
  Sparkles, Laptop, Mail, Phone, ArrowUpRight,
  CheckCircle2, Award, Globe2, TrendingUp
} from "lucide-react";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/Button";

// --- DONNÉES STRUCTURÉES ---
const COMPANY_INFO = {
  name: "Consulting Cabinet ",
  tagline: "Cabinet de Today's Africa Consulting Group",
  positions: "12 postes ouverts",
  locations: ["Yaoundé", "Moscou"],
  founded: "2020",
  employees: "50+ experts"
};

const LEADERSHIP = [
  { name: "Cécile M. BOKALLI", role: "Directrice Générale Yaoundé", loc: "Yaoundé", avatar: "CB" },
  { name: "Ingrida KIM", role: "Directrice Générale Moscou", loc: "Moscou", avatar: "IK" }
];

const DEPARTMENTS = [
  { 
    icon: Network, 
    name: "Intelligence & Analyse", 
    teams: ["Desk Afrique", "Recherche BRICS", "Intelligence de Marché"],
    hiring: true
  },
  { 
    icon: Sparkles, 
    name: "Contenu & Marketing", 
    teams: ["Éditorial", "Stratégie Digitale", "Design de Marque"],
    hiring: true
  },
  { 
    icon: ShieldCheck, 
    name: "Juridique & Conformité", 
    teams: ["Droit des Affaires", "Affaires Internationales"],
    hiring: false
  },
  { 
    icon: Laptop, 
    name: "Technologie & Data", 
    teams: ["Développement", "Data Science", "Cybersécurité"],
    hiring: true
  }
];

const BENEFITS = [
  "Télétravail prioritaire",
  "Salaire compétitif",
  "Exposition internationale",
  "Formation continue",
  "Équipe multiculturelle",
  "Projets stratégiques"
];


export default function ConsultingSidebar() {
  const [expandedDept, setExpandedDept] = useState<number | null>(null);

  return (
    <aside className="w-full h-full overflow-hidden flex flex-col gap-5 p-0 bg-transparent">
        
      {/* --- 1. EN-TÊTE ENTREPRISE --- */}
      <div className="space-y-4">
        <div className="flex items-start gap-4">
          <div className="w-14 h-14 bg-[#3E7B52] hover:bg-[#326342] rounded-2xl flex items-center justify-center shadow-lg">
            <Building2 size={28} className="text-white" strokeWidth={2}/>
          </div>
          <div className="flex-1 min-w-0">
            <h2 className="text-lg font-bold text-gray-900 dark:text-white leading-tight">
              {COMPANY_INFO.name}
            </h2>
            <p className="text-sm text-gray-500 dark:text-gray-400 mt-0.5">
              {COMPANY_INFO.tagline}
            </p>
          </div>
        </div>

        <div className="flex items-center justify-between text-sm">
          <div className="flex ml-0 items-center gap-2 text-gray-600 dark:text-gray-400">
            <MapPin size={14} className="text-emerald-600 dark:text-emerald-500"/>
            <span className="text-xs">{COMPANY_INFO.locations.join(" • ")}</span>
          </div>
        </div>
      </div>

      <div className="h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-zinc-800 to-transparent"/>

      {/* --- 2. LEADERSHIP --- */}
      <div className="space-y-3">
        <h3 className="text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 flex items-center gap-2">
          <Users size={14}/>
          Direction Générale
        </h3>
        
        <div className="space-y-2">
          {LEADERSHIP.map((leader, i) => (
            <div key={i} className="flex items-center gap-3 p-3 rounded-xl bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 hover:border-emerald-200 dark:hover:border-emerald-800 transition-colors">
              <div className="w-10 h-10 bg-gradient-to-br from-gray-200 to-gray-300 dark:from-zinc-700 dark:to-zinc-600 rounded-full flex items-center justify-center">
                <span className="text-sm font-bold text-gray-700 dark:text-gray-200">{leader.avatar}</span>
              </div>
              <div className="flex-1 min-w-0">
                <p className="text-sm font-semibold text-gray-900 dark:text-white truncate">{leader.name}</p>
                <p className="text-xs text-gray-500 dark:text-gray-400 truncate">{leader.role}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
      <div className="h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-zinc-800 to-transparent"/>

      {/* --- 4. AVANTAGES --- */}
      <div className="space-y-3">
        <h3 className="text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400">
          Pourquoi Nous Rejoindre
        </h3>
        <div className="grid grid-cols-2 gap-2">
          {BENEFITS.map((benefit, i) => (
            <div key={i} className="flex items-start gap-2 text-xs text-gray-600 dark:text-gray-400">
              <CheckCircle2 size={12} className="text-emerald-600 dark:text-emerald-500 mt-0.5 shrink-0"/>
              <span>{benefit}</span>
            </div>
          ))}
        </div>
      </div>

      {/* --- 5. CTA --- */}
      <Link href="/consulting-cabinet#apply" className="block">
        <Button className="w-full h-12 bg-[#3E7B52] hover:bg-[#326342] text-white rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 group">
          <UserPlus size={18} className="group-hover:scale-110 transition-transform"/>
          <span className="font-semibold">Postuler chez Today's Africa</span>
        </Button>
      </Link>

      {/* --- 6. CONTACT --- */}
      <div className="pt-3 border-t border-gray-200 dark:border-zinc-800">
        <div className="flex items-center justify-center gap-4 text-xs text-gray-500 dark:text-gray-400">
          <a href="mailto:careers@tacg.com" className="flex items-center gap-1.5 hover:text-emerald-600 dark:hover:text-emerald-500 transition-colors">
            <Mail size={12}/>
            <span>todays@blog.com</span>
          </a>
          <div className="w-px h-4 bg-gray-300 dark:bg-zinc-700"/>
          <a href="tel:+237" className="flex items-center gap-1.5 hover:text-emerald-600 dark:hover:text-emerald-500 transition-colors">
            <Phone size={12}/>
            <span>699 888 777</span>
          </a>
        </div>
      </div>

    </aside>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\new-article\EditorContent.tsx
================================================================================

"use client";

import React, { useEffect } from 'react';
import { useEditor, EditorContent } from '@tiptap/react';
import StarterKit from '@tiptap/starter-kit';
import ImageExtension from '@tiptap/extension-image';
import LinkExtension from '@tiptap/extension-link';
import Placeholder from '@tiptap/extension-placeholder';

interface EditorProps {
  setEditorRef: (editor: any) => void;
  onChange: (html: string) => void;
  initialContent?: string; // Ajout de la prop
}

export default function EditorContentComp({ setEditorRef, onChange, initialContent }: EditorProps) {
  const editor = useEditor({
    immediatelyRender: false,
    extensions: [
      StarterKit.configure({
        // Désactive l'extension CodeBlock par défaut si besoin
      }),
      // Configuration explicite Link qui est standard
      LinkExtension.configure({
        openOnClick: false,
        autolink: true,
      }),
      ImageExtension.configure({
        inline: true,
        allowBase64: true,
        HTMLAttributes: {
            class: 'rounded-lg border border-gray-100 shadow-sm max-w-full my-4 block',
        },
      }),
      Placeholder.configure({
        placeholder: "Commencez votre article...",
      })
    ],
    editorProps: {
        attributes: {
            class: 'prose prose-sm sm:prose-base lg:prose-lg xl:prose-2xl m-5 focus:outline-none dark:prose-invert max-w-none text-gray-800 dark:text-gray-200 min-h-[500px]',
        },
        transformPastedHTML(html) { return html; }
    },
    onUpdate: ({ editor }) => {
      onChange(editor.getHTML());
    },
    onCreate: ({ editor }) => {
      setEditorRef(editor);
    },
  });

  useEffect(() => {
    return () => {
        if (editor) editor.destroy();
    }
  }, [editor]);

  // Correction ici : On utilise la variable 'initialContent' destructurée, pas 'props.initialContent'
  useEffect(() => {
    if (editor && initialContent) {
        // On ne set le contenu que si l'éditeur est vide pour ne pas écraser une saisie en cours en cas de re-render
        if(editor.isEmpty) {
            editor.commands.setContent(initialContent);
        }
    }
  }, [editor, initialContent]);

  if (!editor) {
    return (
        <div className="flex items-center justify-center h-64 text-gray-400 text-sm">
            Chargement de votre éditeur...
        </div>
    );
  }

  return (
    <div className="flex-1 bg-white dark:bg-zinc-900 cursor-text" onClick={() => editor?.chain().focus().run()}>
      <EditorContent editor={editor} />
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\new-article\ArticleSettings.tsx
================================================================================

// FICHIER: components/dashboard/new-article/ArticleSettings.tsx - UPLOAD CORRIGÉ

"use client";

import React, { useEffect, useState } from "react";
import Image from "next/image";
import { 
  UploadCloud, ImageIcon, Loader2, AlertCircle, Plus, 
  ChevronDown, Check, Search, X, RefreshCw, 
  CornerDownRight, Globe, MapPin, Sparkles, Trash2, Tag, Wand2
} from "lucide-react";
import { cn, getImageUrl } from "@/lib/utils";
import { ArticleService } from "@/services/article";
import { Rubrique } from "@/types/article";

// RÉGIONS
const TARGET_REGIONS = [
  { id: "GLOBAL", label: "🌍 Afrique (Global)" },
  { id: "AFRIQUE_OUEST", label: "📍 Afrique de l'Ouest" },
  { id: "AFRIQUE_CENTRALE", label: "📍 Afrique Centrale" },
  { id: "AFRIQUE_EST", label: "📍 Afrique de l'Est" },
  { id: "AFRIQUE_NORD", label: "📍 Afrique du Nord" },
  { id: "AFRIQUE_SUD", label: "📍 Afrique Australe" },
];

interface ArticleSettingsProps {
  titre: string;
  setTitre: (v: string) => void;
  description: string;
  setDescription: (v: string) => void;
  rubriqueId: number | null;
  setRubriqueId: (v: number) => void;
  coverImageId: string | number | null; 
  setCoverImageId: (v: string | number | null) => void; 
  coverImageUrl: string | null;
  setCoverImageUrl: (v: string | null) => void;
  region: string;
  setRegion: (v: string) => void;
    // ✅ Nouvelles Props Tags
  tags: string[];
  setTags: (t: string[]) => void;
  onAutoTag: () => Promise<void>; // Fonction pour déclencher l'IA
  isAutoTagging: boolean;
}

export default function ArticleSettings(props: ArticleSettingsProps) {
  
  const [flatRubriques, setFlatRubriques] = useState<Rubrique[]>([]);
  const [isRubriqueLoading, setIsRubriqueLoading] = useState(false);
  const [isDropdownOpen, setIsDropdownOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");
  const [isCreating, setIsCreating] = useState(false);
  const [newName, setNewName] = useState("");
  const [isUploading, setIsUploading] = useState(false);
  const [uploadError, setUploadError] = useState<string | null>(null);
  const [tagInput, setTagInput] = useState("");

  // Chargement rubriques
  useEffect(() => {
    loadRubriques();
  }, []);

  // --- LOGIQUE PREVIEW PAR ID (Cas Edition sans URL) ---
  // Si on charge un article existant, on a souvent juste l'ID au début, donc on fetch l'URL via getMedia
  useEffect(() => {
    // On fetch uniquement si on a un ID, pas d'URL et qu'on ne vient pas d'uploader
    if (props.coverImageId && !props.coverImageUrl && !isUploading) {
        console.log("🔄 Récupération de l'image de couverture depuis l'ID:", props.coverImageId);
        ArticleService.getMedia(props.coverImageId)
            .then(media => {
                console.log("🖼️ Media récupéré:", media);
                props.setCoverImageUrl(media.urlAcces);
            })
            .catch(err => console.warn("Erreur chargement preview image", err));
    }
  }, [props.coverImageId]); 

  const loadRubriques = async () => {
    setIsRubriqueLoading(true);
    try {
      const tree = await ArticleService.getRubriquesTree();
      if (!Array.isArray(tree)) return;

      const flat: Rubrique[] = [];
      const flatten = (nodes: Rubrique[]) => {
        nodes.forEach(node => {
          if (node) {
            flat.push(node);
            if (node.enfants) flatten(node.enfants);
          }
        });
      };
      flatten(tree);
      setFlatRubriques(flat);
    } catch (e) { 
      console.error("❌ Erreur chargement rubriques", e);
    } finally { 
      setIsRubriqueLoading(false); 
    }
  };

  const handleCreateRubrique = async () => {
    if (!newName.trim()) return;
    setIsRubriqueLoading(true);
    try {
      const res = await ArticleService.createRubrique(newName);
      if (res && res.id) {
        props.setRubriqueId(res.id);
        setNewName("");
        setIsCreating(false);
        setIsDropdownOpen(false);
        loadRubriques();
      }
    } catch (e) { 
      alert("Erreur lors de la création de la rubrique."); 
    } finally { 
      setIsRubriqueLoading(false); 
    }
  };

  // --- 🔥 C'EST ICI QUE CA SE JOUE : UPLOAD HANDLER ---
  const handleCoverUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    // Reset UI
    setIsUploading(true);
    setUploadError(null);

    try {
        console.log("🚀 Start Cover Upload...");
        
        // 1. Upload
        const media = await ArticleService.uploadMedia(file);
        
        // 2. Set ID (si backend renvoie UUID ou int, on stocke)
        props.setCoverImageId(media.id); 
        
        // 3. Set URL de Preview immédiatement
        // C'est vital: l'UI réagit à props.coverImageUrl, pas à l'ID
        console.log("📸 Mise à jour UI avec URL:", media.urlAcces);
        props.setCoverImageUrl(media.urlAcces);

    } catch (err: any) {
        console.error("Erreur Component Upload:", err);
        setUploadError("Erreur serveur lors de l'envoi.");
    } finally {
        setIsUploading(false);
        e.target.value = ""; // Allow re-upload same file
    }
  };

  const handleRemoveCover = (e: React.MouseEvent) => {
    e.stopPropagation();
    props.setCoverImageUrl(null);
    props.setCoverImageId(null);
  };

  // HELPERS
  const filteredRubriques = flatRubriques.filter(r => 
    (r.nom || "").toLowerCase().includes(searchTerm.toLowerCase())
  );

    // Handler ajout tag manuel
  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' || e.key === ',') {
      e.preventDefault();
      addTag();
    }
  };

  const addTag = () => {
    const val = tagInput.trim();
    if (val && !props.tags.includes(val)) {
        props.setTags([...props.tags, val]);
    }
    setTagInput("");
  };

  const removeTag = (tagToRemove: string) => {
    props.setTags(props.tags.filter(t => t !== tagToRemove));
  };
  
  const currentRubriqueName = flatRubriques.find(r => r.id === props.rubriqueId)?.nom || "Sélectionner une rubrique";

  return (
    <div className="space-y-6 pb-24 animate-in fade-in sticky top-24">
      
      {/* === SECTION 1: ESSENTIELS === */}
      <div className="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 rounded-xl p-5 shadow-sm space-y-4">
        
        {/* Titre */}
        <div>
          <label className="text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-2 flex justify-between">
            Titre Principal 
            <span className={cn(
              "font-mono",
              props.titre.length < 10 ? "text-red-500" :
              props.titre.length > 150 ? "text-orange-500" : "text-green-500"
            )}>
              {props.titre.length} / 200
            </span>
          </label>
          <input 
            type="text" 
            value={props.titre}
            onChange={e => props.setTitre(e.target.value)}
            className="w-full p-3 rounded-lg border border-gray-200 dark:border-zinc-700 bg-transparent text-sm font-bold text-gray-900 dark:text-white focus:ring-2 focus:ring-[#3E7B52]/20 focus:border-[#3E7B52] outline-none transition-all placeholder:text-gray-300"
            placeholder="Titre de l'article (min 10 caractères)..."
          />
          {props.titre.length > 0 && props.titre.length < 10 && (
            <p className="text-xs text-red-500 mt-1">Minimum 10 caractères requis</p>
          )}
        </div>
        
        {/* Description */}
        <div>
          <label className="text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-2 flex justify-between">
            Résumé (Chapeau)
            <span className={cn(
              "font-mono",
              props.description.length < 50 ? "text-red-500" :
              props.description.length > 450 ? "text-orange-500" : "text-green-500"
            )}>
              {props.description.length} / 500
            </span>
          </label>
          <textarea 
            rows={4} 
            value={props.description}
            onChange={e => props.setDescription(e.target.value)}
            className="w-full p-3 rounded-lg border border-gray-200 dark:border-zinc-700 bg-transparent text-xs leading-relaxed dark:text-gray-300 focus:ring-2 focus:ring-[#3E7B52]/20 focus:border-[#3E7B52] outline-none resize-none placeholder:text-gray-300"
            placeholder="Ce résumé servira pour le référencement (min 50 caractères)..."
          />
          {props.description.length > 0 && props.description.length < 50 && (
            <p className="text-xs text-red-500 mt-1">Minimum 50 caractères requis</p>
          )}
        </div>
              {/* ✅ SECTION TAGS & IA (NEW) */}
      <div className="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 rounded-xl p-5 shadow-sm space-y-4">
          
          <div className="flex items-center justify-between mb-1">
             <label className="text-[10px] font-bold uppercase tracking-wider text-gray-500 flex items-center gap-1">
               <Tag size={12} className="text-[#3E7B52]" /> Tags & Mots-clés
             </label>
             <button 
                onClick={props.onAutoTag}
                disabled={props.isAutoTagging}
                type="button"
                className="text-[9px] font-bold uppercase flex items-center gap-1 bg-purple-50 text-purple-600 px-2 py-1 rounded-md border border-purple-100 hover:bg-purple-100 transition disabled:opacity-50"
             >
                {props.isAutoTagging ? <Loader2 size={10} className="animate-spin"/> : <Wand2 size={10}/>}
                Générer par IA
             </button>
          </div>

          {/* Zone de Tags (Chips) */}
          <div className="flex flex-wrap gap-2 mb-3">
             {props.tags.map((tag) => (
                 <span key={tag} className="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-700 dark:bg-zinc-800 dark:text-gray-300 border border-gray-200 dark:border-zinc-700">
                    #{tag}
                    <button onClick={() => removeTag(tag)} className="hover:text-red-500 ml-1"><X size={12}/></button>
                 </span>
             ))}
          </div>

          {/* Input Ajout */}
          <div className="relative">
              <input 
                type="text"
                value={tagInput}
                onChange={e => setTagInput(e.target.value)}
                onKeyDown={handleKeyDown}
                className="w-full p-2.5 rounded-lg border border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-950 text-sm outline-none focus:ring-2 focus:ring-[#3E7B52]/20"
                placeholder="Ajouter un tag..."
              />
              <button 
                 onClick={addTag}
                 className="absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-[#3E7B52]"
              >
                  <Plus size={16}/>
              </button>
          </div>
          <p className="text-[9px] text-gray-400 px-1">
             Appuyez sur Entrée pour valider un tag. Ces tags serviront à l'algorithme de recommandation.
          </p>
      </div>

      </div>

      {/* === SECTION 2: IMAGE COUVERTURE === */}
      <div className="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 rounded-xl p-5 shadow-sm">
        <label className="text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-3 flex justify-between">
            Image de Couverture
            {isUploading && <Loader2 size={12} className="animate-spin text-[#3E7B52]"/>}
        </label>
        
        {uploadError && (
          <div className="mb-2 p-2 bg-red-50 text-red-500 text-xs rounded flex items-center gap-2"><AlertCircle size={12}/>{uploadError}</div>
        )}

        <div className={cn(
          "relative w-full aspect-video border-2 border-dashed rounded-xl overflow-hidden flex flex-col items-center justify-center transition-all group",
          props.coverImageUrl ? "border-transparent bg-black" : "border-gray-200 dark:border-zinc-700 hover:border-[#3E7B52] cursor-pointer"
        )}>
           <input 
              type="file" 
              accept="image/*"
              onChange={handleCoverUpload}
              className="absolute inset-0 opacity-0 z-20 cursor-pointer w-full h-full"
              disabled={isUploading}
           />
           
           {isUploading ? (
              <div className="flex flex-col items-center text-[#3E7B52]">
                  <Loader2 size={24} className="animate-spin mb-2"/>
                  <span className="text-[10px] font-bold uppercase">Téléchargement...</span>
              </div>
           ) : props.coverImageUrl ? (
              <>
                 <Image src={props.coverImageUrl} alt="Cover" fill className="object-cover group-hover:opacity-50 transition-opacity" unoptimized/>
                 <button onClick={handleRemoveCover} className="absolute top-2 right-2 bg-red-500 text-white p-1.5 rounded z-30 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-auto">
                     <Trash2 size={14}/>
                 </button>
                 <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 pointer-events-none">
                     <span className="bg-black/50 text-white px-3 py-1 rounded-full text-xs backdrop-blur-sm flex gap-2 items-center">
                        <UploadCloud size={12}/> Changer
                     </span>
                 </div>
              </>
           ) : (
               <div className="text-center text-gray-400">
                   <ImageIcon size={24} className="mx-auto mb-2 opacity-50"/>
                   <span className="text-[10px] font-bold uppercase">Cliquez pour ajouter</span>
               </div>
           )}
        </div>
      </div>

      {/* === SECTION 3: CIBLAGE === */}
      <div className="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 rounded-xl p-5 shadow-sm space-y-5 z-20 relative">
        
        {/* RUBRIQUE */}
        <div>
          <div className="flex justify-between items-center mb-2">
            <label className="text-[10px] font-bold uppercase tracking-wider text-gray-500">
              Rubrique / Catégorie
            </label>
            <button 
              onClick={loadRubriques} 
              type="button" 
              className="text-gray-400 hover:text-[#3E7B52] transition-colors" 
              title="Rafraîchir"
            >
              <RefreshCw size={12} className={isRubriqueLoading ? "animate-spin" : ""} />
            </button>
          </div>

          <div className="relative">
            <button 
              type="button" 
              onClick={() => setIsDropdownOpen(!isDropdownOpen)}
              className="w-full flex items-center justify-between p-3 border border-gray-200 dark:border-zinc-700 rounded-lg text-sm text-left bg-gray-50 dark:bg-zinc-950 dark:text-white hover:border-[#3E7B52] transition-colors"
            >
              <span className="truncate font-bold text-gray-700 dark:text-gray-200">
                {currentRubriqueName}
              </span>
              <ChevronDown 
                size={14} 
                className={cn(
                  "text-gray-400 transition-transform", 
                  isDropdownOpen && "rotate-180"
                )} 
              />
            </button>

            {/* Dropdown */}
            {isDropdownOpen && (
              <div className="absolute top-full left-0 right-0 bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-700 rounded-xl shadow-2xl max-h-64 flex flex-col mt-2 z-50 overflow-hidden ring-1 ring-black/5 animate-in fade-in zoom-in-95 duration-200">
                
                {/* Filtre */}
                <div className="p-3 border-b dark:border-zinc-700 bg-gray-50 dark:bg-zinc-950 sticky top-0 z-10">
                  <div className="flex items-center bg-white dark:bg-zinc-900 border dark:border-zinc-700 px-3 rounded-lg h-9 focus-within:ring-1 focus-within:ring-[#3E7B52]">
                    <Search size={14} className="text-gray-400 mr-2" />
                    <input 
                      className="flex-1 bg-transparent text-xs p-1 outline-none dark:text-white" 
                      placeholder="Filtrer rubriques..." 
                      value={searchTerm} 
                      onChange={e => setSearchTerm(e.target.value)}
                      autoFocus 
                    />
                  </div>
                </div>
                
                {/* Liste */}
                <div className="overflow-y-auto flex-1 p-1">
                  {filteredRubriques.map(rub => (
                    <button 
                      key={rub.id}
                      type="button"
                      onClick={() => { 
                        props.setRubriqueId(rub.id); 
                        setIsDropdownOpen(false); 
                      }}
                      className={cn(
                        "w-full px-3 py-2.5 text-xs text-left flex items-center gap-2 rounded-lg transition-all",
                        props.rubriqueId === rub.id 
                          ? "bg-green-50 text-[#3E7B52] font-bold dark:bg-green-900/20 dark:text-[#13EC13]" 
                          : "text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-zinc-800"
                      )}
                    >
                      {rub.parentId && <CornerDownRight size={10} className="text-gray-300 ml-2" />}
                      <span className={!rub.parentId ? "uppercase font-extrabold text-[10px]" : ""}>
                        {rub.nom}
                      </span>
                      {props.rubriqueId === rub.id && <Check size={14} className="ml-auto text-[#3E7B52]" />}
                    </button>
                  ))}
                </div>

                {/* Create */}
                <div className="p-2 border-t dark:border-zinc-700 bg-gray-50 dark:bg-zinc-950">
                  {isCreating ? (
                    <div className="flex gap-2 items-center px-1">
                      <input 
                        value={newName} 
                        onChange={e => setNewName(e.target.value)} 
                        className="text-xs p-2 border rounded-lg flex-1 dark:bg-black dark:text-white focus:border-[#3E7B52] outline-none" 
                        placeholder="Nouvelle..."
                      />
                      <button 
                        onClick={handleCreateRubrique} 
                        className="p-2 bg-[#3E7B52] text-white rounded-lg hover:bg-green-700 transition-colors"
                      >
                        <Check size={14} />
                      </button>
                      <button 
                        onClick={() => setIsCreating(false)} 
                        className="p-2 bg-red-100 text-red-500 rounded-lg hover:bg-red-200 transition-colors"
                      >
                        <X size={14} />
                      </button>
                    </div>
                  ) : (
                    <button 
                      onClick={() => setIsCreating(true)} 
                      className="w-full py-2 text-xs text-[#3E7B52] dark:text-[#13EC13] font-bold flex items-center justify-center gap-1.5 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors"
                    >
                      <Plus size={14} /> Ajouter
                    </button>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>

        {/* RÉGION */}
        <div>
          <label className="text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-2 block flex items-center gap-1">
            <MapPin size={12} className="text-[#3E7B52]" /> Zone Cible
          </label>
          <div className="relative">
            <select 
              value={props.region}
              onChange={(e) => props.setRegion(e.target.value)}
              className="w-full p-3 rounded-lg border border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-sm font-medium text-gray-700 dark:text-white outline-none cursor-pointer hover:border-[#3E7B52] focus:ring-2 focus:ring-[#3E7B52]/20 transition-all appearance-none"
            >
              {TARGET_REGIONS.map(reg => (
                <option key={reg.id} value={reg.id}>
                  {reg.label}
                </option>
              ))}
            </select>
            <ChevronDown size={16} className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" />
            <div className="absolute right-10 top-1/2 -translate-y-1/2">
              <Globe size={14} className="text-gray-300" />
            </div>
          </div>
          <p className="text-[9px] text-gray-400 mt-2 px-1">
            * La diffusion de l'article sera prioritaire dans la région sélectionnée.
          </p>
        </div>
      </div>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\new-article\Toolbar.tsx
================================================================================

// FICHIER: components/dashboard/new-article/Toolbar.tsx
"use client";

import React, { useRef, useState } from 'react';
import type { Editor } from '@tiptap/react';
import { 
  Bold, Italic, Strikethrough, Heading1, Heading2, Quote, 
  List, ListOrdered, Image as ImageIcon, Video, Undo, Redo, 
  Loader2
} from 'lucide-react';
import { cn, getImageUrl } from '@/lib/utils';
import { ArticleService } from '@/services/article';

interface ToolbarProps {
  editor: Editor | null;
}

export default function Toolbar({ editor }: ToolbarProps) {
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [isUploading, setIsUploading] = React.useState(false);
  const [uploadSuccess, setUploadSuccess] = useState(false);

  if (!editor) return null;

  // -- LOGIQUE AVANCÉE D'INSERTION IMAGE --
  const handleImageClick = () => {
    fileInputRef.current?.click();
  };

  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    setIsUploading(true);
    setUploadSuccess(false);

    try {
        // 1. Upload vers le Backend -> On récupère ID + URL
        const media = await ArticleService.uploadMedia(file);
        
        console.log("📷 Image uploaded via Editor:", media);

        // 2. Insérer dans l'éditeur avec attributs étendus
        // NOTE: On utilise setAttribute sur setImage pour persister le mediaId
        // Si l'extension Tiptap Image de base ne supporte pas d'attributs custom,
        // nous insérons via 'command' standard et mettons à jour les attributs via le DOM ensuite.
        
        const imageUrl = getImageUrl(media.urlAcces);
        
        editor.chain().focus().setImage({ 
            src: imageUrl, 
            alt: media.nomOriginal,
            title: media.nomOriginal // Sert souvent de légende par défaut
        }).run();

        // 3. Hack propre: On attache le mediaId à la dernière image insérée (ou celle ayant cet URL)
        // Ceci est vital pour le parsing plus tard dans NewArticle.tsx
        // Nous le faisons via un petit délai pour laisser Tiptap rendre le node.
        setTimeout(() => {
            const images = document.querySelectorAll(`img[src="${imageUrl}"]`);
            images.forEach(img => {
                img.setAttribute('data-media-id', String(media.id));
                img.classList.add("article-content-image"); // Classe CSS pour styling
            });
        }, 100);

        setUploadSuccess(true);
        setTimeout(() => setUploadSuccess(false), 2000);

    } catch (err) {
        alert("Erreur upload image contenu. Vérifiez format/taille.");
        console.error(err);
    } finally {
        setIsUploading(false);
        if(fileInputRef.current) fileInputRef.current.value = ""; 
    }
  };

  const addYoutube = () => {
    const url = prompt('Entrez l\'URL YouTube');
    if (url) {
      editor.commands.setContent(`${editor.getHTML()}<p>URL Vidéo: ${url}</p>`); 
      // Note: Idéalement utilisez @tiptap/extension-youtube
    }
  };

  const buttons = [
    { 
        icon: Bold, 
        action: () => editor.chain().focus().toggleBold().run(), 
        isActive: editor.isActive('bold'),
        label: "Gras" 
    },
    { 
        icon: Italic, 
        action: () => editor.chain().focus().toggleItalic().run(), 
        isActive: editor.isActive('italic'),
        label: "Italique" 
    },
    { 
        icon: Strikethrough, 
        action: () => editor.chain().focus().toggleStrike().run(), 
        isActive: editor.isActive('strike'),
        label: "Barré" 
    },
    { divider: true },
    { 
        icon: Heading1, 
        action: () => editor.chain().focus().toggleHeading({ level: 1 }).run(), 
        isActive: editor.isActive('heading', { level: 1 }),
        label: "H1"
    },
    { 
        icon: Heading2, 
        action: () => editor.chain().focus().toggleHeading({ level: 2 }).run(), 
        isActive: editor.isActive('heading', { level: 2 }),
        label: "H2"
    },
    { divider: true },
    { 
        icon: Quote, 
        action: () => editor.chain().focus().toggleBlockquote().run(), 
        isActive: editor.isActive('blockquote'),
        label: "Citation"
    },
    { 
        icon: List, 
        action: () => editor.chain().focus().toggleBulletList().run(), 
        isActive: editor.isActive('bulletList'),
        label: "Liste Puce"
    },
    { 
        icon: ListOrdered, 
        action: () => editor.chain().focus().toggleOrderedList().run(), 
        isActive: editor.isActive('orderedList'),
        label: "Liste Num."
    },
    { divider: true },
    {
        icon: isUploading ? Loader2 : ImageIcon, // Loader si en cours
        action: handleImageClick,
        isActive: false,
        label: "Image",
        specialClass: "text-[#3E7B52] dark:text-[#13EC13] hover:bg-green-50 dark:hover:bg-green-900/20"
    },
    { icon: Video, action: addYoutube, isActive: false, label: "Vidéo Youtube" },
    { divider: true },
    { icon: Undo, action: () => editor.chain().focus().undo().run(), label: "Undo" },
    { icon: Redo, action: () => editor.chain().focus().redo().run(), label: "Redo" },
  ];

  return (
    <div className="flex flex-wrap items-center gap-1 p-2 bg-gray-50/50 dark:bg-zinc-800/50 border-b border-gray-100 dark:border-zinc-800 sticky top-0 z-10 backdrop-blur-sm">
        {/* Hidden Input File pour les images */}
        <input 
            type="file" 
            ref={fileInputRef} 
            className="hidden" 
            accept="image/*"
            onChange={handleFileChange}
        />

        {buttons.map((btn, index) => {
            if (btn.divider) {
                return <div key={index} className="w-px h-6 bg-gray-200 dark:bg-zinc-700 mx-2" />;
            }
            // TypeScript guard
            if (!btn.icon) return null;
            
            const Icon = btn.icon;
            return (
                <button
                    key={index}
                    onClick={btn.action}
                    title={btn.label}
                    disabled={isUploading && btn.label === 'Image'}
                    className={cn(
                        "p-2 rounded-md transition-colors text-gray-500 dark:text-gray-400 hover:bg-white dark:hover:bg-zinc-700 hover:shadow-sm hover:text-gray-900 dark:hover:text-white",
                        btn.isActive ? "bg-white dark:bg-zinc-700 text-[#3E7B52] dark:text-[#13EC13] shadow-sm font-bold" : "",
                        btn.specialClass
                    )}
                >
                    <Icon size={18} className={isUploading && btn.label === 'Image' ? "animate-spin" : ""} />
                </button>
            )
        })}
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\MyArticles.tsx
================================================================================

"use client";

import React, { useEffect, useState } from 'react';
import { Edit, Trash2, RefreshCw, Eye, Send, FileClock, CheckCircle, FileText } from 'lucide-react';
import { ArticleReadDto } from '@/types/article';
import { ArticleService } from '@/services/article';
import { useAuth } from '@/context/AuthContext';
import { cn } from '@/lib/utils';
import { format } from 'date-fns';
import { fr } from 'date-fns/locale';
import { Button } from '../ui/Button';

interface MyArticlesProps {
  onEdit: (id: number) => void;
}

export default function MyArticles({ onEdit }: MyArticlesProps) {
  const { user } = useAuth();
  
  // Onglets pour filtrer la vue (pas des statuts API directs, mais des filtres UI)
  const [activeTab, setActiveTab] = useState<'BROUILLONS' | 'EN_COURS' | 'PUBLIES'>('BROUILLONS');
  
  const [articles, setArticles] = useState<ArticleReadDto[]>([]);
  const [loading, setLoading] = useState(true);
  const [actionLoading, setActionLoading] = useState<number | null>(null);

  // Rechargement des données selon l'onglet
  useEffect(() => {
    if (user?.id) fetchTabContent();
  }, [activeTab, user?.id]);

  const fetchTabContent = async () => {
    if (!user) return;
    setLoading(true);
    setArticles([]);

    try {
        let data: ArticleReadDto[] = [];
        
        // Logique Swagger spécifique par Onglet
        if (activeTab === 'BROUILLONS') {
                        // ✅ APPEL DE LA BONNE ROUTE
            console.log("📂 Récupération des brouillons pour l'auteur", user.id);
            data = await ArticleService.getRedacteurBrouillons(user.id);

        } else if (activeTab === 'PUBLIES') {
            data = await ArticleService.getRedacteurPublies(user.id);
        } else {
            // EN_COURS : On prend tout et on filtre car il n'y a pas de route "/articles/en-attente"
            const allResponse = await ArticleService.getRedacteurTousArticles(user.id, 0, 100);
            const allContent = Array.isArray(allResponse) ? allResponse : (allResponse.content || []);
            // Filtrage Client : PENDING_REVIEW + APPROVED (Avant publication finale)
            data = allContent.filter((a: ArticleReadDto) => 
                a.statut === 'PENDING_REVIEW' || a.statut === 'APPROVED' || a.statut === 'REJECTED'
            );
        }

                // Sécurisation Array (Correction de l'erreur TypeScript ici)
        const cleanList = Array.isArray(data) ? data : ((data as any).content || []);
        
        // On type explicitement 'a' et 'b'
        cleanList.sort((a: ArticleReadDto, b: ArticleReadDto) => new Date(b.dateCreation).getTime() - new Date(a.dateCreation).getTime());
        setArticles(cleanList);
    } catch (e) {
        console.error("Erreur Fetch", e);
    } finally {
        setLoading(false);
    }
  };

  // --- ACTIONS ---

  const handleDelete = async (id: number) => {
      if(!confirm("⚠️ Confirmer la suppression définitive du brouillon ?")) return;
      setActionLoading(id);
      try {
          await ArticleService.delete(id);
          // Optimistic UI Update
          setArticles(prev => prev.filter(a => a.id !== id));
      } catch(e) { 
          alert("Erreur: Impossible de supprimer cet article."); 
      } finally {
          setActionLoading(null);
      }
  };

  const handleSubmit = async (id: number) => {
      if (!user) return;
      if (!confirm("Envoyer pour relecture éditoriale ?\nVous ne pourrez plus modifier l'article après cet envoi.")) return;
      
      setActionLoading(id);
      try {
          await ArticleService.submitForReview(id, user.id);
          // Après soumission, il disparaît des brouillons (passe en Pending)
          setArticles(prev => prev.filter(a => a.id !== id));
          // Idéalement on afficherait un Toast ici
      } catch(e) {
          alert("Erreur lors de la soumission.");
      } finally {
          setActionLoading(null);
      }
  };

  // --- HELPERS UI ---

  const getStatusBadge = (status: string) => {
      switch(status) {
          case 'DRAFT': return (
            <span className="flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase bg-gray-100 text-gray-600 border border-gray-200">
                <span className="w-1.5 h-1.5 rounded-full bg-gray-400"></span> Brouillon
            </span>
          );
          case 'PENDING_REVIEW': return (
            <span className="flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase bg-orange-50 text-orange-600 border border-orange-100">
                <span className="w-1.5 h-1.5 rounded-full bg-orange-500 animate-pulse"></span> En Revue
            </span>
          );
          case 'APPROVED': return (
            <span className="flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase bg-blue-50 text-blue-600 border border-blue-100">
                <CheckCircle size={10} strokeWidth={3}/> Validé
            </span>
          );
          case 'PUBLISHED': return (
            <span className="flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase bg-green-50 text-green-700 border border-green-200 dark:bg-green-900/30 dark:text-[#13EC13]">
                <span className="w-1.5 h-1.5 rounded-full bg-green-600"></span> En Ligne
            </span>
          );
          case 'REJECTED': return (
            <span className="flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase bg-red-50 text-red-600 border border-red-200">
                Rejeté
            </span>
          );
          default: return <span className="bg-gray-100 px-2 py-1 rounded text-xs">{status}</span>;
      }
  };

  const tabs = [
      { id: 'BROUILLONS', label: 'Brouillons', icon: FileText },
      { id: 'EN_COURS', label: 'En Attente', icon: FileClock },
      { id: 'PUBLIES', label: 'Publiés', icon: CheckCircle },
  ];

  return (
    <div className="space-y-6 pb-24 animate-in fade-in slide-in-from-bottom-2 duration-300">
        
        {/* --- HEADER AVEC ONGLETS --- */}
        <div className="flex flex-col sm:flex-row sm:items-end justify-between gap-6 border-b border-gray-100 dark:border-zinc-800 pb-2">
            <div>
                <h2 className="text-2xl font-black text-gray-900 dark:text-white">Mes Articles</h2>
                <p className="text-gray-500 dark:text-zinc-400 text-sm mt-1">
                    Gérez vos contenus de la rédaction à la publication.
                </p>
            </div>
            
            <div className="flex gap-2 p-1 bg-gray-100 dark:bg-zinc-900 rounded-lg self-start sm:self-auto">
                {tabs.map((tab) => (
                    <button
                        key={tab.id}
                        onClick={() => setActiveTab(tab.id as any)}
                        className={cn(
                            "flex items-center gap-2 px-4 py-2 text-xs font-bold uppercase rounded-md transition-all",
                            activeTab === tab.id
                                ? "bg-white dark:bg-zinc-800 text-[#3E7B52] dark:text-[#13EC13] shadow-sm text-shadow-sm"
                                : "text-gray-500 hover:text-gray-900 dark:text-zinc-500 dark:hover:text-zinc-300"
                        )}
                    >
                        <tab.icon size={14} className={activeTab === tab.id ? "" : "opacity-70"} />
                        <span className="hidden sm:inline">{tab.label}</span>
                    </button>
                ))}
            </div>
        </div>

        {/* --- ACTIONS SECONDAIRES --- */}
        <div className="flex justify-end">
            <button 
                onClick={fetchTabContent} 
                disabled={loading}
                className="text-xs font-medium text-gray-500 hover:text-[#3E7B52] flex items-center gap-1.5 transition-colors disabled:opacity-50"
            >
                <RefreshCw size={12} className={loading ? "animate-spin" : ""} /> Actualiser la liste
            </button>
        </div>

        {/* --- LISTING CARDS (DESIGN PRO) --- */}
        {loading ? (
            <div className="flex flex-col items-center justify-center py-20 bg-white dark:bg-zinc-900 rounded-xl border border-dashed border-gray-200 dark:border-zinc-800">
                <RefreshCw className="animate-spin text-gray-300 mb-2" size={24}/>
                <p className="text-xs text-gray-400 font-medium">Chargement de vos articles...</p>
            </div>
        ) : articles.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-24 bg-gray-50/50 dark:bg-zinc-900/50 border border-dashed border-gray-200 dark:border-zinc-800 rounded-xl">
                <div className="bg-white dark:bg-zinc-800 p-4 rounded-full shadow-sm mb-3">
                    <FileText className="text-gray-300" size={24}/>
                </div>
                <p className="text-sm font-bold text-gray-500 dark:text-zinc-400">Aucun article dans la section {tabs.find(t => t.id === activeTab)?.label.toLowerCase()}.</p>
                {activeTab === 'BROUILLONS' && (
                    <p className="text-xs text-gray-400 mt-1">Commencez par rédiger un nouvel article.</p>
                )}
            </div>
        ) : (
            <div className="grid grid-cols-1 gap-4">
                {articles.map((art) => (
                    <div 
                        key={art.id} 
                        className="group bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 hover:border-[#3E7B52]/30 dark:hover:border-[#13EC13]/30 rounded-xl p-5 shadow-sm hover:shadow-md transition-all flex flex-col sm:flex-row sm:items-center justify-between gap-6"
                    >
                        {/* Info Principales */}
                        <div className="flex-1">
                            <div className="flex items-center gap-3 mb-2">
                                {getStatusBadge(art.statut)}
                                <span className="text-[10px] font-mono text-gray-400 uppercase tracking-widest">
                                    {art.rubriqueNom || "Général"}
                                </span>
                            </div>
                            
                            <h3 className="font-bold text-lg text-gray-900 dark:text-white group-hover:text-[#3E7B52] dark:group-hover:text-[#13EC13] transition-colors mb-1 line-clamp-1" title={art.titre}>
                                {art.titre || "Article Sans Titre"}
                            </h3>
                            
                            <div className="flex items-center gap-3 text-xs text-gray-500 dark:text-zinc-500">
                                <span>Créé le {format(new Date(art.dateCreation), 'dd MMMM yyyy à HH:mm', {locale: fr})}</span>
                                {art.datePublication && (
                                    <>
                                        <span>•</span>
                                        <span className="text-green-600 dark:text-green-400">Publié le {format(new Date(art.datePublication), 'dd/MM/yyyy')}</span>
                                    </>
                                )}
                            </div>
                        </div>

                        {/* Zone Actions - Change selon le statut */}
                        <div className="flex items-center gap-2 shrink-0 border-t sm:border-t-0 pt-4 sm:pt-0 border-gray-50 dark:border-zinc-800">
                            
                            {/* CASE BROUILLON ou REJETÉ -> Editable */}
                            {(art.statut === 'DRAFT' || art.statut === 'REJECTED') && (
                                <>
                                    <button 
                                        onClick={() => handleDelete(art.id)}
                                        disabled={actionLoading === art.id}
                                        className="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-50 hover:text-red-500 text-gray-400 transition-colors"
                                        title="Supprimer définitivement"
                                    >
                                        <Trash2 size={16}/>
                                    </button>
                                    
                                    <button 
                                        onClick={() => onEdit(art.id)} // Déclenche le mode Edition dans le parent Dashboard
                                        className="h-9 px-4 rounded-lg bg-gray-50 dark:bg-zinc-800 hover:bg-gray-100 dark:hover:bg-zinc-700 text-gray-700 dark:text-gray-300 text-xs font-bold border border-gray-200 dark:border-zinc-700 flex items-center gap-2 transition-all"
                                    >
                                        <Edit size={14}/> Modifier
                                    </button>

                                    <Button 
                                        onClick={() => handleSubmit(art.id)}
                                        disabled={actionLoading === art.id}
                                        className="w-auto h-9 px-4 bg-[#3E7B52] hover:bg-[#326342] text-xs font-bold"
                                    >
                                        {actionLoading === art.id ? <RefreshCw className="animate-spin" size={14}/> : <Send size={14} className="mr-2"/>}
                                        Soumettre
                                    </Button>
                                </>
                            )}

                            {/* CASE PENDING ou APPROVED -> Read Only */}
                            {(art.statut === 'PENDING_REVIEW' || art.statut === 'APPROVED') && (
                                <>
                                    <span className="text-xs text-orange-500 italic mr-2 bg-orange-50 px-2 py-1 rounded">Verrouillé pendant la revue</span>
                                    <button className="h-9 w-9 flex items-center justify-center rounded-lg bg-gray-100 text-gray-400 cursor-not-allowed">
                                        <Eye size={16}/>
                                    </button>
                                </>
                            )}

                            {/* CASE PUBLISHED -> Analytics link ou Voir */}
                            {art.statut === 'PUBLISHED' && (
                                <a 
                                    href={`/article/${art.id}`} // Lien public vers l'article
                                    target="_blank"
                                    rel="noreferrer" 
                                    className="h-9 px-4 rounded-lg border border-gray-200 dark:border-zinc-700 text-gray-600 dark:text-gray-400 hover:text-[#3E7B52] dark:hover:text-white flex items-center gap-2 text-xs font-bold transition-colors"
                                >
                                    <Eye size={14}/> Voir en ligne
                                </a>
                            )}

                        </div>
                    </div>
                ))}
            </div>
        )}
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\Overview.tsx
================================================================================

import React from 'react';
import { Eye, FileText, MessageSquare, TrendingUp } from 'lucide-react';
// Helper local pour ce fichier
import { cn } from "@/lib/utils";


// Données statiques pour l'exemple
const statsData = [
  { label: 'Articles Publiés', value: 12, icon: FileText, color: 'text-blue-500' },
  { label: 'Vues Totales', value: '8.5k', icon: Eye, color: 'text-[#3E7B52] dark:text-[#13EC13]' },
  { label: 'Commentaires', value: 64, icon: MessageSquare, color: 'text-orange-500' },
];

export default function Overview() {
  return (
    <div className="space-y-8 animate-in fade-in zoom-in-95 duration-300">
      
      {/* Header local */}
      <div>
        <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-1">Tableau de bord</h2>
        <p className="text-gray-500 dark:text-zinc-400 text-sm">Bienvenue, voici ce qui se passe sur votre blog aujourd'hui.</p>
      </div>

      {/* Cartes Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {statsData.map((stat) => (
          <div 
            id={stat.icon === Eye ? "dashboard-stats-card" : undefined} 
            key={stat.label} 
            className="bg-white dark:bg-zinc-900 p-6 rounded-xl border border-gray-100 dark:border-zinc-800 shadow-sm flex items-start justify-between group hover:border-[#3E7B52]/30 dark:hover:border-[#13EC13]/30 transition-all"
          >
            <div>
              <h3 className="text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-wider mb-2">
                {stat.label}
              </h3>
              <p className={cn("text-3xl font-extrabold", stat.color)}>
                {stat.value}
              </p>
            </div>
            <div className="p-3 rounded-lg bg-gray-50 dark:bg-zinc-800 group-hover:scale-110 transition-transform duration-300">
              <stat.icon className={cn("w-5 h-5", stat.color)} />
            </div>
          </div>
        ))}
      </div>

      {/* Graphique simulé ou Activité récente */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div className="lg:col-span-2 bg-white dark:bg-zinc-900 rounded-xl border border-gray-100 dark:border-zinc-800 p-6">
             <div className="flex items-center justify-between mb-6">
                 <h3 className="font-bold text-gray-900 dark:text-white flex items-center gap-2">
                    <TrendingUp size={18} className="text-[#3E7B52] dark:text-[#13EC13]"/> 
                    Performance
                 </h3>
                 <span className="text-xs text-gray-400 border border-gray-100 dark:border-zinc-700 px-2 py-1 rounded">Cette semaine</span>
             </div>
             <div className="h-64 flex items-end justify-between gap-2">
                {/* Simulation de barres de graph */}
                {[40, 70, 45, 90, 60, 80, 50].map((h, i) => (
                    <div key={i} className="w-full bg-green-50 dark:bg-zinc-800 rounded-t-sm relative group cursor-pointer" style={{ height: `${h}%` }}>
                        <div 
                            className="absolute bottom-0 left-0 right-0 bg-[#3E7B52] dark:bg-[#13EC13] rounded-t-sm opacity-60 group-hover:opacity-100 transition-opacity" 
                            style={{ height: `${h * 0.6}%` }} 
                        />
                    </div>
                ))}
             </div>
        </div>

        <div className="bg-[#3E7B52] dark:bg-zinc-800 rounded-xl p-6 text-white flex flex-col justify-between relative overflow-hidden">
             <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none"></div>
             
             <div>
                <h3 className="font-bold text-lg mb-2">Conseil Rédacteur</h3>
                <p className="text-green-100/80 text-sm leading-relaxed">
                    Les articles contenant des visuels (images ou graphiques) obtiennent 94% de vues en plus. Pensez à illustrer vos propos !
                </p>
             </div>
             <button className="w-full py-3 bg-white text-[#3E7B52] dark:bg-[#13EC13] dark:text-black font-bold rounded-lg text-sm mt-6 hover:bg-gray-100 transition">
                Voir le guide
             </button>
        </div>
      </div>
    </div>
  );
}




================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\Settings.tsx
================================================================================

"use client";

import React, { useEffect, useState } from "react";
import { User as UserIcon, Bell, Shield, LogOut } from "lucide-react";
import { authService, User } from "@/services/auth";
import { Button } from "@/components/ui/Button";
import { Input } from "@/components/ui/Input";

export default function Settings() {
  const [user, setUser] = useState<User | null>(null);

  useEffect(() => {
    // Récupérer l'utilisateur courant pour l'affichage
    const currentUser = authService.getUser();
    if (currentUser) {
        setUser(currentUser);
    }
  }, []);

  const handleLogout = () => {
    authService.logout();
  };

  if (!user) return null;

  return (
    <div className="max-w-4xl animate-in fade-in slide-in-from-bottom-2 duration-300">
        <h2 className="text-2xl font-extrabold text-gray-900 dark:text-white mb-2">Paramètres</h2>
        <p className="text-gray-500 dark:text-zinc-400 text-sm mb-8">Gérez vos informations personnelles et vos préférences.</p>
        
        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            
            {/* Colonne Gauche : Carte Profil */}
            <div className="md:col-span-1">
                <div className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl p-6 text-center sticky top-6 shadow-sm">
                    <div className="relative mx-auto w-24 h-24 mb-4 group cursor-pointer">
                         <div className="w-full h-full bg-[#3E7B52] dark:bg-[#13EC13] rounded-full flex items-center justify-center text-white dark:text-black font-bold text-3xl">
                            {user.fullName.charAt(0).toUpperCase()}
                         </div>
                         <div className="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                             <span className="text-white text-xs">Modifier</span>
                         </div>
                    </div>
                    <h3 className="font-bold text-lg text-gray-900 dark:text-white truncate">{user.fullName}</h3>
                    <p className="text-xs text-gray-500 dark:text-gray-400 mb-1">{user.email}</p>
                    <span className="inline-block px-3 py-1 bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-[10px] font-bold uppercase rounded-full tracking-wide">
                        {user.role}
                    </span>

                    <div className="mt-6 pt-6 border-t border-gray-100 dark:border-zinc-800">
                        <button 
                            onClick={handleLogout}
                            className="text-xs font-medium text-red-500 hover:text-red-700 dark:hover:text-red-400 flex items-center justify-center gap-2 w-full transition-colors"
                        >
                            <LogOut size={14}/>
                            Déconnexion
                        </button>
                    </div>
                </div>
            </div>

            {/* Colonne Droite : Formulaires */}
            <div className="md:col-span-2 space-y-6">
                
                {/* Section Informations */}
                <section className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl p-6 shadow-sm">
                    <h3 className="font-bold text-sm text-gray-900 dark:text-white mb-6 flex items-center gap-2">
                        <UserIcon size={16} /> Informations Personnelles
                    </h3>
                    <div className="grid gap-4">
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-[10px] font-bold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-1.5">Nom complet</label>
                                <Input label="" placeholder={user.fullName} defaultValue={user.fullName} className="h-10 dark:bg-zinc-950 dark:border-zinc-700"/>
                            </div>
                            <div>
                                <label className="block text-[10px] font-bold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-1.5">Rôle</label>
                                <Input label="" disabled value={user.role === 'REDACTEUR' ? 'Rédacteur' : user.role} className="h-10 bg-gray-50 dark:bg-zinc-950/50 text-gray-500 border-gray-200 cursor-not-allowed"/>
                            </div>
                        </div>
                        <div>
                             <label className="block text-[10px] font-bold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-1.5">Email</label>
                             <Input label="" type="email" defaultValue={user.email} className="h-10 dark:bg-zinc-950 dark:border-zinc-700"/>
                        </div>
                        <div className="pt-2 flex justify-end">
                            <Button className="w-auto h-9 px-6 text-xs bg-[#3E7B52] dark:bg-[#13EC13] dark:text-black font-bold">Sauvegarder</Button>
                        </div>
                    </div>
                </section>

                {/* Section Notifications (Simulée) */}
                <section className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl p-6 shadow-sm">
                    <h3 className="font-bold text-sm text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        <Bell size={16} /> Préférences de notifications
                    </h3>
                    <div className="space-y-3">
                        <div className="flex items-center justify-between">
                            <span className="text-sm text-gray-600 dark:text-gray-300">Alerte commentaire sur mes articles</span>
                            <div className="w-10 h-5 bg-[#3E7B52] dark:bg-[#13EC13] rounded-full relative cursor-pointer"><div className="absolute right-1 top-1 w-3 h-3 bg-white rounded-full"></div></div>
                        </div>
                        <div className="flex items-center justify-between">
                            <span className="text-sm text-gray-600 dark:text-gray-300">Rapport hebdomadaire des vues</span>
                            <div className="w-10 h-5 bg-gray-200 dark:bg-zinc-700 rounded-full relative cursor-pointer"><div className="absolute left-1 top-1 w-3 h-3 bg-white rounded-full"></div></div>
                        </div>
                    </div>
                </section>

                 {/* Zone Danger */}
                 <section className="border border-red-100 dark:border-red-900/30 bg-red-50/50 dark:bg-red-900/10 rounded-xl p-6">
                    <h3 className="font-bold text-sm text-red-600 dark:text-red-400 mb-2 flex items-center gap-2">
                        <Shield size={16} /> Zone Danger
                    </h3>
                    <p className="text-xs text-gray-500 dark:text-gray-400 mb-4">Une fois supprimé, votre compte de rédacteur ne peut plus être récupéré.</p>
                    <button className="text-xs font-semibold text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 border border-red-200 dark:border-red-800/50 bg-white dark:bg-transparent px-4 py-2 rounded-lg transition-colors">
                        Demander la suppression du compte
                    </button>
                </section>

            </div>
        </div>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\EditorView.tsx
================================================================================

// FICHIER: components/dashboard/EditorView.tsx
"use client";

import React, { useEffect, useState } from "react";
import { dashboardService } from "@/services/dashboard";
import { ArticleBackend, StatsDashboard } from "@/types/dashboard";
import { Eye, FileText, MessageSquare, Loader2, Calendar } from "lucide-react";
import { cn } from "@/lib/utils";

export default function EditorView() {
  const [loading, setLoading] = useState(true);
  const [stats, setStats] = useState<StatsDashboard | null>(null);
  const [recentArticles, setRecentArticles] = useState<ArticleBackend[]>([]);

  useEffect(() => {
    const loadData = async () => {
      setLoading(true);
      
      // Chargement Parallèle pour la vitesse
      const [statsData, articlesData] = await Promise.all([
        dashboardService.getMyStats(),
        dashboardService.getMyArticles()
      ]);

      setStats(statsData);
      setRecentArticles(articlesData.slice(0, 5)); // Les 5 derniers
      setLoading(false);
    };

    loadData();
  }, []);

  if (loading) {
    return <div className="h-64 flex items-center justify-center"><Loader2 className="animate-spin text-[#3E7B52]" size={40} /></div>;
  }

  // Cards Data
  const statsDisplay = [
    { label: 'Articles Publiés', value: stats?.totalArticles || 0, icon: FileText, color: 'text-blue-600' },
    { label: 'Vues Totales', value: stats?.totalVues || 0, icon: Eye, color: 'text-green-600' },
    { label: 'Commentaires', value: stats?.totalCommentaires || 0, icon: MessageSquare, color: 'text-orange-600' },
  ];

  return (
    <div className="space-y-8 animate-in fade-in slide-in-from-bottom-2">
      <div>
        <h2 className="text-2xl font-bold text-gray-900 dark:text-white">Tableau de Bord Rédacteur</h2>
        <p className="text-gray-500 text-sm">Aperçu de vos performances et contenus récents.</p>
      </div>

      {/* --- STATS CARDS --- */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {statsDisplay.map((item, idx) => (
          <div key={idx} className="bg-white dark:bg-zinc-900 p-6 rounded-xl border border-gray-100 dark:border-zinc-800 shadow-sm flex items-center justify-between">
            <div>
              <p className="text-xs text-gray-500 uppercase font-bold tracking-wider">{item.label}</p>
              <p className={cn("text-3xl font-extrabold mt-1", item.color)}>{item.value}</p>
            </div>
            <div className={cn("p-3 rounded-full bg-gray-50 dark:bg-zinc-800", item.color)}>
              <item.icon size={24} />
            </div>
          </div>
        ))}
      </div>

      {/* --- TABLEAU RÉCENT --- */}
      <div className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl overflow-hidden">
        <div className="px-6 py-4 border-b border-gray-100 dark:border-zinc-800">
            <h3 className="font-bold text-gray-900 dark:text-white">Vos derniers articles</h3>
        </div>
        <table className="w-full text-sm text-left">
            <thead className="bg-gray-50 dark:bg-zinc-800 text-gray-500">
                <tr>
                    <th className="px-6 py-3 font-bold">Titre</th>
                    <th className="px-6 py-3 font-bold">Date</th>
                    <th className="px-6 py-3 font-bold">Statut</th>
                    <th className="px-6 py-3 font-bold text-right">Vues</th>
                </tr>
            </thead>
            <tbody className="divide-y divide-gray-50 dark:divide-zinc-800">
                {recentArticles.length === 0 ? (
                    <tr><td colSpan={4} className="px-6 py-8 text-center text-gray-500">Aucun article trouvé. Commencez à rédiger !</td></tr>
                ) : (
                    recentArticles.map((article) => (
                        <tr key={article.id} className="hover:bg-gray-50 dark:hover:bg-zinc-800/50 transition">
                            <td className="px-6 py-4 font-medium text-gray-900 dark:text-white">{article.titre}</td>
                            <td className="px-6 py-4 text-gray-500 text-xs flex items-center gap-1">
                                <Calendar size={12}/> 
                                {article.datePublication ? new Date(article.datePublication).toLocaleDateString() : "Non publié"}
                            </td>
                            <td className="px-6 py-4">
                                <span className={cn(
                                    "px-2 py-1 rounded-full text-[10px] font-bold uppercase",
                                    article.statut === "PUBLIE" ? "bg-green-100 text-green-700" : 
                                    article.statut === "REJETE" ? "bg-red-100 text-red-700" : 
                                    "bg-yellow-100 text-yellow-700"
                                )}>
                                    {article.statut}
                                </span>
                            </td>
                            <td className="px-6 py-4 text-right font-mono">{article.vues || 0}</td>
                        </tr>
                    ))
                )}
            </tbody>
        </table>
      </div>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\ReaderView.tsx
================================================================================

// FICHIER: components/dashboard/ReaderView.tsx
"use client";

import React, { useEffect, useState } from "react";
import Link from "next/link";
import { dashboardService } from "@/services/dashboard";
import { ArticleBackend } from "@/types/dashboard";
import { ArrowRight, BookOpen, Clock, Loader2, Star } from "lucide-react";
import Image from "next/image";

export default function ReaderView() {
  const [loading, setLoading] = useState(true);
  const [featured, setFeatured] = useState<ArticleBackend[]>([]);
  const [feed, setFeed] = useState<ArticleBackend[]>([]);

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      // Récupération simultanée du Featured et du Feed général
      const [featData, feedData] = await Promise.all([
        dashboardService.getFeaturedArticles(),
        dashboardService.getAllPublicArticles(0, 10) // Page 0, 10 items
      ]);
      setFeatured(featData);
      setFeed(feedData.content || []);
      setLoading(false);
    };
    fetchData();
  }, []);

  if (loading) {
    return (
        <div className="flex flex-col items-center justify-center h-96 gap-4 text-gray-400">
            <Loader2 className="animate-spin text-[#3E7B52]" size={40}/>
            <p>Chargement de votre flux de lecture...</p>
        </div>
    );
  }

  return (
    <div className="space-y-12 animate-in fade-in slide-in-from-bottom-2 pb-12">
        
        {/* HEADER */}
        <div>
            <h1 className="text-3xl font-extrabold text-gray-900 dark:text-white mb-2">Espace Lecteur</h1>
            <p className="text-gray-500">Explorez l'actualité vérifiée et vos articles favoris.</p>
        </div>

        {/* SECTION 1: FEATURED (WORKFLOW PUBLIC 1) */}
        {featured.length > 0 && (
            <section>
                <div className="flex items-center gap-2 mb-6">
                    <Star className="text-yellow-500 fill-yellow-500" size={20} />
                    <h2 className="text-xl font-bold dark:text-white">Sélection du jour</h2>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {featured.map(article => (
                        <ArticleCard key={article.id} article={article} />
                    ))}
                </div>
            </section>
        )}

        {/* SECTION 2: FLUX COMPLET (WORKFLOW PUBLIC 2) */}
        <section>
            <div className="flex items-center justify-between mb-6 border-b border-gray-100 dark:border-zinc-800 pb-4">
                <div className="flex items-center gap-2">
                    <BookOpen className="text-[#3E7B52] dark:text-[#13EC13]" size={20} />
                    <h2 className="text-xl font-bold dark:text-white">Flux d'Articles</h2>
                </div>
            </div>

            <div className="flex flex-col gap-6">
                {feed.map(article => (
                    <Link 
                        key={article.id} 
                        href={`/articles/${article.id}`} 
                        className="group flex flex-col sm:flex-row gap-6 p-4 rounded-2xl bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 hover:border-[#3E7B52]/30 dark:hover:border-[#13EC13]/30 hover:shadow-md transition-all"
                    >
                        {/* Image avec Fallback */}
                        <div className="w-full sm:w-48 h-32 relative rounded-lg overflow-hidden shrink-0 bg-gray-200">
                            <Image 
                                src={article.imageCouvertureUrl || "https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=800&auto=format&fit=crop"}
                                alt={article.titre}
                                fill
                                className="object-cover group-hover:scale-105 transition-transform duration-500"
                            />
                        </div>
                        
                        <div className="flex-1 flex flex-col justify-center">
                            <div className="flex items-center gap-2 mb-2">
                                <span className="text-[10px] font-bold text-[#3E7B52] bg-green-50 px-2 py-0.5 rounded-full uppercase tracking-wider dark:bg-[#13EC13]/10 dark:text-[#13EC13]">
                                    {article.rubriqueNom || "Actualité"}
                                </span>
                                <span className="text-[10px] text-gray-400 flex items-center gap-1">
                                    <Clock size={10} />
                                    {article.datePublication ? new Date(article.datePublication).toLocaleDateString() : "Récemment"}
                                </span>
                            </div>
                            
                            <h3 className="text-lg font-bold text-gray-900 dark:text-white group-hover:text-[#3E7B52] transition-colors mb-2 line-clamp-2">
                                {article.titre}
                            </h3>
                            
                            <p className="text-sm text-gray-500 line-clamp-2 mb-3">
                                {article.description || "Cliquez pour lire l'intégralité de cet article..."}
                            </p>

                            <div className="flex items-center text-[#3E7B52] text-xs font-bold gap-1 group-hover:gap-2 transition-all mt-auto">
                                Lire l'article <ArrowRight size={14} />
                            </div>
                        </div>
                    </Link>
                ))}
            </div>
        </section>
    </div>
  );
}

// Mini composant carte local pour éviter la dépendance circulaire
function ArticleCard({ article }: { article: ArticleBackend }) {
    return (
        <Link href={`/articles/${article.id}`} className="relative h-64 rounded-xl overflow-hidden group shadow-lg">
            <Image 
                src={article.imageCouvertureUrl || "https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=800"} 
                alt={article.titre} 
                fill 
                className="object-cover transition-transform duration-700 group-hover:scale-110" 
            />
            <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent p-5 flex flex-col justify-end">
                <span className="text-xs text-green-300 font-bold uppercase mb-1">{article.rubriqueNom}</span>
                <h3 className="text-white font-bold leading-tight group-hover:underline decoration-green-400 decoration-2 underline-offset-4">{article.titre}</h3>
            </div>
        </Link>
    )
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\CreateRedacteur.tsx
================================================================================

"use client";

import React, { useState } from "react";
import { UserPlus, CheckCircle, AlertTriangle } from "lucide-react";
import { authService } from "@/services/auth";
import { Input } from "@/components/ui/Input";
import { Button } from "@/components/ui/Button";

export default function CreateRedacteur() {
  const [formData, setFormData] = useState({
    prenom: "",
    nom: "",
    email: "",
    motDePasse: ""
  });
  const [status, setStatus] = useState<"idle" | "loading" | "success" | "error">("idle");
  const [errorMessage, setErrorMessage] = useState("");

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setStatus("loading");
    setErrorMessage("");

    try {
        await authService.createRedacteur(formData);
        setStatus("success");
        setFormData({ prenom: "", nom: "", email: "", motDePasse: "" }); // Reset form
    } catch (error: any) {
        setStatus("error");
        setErrorMessage(error.message || "Erreur lors de la création.");
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  return (
    <div className="max-w-2xl animate-in fade-in slide-in-from-bottom-2 duration-300">
        <div className="mb-8">
            <h2 className="text-2xl font-extrabold text-gray-900 dark:text-white flex items-center gap-3">
                <UserPlus className="text-[#3E7B52] dark:text-[#13EC13]" />
                Créer un Compte Rédacteur
            </h2>
            <p className="text-gray-500 dark:text-zinc-400 text-sm mt-2">
                Ajoutez un membre à votre équipe éditoriale. Un email de confirmation sera envoyé.
            </p>
        </div>

        {status === "success" && (
            <div className="mb-6 p-4 bg-green-50 border border-green-200 text-green-800 rounded-lg flex items-center gap-2">
                <CheckCircle size={20} /> Compte Rédacteur créé avec succès !
            </div>
        )}

        {status === "error" && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 text-red-800 rounded-lg flex items-center gap-2">
                <AlertTriangle size={20} /> {errorMessage}
            </div>
        )}

        <form onSubmit={handleSubmit} className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 p-8 rounded-xl shadow-sm space-y-6">
            <div className="grid grid-cols-2 gap-4">
                <Input 
                    name="prenom" 
                    label="Prénom" 
                    placeholder="Ex: Amadou" 
                    value={formData.prenom} 
                    onChange={handleChange} 
                    required 
                    className="dark:bg-zinc-950 dark:border-zinc-700 dark:text-white"
                />
                <Input 
                    name="nom" 
                    label="Nom" 
                    placeholder="Ex: Diallo" 
                    value={formData.nom} 
                    onChange={handleChange} 
                    required 
                    className="dark:bg-zinc-950 dark:border-zinc-700 dark:text-white"
                />
            </div>
            
            <Input 
                name="email" 
                type="email" 
                label="Email Professionnel" 
                placeholder="redacteur@todaysafrica.com" 
                value={formData.email} 
                onChange={handleChange} 
                required 
                className="dark:bg-zinc-950 dark:border-zinc-700 dark:text-white"
            />

            <Input 
                name="motDePasse" 
                type="password" 
                label="Mot de passe provisoire" 
                placeholder="••••••••" 
                value={formData.motDePasse} 
                onChange={handleChange} 
                required 
                className="dark:bg-zinc-950 dark:border-zinc-700 dark:text-white"
            />

            <div className="pt-4 flex justify-end">
                <Button type="submit" disabled={status === "loading"} className="w-auto px-8 font-bold bg-[#3E7B52] hover:bg-[#326342]">
                    {status === "loading" ? "Création en cours..." : "Créer le rédacteur"}
                </Button>
            </div>
        </form>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\AdminArticles.tsx
================================================================================

"use client";

import React, { useEffect, useState } from 'react';
import { 
  CheckCircle, AlertTriangle, Archive, Calendar, 
  FileText, Loader2, ArrowUpRight, Check, X, Shield, 
  Eye, LayoutGrid, RotateCcw, Trash2
} from 'lucide-react';
import { ArticleService } from '@/services/article';
import { ArticleReadDto } from '@/types/article';
import { cn } from '@/lib/utils';
import { format } from 'date-fns';
import { fr } from 'date-fns/locale';
import ArticlePreviewModal from './ArticlePreviewModal';
import AdvancedPublishModal from './AdvancedPublishModal'; 

// Petit helper interne pour les cards stat
const StatCard = ({ label, value, icon: Icon, colorClass, borderClass }: any) => (
    <div className={cn("p-5 rounded-xl border bg-white dark:bg-zinc-900 shadow-sm flex items-center justify-between animate-in fade-in zoom-in-95 duration-500 hover:shadow-md transition-shadow", borderClass)}>
        <div>
            <p className="text-[10px] font-extrabold uppercase tracking-widest text-gray-400 mb-1">{label}</p>
            <p className={cn("text-3xl font-black", colorClass)}>{value !== null ? value : "-"}</p>
        </div>
        <div className={cn("p-3 rounded-xl opacity-20", colorClass.replace('text-', 'bg-'))}>
            <Icon size={24} className={colorClass} style={{ opacity: 1 }}/>
        </div>
    </div>
);

export default function AdminArticles() {
  
  // -- STATES --
  const [activeTab, setActiveTab] = useState<'PENDING_REVIEW' | 'APPROVED' | 'PUBLISHED' | 'ARCHIVED'>('PENDING_REVIEW');
  const [articles, setArticles] = useState<ArticleReadDto[]>([]);
  const [loading, setLoading] = useState(true);
  const [actionLoadingId, setActionLoadingId] = useState<number | null>(null);
  
  // -- MODAL --
  const [isPreviewOpen, setIsPreviewOpen] = useState(false);
  const [previewArticle, setPreviewArticle] = useState<ArticleReadDto | null>(null);
  const [isPublishModalOpen, setIsPublishModalOpen] = useState(false);
  const [articleToPublish, setArticleToPublish] = useState<number | null>(null);
  
  // States Stats 
  const [stats, setStats] = useState({ 
      total: 0,
      pending: 0, 
      approved: 0, 
      published: 0,
      archived: 0
  });

  // -- INIT LOAD --
  useEffect(() => {
    loadArticles();
    updateStats(); 
  }, [activeTab]);

  const loadArticles = async () => {
    setLoading(true);
    try {
        console.log(`📡 ADMIN LOAD LIST [${activeTab}]...`);
        // Note: Assurez-vous que votre backend gère bien le status 'ARCHIVED' dans /articles/by-status/
        const res = await ArticleService.getArticlesByStatus(activeTab, 0, 100);
        const list = Array.isArray(res) ? res : (res.content || []);
        setArticles(list);
    } catch (e) {
        console.error("❌ ERROR LIST:", e);
        setArticles([]);
    } finally {
        setLoading(false);
    }
  };

  // Chargement des compteurs pour les Stats
  const updateStats = async () => {
      try {
          const [p, a, pub, arc] = await Promise.all([
              ArticleService.getArticlesByStatus('PENDING_REVIEW', 0, 1),
              ArticleService.getArticlesByStatus('APPROVED', 0, 1),
              ArticleService.getArticlesByStatus('PUBLISHED', 0, 1),
              ArticleService.getArticlesByStatus('ARCHIVED', 0, 1) // On suppose que cette route existe ou retourne vide
          ]);

          const countPending = p.totalElements ?? p.length ?? 0;
          const countApproved = a.totalElements ?? a.length ?? 0;
          const countPublished = pub.totalElements ?? pub.length ?? 0;
          const countArchived = arc.totalElements ?? arc.length ?? 0;

          setStats({
              pending: countPending,
              approved: countApproved,
              published: countPublished,
              archived: countArchived,
              total: countPending + countApproved + countPublished + countArchived
          });
      } catch (e) { console.error("Stats Error", e); }
  };

  // --- ACTIONS PRINCIPALES (Passées au Modal) ---
  
  const openPreview = (article: ArticleReadDto) => {
      setPreviewArticle(article);
      setIsPreviewOpen(true);
  };

  const handleApprove = async (id: number) => {
    try {
        await ArticleService.approve(id);
        closeModalAndRefresh("✅ Article approuvé !");
    } catch (e: any) { alert(`Erreur: ${e.message}`); }
  };

  const handlePublish = async (id: number) => {
    try {
        await ArticleService.publish(id);
        closeModalAndRefresh("🎉 Article mis en ligne !");
    } catch (e: any) { alert(`Erreur: ${e.message}`); }
  };

  // Remplacer handlePublish par :
const initiatePublish = (id: number) => {
    setArticleToPublish(id);
    setIsPublishModalOpen(true);
}

  const handleReject = async (id: number) => {
      const motif = prompt("Motif du rejet :", "Non conforme à la ligne éditoriale.");
      if (motif === null) return;
      if (!motif.trim()) return alert("Motif requis.");

      try {
          await ArticleService.reject(id, motif);
          closeModalAndRefresh("Article rejeté.");
      } catch (e) { alert("Erreur lors du rejet."); }
  };

  const handleArchive = async (id: number) => {
      if(!confirm("⚠️ Confirmer l'archivage ? L'article ne sera plus visible publiquement.")) return;
      try {
          await ArticleService.archive(id);
          closeModalAndRefresh("Article archivé.");
      } catch (e) { alert("Erreur archivage."); }
  };

  // --- ACTIONS SPECIFIQUES ARCHIVAGE (Utilisées dans le Tableau) ---

  const handleRepublish = async (id: number) => {
      if(!confirm("📢 Voulez-vous remettre cet article en ligne immédiatement ?")) return;
      setActionLoadingId(id);
      try {
          // On réutilise publish car le backend permet souvent Archive -> Publish directement
          // Sinon il faut faire un restore (pending) -> approve -> publish
          await ArticleService.publish(id); 
          
          setArticles(prev => prev.filter(a => a.id !== id));
          updateStats();
          alert("L'article est de nouveau en ligne !");
      } catch(e: any) {
          alert(`Impossible de republier: ${e.message}`);
      } finally {
          setActionLoadingId(null);
      }
  };

  const handleDeletePermanently = async (id: number) => {
      if(!confirm("⛔ DANGER : Suppression DÉFINITIVE.\n\nCette action est irréversible. Voulez-vous vraiment supprimer cet article de la base de données ?")) return;
      
      setActionLoadingId(id);
      try {
          await ArticleService.delete(id);
          setArticles(prev => prev.filter(a => a.id !== id));
          updateStats();
      } catch(e) {
          alert("Erreur lors de la suppression.");
      } finally {
          setActionLoadingId(null);
      }
  };

  const closeModalAndRefresh = (msg?: string) => {
      if(msg) alert(msg);
      setIsPreviewOpen(false);
      setPreviewArticle(null);
      // Optimistic update pour fluidité
      if (previewArticle) {
          setArticles(prev => prev.filter(a => a.id !== previewArticle.id));
      }
      updateStats(); // Mise à jour réelle des compteurs
      loadArticles(); // Reload complet au cas où
  };

  // -- CONFIG TABS --
  const tabs = [
      { id: 'PENDING_REVIEW', label: 'En attente', icon: AlertTriangle, color: "text-orange-500" },
      { id: 'APPROVED', label: 'Validés', icon: CheckCircle, color: "text-blue-500" },
      { id: 'PUBLISHED', label: 'En Ligne', icon: ArrowUpRight, color: "text-green-600" },
      { id: 'ARCHIVED', label: 'Archivés', icon: Archive, color: "text-gray-500" },
  ];

  return (
    <div className="space-y-8 animate-in fade-in pb-32">
        
        {/* --- MODAL INTERACTIF --- */}
        <ArticlePreviewModal 
            isOpen={isPreviewOpen} 
            onClose={() => setIsPreviewOpen(false)} 
            article={previewArticle}
            isLoading={false} 
            // Passage des handlers au modal pour l'affichage Preview
            onApprove={handleApprove}
            onReject={handleReject}
            onPublish={handlePublish}
            onArchive={handleArchive}
        />
        {/* En dehors des boucles, au même niveau que ArticlePreviewModal */}
        {articleToPublish && (
            <AdvancedPublishModal 
                isOpen={isPublishModalOpen}
                onClose={() => { setIsPublishModalOpen(false); setArticleToPublish(null); }}
                articleId={articleToPublish}
                onSuccess={() => { closeModalAndRefresh("Publication configurée avec succès !"); }}
            />
        )}

        {/* --- HEADER --- */}
        <div>
            <h2 className="text-3xl font-black dark:text-white flex items-center gap-3">
                <Shield className="text-[#3E7B52] dark:text-[#13EC13] h-8 w-8"/> 
                Administration
            </h2>
            <p className="text-gray-500 dark:text-zinc-400 mt-2 font-medium">Pilotage du flux éditorial, validation et gestion des archives.</p>
        </div>

        {/* --- STATS CARDS (GRID OPTIMISÉE) --- */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
            <StatCard 
                label="Total Articles" 
                value={stats.total} 
                icon={LayoutGrid} 
                colorClass="text-indigo-600 dark:text-indigo-400" 
                borderClass="border-transparent bg-indigo-50/50 dark:bg-indigo-900/10"
            />
            <StatCard 
                label="À Valider" 
                value={stats.pending} 
                icon={AlertTriangle} 
                colorClass="text-orange-600" 
                borderClass={activeTab === 'PENDING_REVIEW' ? "border-orange-500 ring-1 ring-orange-500" : "border-transparent"}
            />
            <StatCard 
                label="Prêts" 
                value={stats.approved} 
                icon={Check} 
                colorClass="text-blue-600 dark:text-blue-400" 
                borderClass={activeTab === 'APPROVED' ? "border-blue-500 ring-1 ring-blue-500" : "border-transparent"}
            />
            <StatCard 
                label="En Ligne" 
                value={stats.published} 
                icon={ArrowUpRight} 
                colorClass="text-green-600 dark:text-green-400" 
                borderClass={activeTab === 'PUBLISHED' ? "border-green-500 ring-1 ring-green-500" : "border-transparent"}
            />
            <StatCard 
                label="Archivés" 
                value={stats.archived} 
                icon={Archive} 
                colorClass="text-gray-500 dark:text-zinc-400" 
                borderClass={activeTab === 'ARCHIVED' ? "border-gray-400 ring-1 ring-gray-400" : "border-transparent"}
            />
        </div>

        {/* --- TABS --- */}
        <div className="border-b border-gray-100 dark:border-zinc-800 pb-1 flex gap-6 overflow-x-auto">
            {tabs.map((tab) => (
                <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id as any)}
                    className={cn(
                        "flex items-center gap-2 pb-3 px-1 text-xs font-bold uppercase tracking-widest transition-all border-b-2 shrink-0",
                        activeTab === tab.id 
                            ? `border-[#3E7B52] dark:border-[#13EC13] text-black dark:text-white` 
                            : "border-transparent text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
                    )}
                >
                    <tab.icon size={16} className={activeTab === tab.id ? "text-[#3E7B52] dark:text-[#13EC13]" : "text-gray-300"} />
                    {tab.label}
                </button>
            ))}
        </div>

        {/* --- TABLEAU LISTING --- */}
        <div className="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm transition-all duration-300 min-h-[400px]">
            {loading ? (
                <div className="flex flex-col items-center justify-center py-32 gap-4">
                    <Loader2 className="animate-spin text-[#3E7B52] dark:text-[#13EC13]" size={40}/>
                    <p className="text-xs text-gray-400 font-bold uppercase tracking-wider animate-pulse">Synchronisation...</p>
                </div>
            ) : (
                <div className="overflow-x-auto">
                    <table className="w-full text-sm text-left">
                        <thead className="bg-gray-50/50 dark:bg-zinc-950/30 text-gray-400 uppercase text-[10px] font-extrabold border-b border-gray-100 dark:border-zinc-800 tracking-wider">
                            <tr>
                                <th className="px-8 py-5">Article</th>
                                <th className="px-6 py-5">Auteur</th>
                                <th className="px-6 py-5">Dates</th>
                                <th className="px-6 py-5 text-right">Actions</th>
                            </tr>
                        </thead>
                        
                        <tbody className="divide-y divide-gray-50 dark:divide-zinc-800/50">
                            {articles.length === 0 && (
                                <tr>
                                    <td colSpan={4} className="py-32 text-center">
                                        <div className="flex flex-col items-center gap-4 opacity-40">
                                            <div className="bg-gray-100 dark:bg-zinc-800 p-4 rounded-full">
                                                <FileText size={32} className="text-gray-400 dark:text-zinc-500"/>
                                            </div>
                                            <p className="text-sm font-semibold">Aucun article ici pour le moment.</p>
                                        </div>
                                    </td>
                                </tr>
                            )}

                            {articles.map((art) => (
                                <tr key={art.id} className="group hover:bg-gray-50 dark:hover:bg-zinc-800/20 transition-colors">
                                    
                                    {/* TITRE & ID */}
                                    <td className="px-8 py-5 max-w-xs md:max-w-md cursor-pointer" onClick={() => openPreview(art)}>
                                        <div className="font-bold text-base text-gray-900 dark:text-white group-hover:text-[#3E7B52] dark:group-hover:text-[#13EC13] transition-colors line-clamp-1">
                                            {art.titre || "Sans titre"}
                                        </div>
                                        <div className="flex items-center gap-2 mt-1.5">
                                            <span className="text-[9px] font-black uppercase px-2 py-0.5 rounded bg-gray-100 dark:bg-zinc-800 text-gray-500 dark:text-zinc-400">
                                                {art.rubriqueNom || "Général"}
                                            </span>
                                            {art.id && <span className="text-[10px] font-mono text-gray-300">#{art.id}</span>}
                                        </div>
                                    </td>

                                    {/* AUTEUR */}
                                    <td className="px-6 py-5">
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-gray-200 to-gray-300 dark:from-zinc-700 dark:to-zinc-800 flex items-center justify-center font-bold text-xs text-gray-600 dark:text-zinc-300 shadow-sm shrink-0">
                                                {art.auteurNom ? art.auteurNom.substring(0,2).toUpperCase() : "U"}
                                            </div>
                                            <div className="flex flex-col">
                                                <span className="font-bold text-xs text-gray-900 dark:text-gray-200 whitespace-nowrap">{art.auteurNom || "Rédacteur Inconnu"}</span>
                                                <span className="text-[10px] text-gray-400 hidden sm:inline">Rédacteur</span>
                                            </div>
                                        </div>
                                    </td>

                                    {/* DATES */}
                                    <td className="px-6 py-5">
                                        <div className="flex flex-col gap-1 text-xs">
                                            <div className="flex items-center gap-2 text-gray-500 dark:text-zinc-500 whitespace-nowrap">
                                                <Calendar size={12}/>
                                                <span>{art.dateCreation ? format(new Date(art.dateCreation), "d MMM yyyy", { locale: fr }) : "-"}</span>
                                            </div>
                                            {art.statut === 'PUBLISHED' && art.datePublication && (
                                                <span className="text-[#3E7B52] dark:text-[#13EC13] font-bold text-[10px] whitespace-nowrap">Publié le {format(new Date(art.datePublication), "dd/MM")}</span>
                                            )}
                                        </div>
                                    </td>

                                    {/* ACTIONS */}
                                    <td className="px-6 py-5">
                                        <div className="flex items-center justify-end gap-2">
                                            
                                            {/* Action Spécifique Archivé: Supprimer / Republier */}
                                            {activeTab === 'ARCHIVED' && (
                                                <>
                                                    <button 
                                                        onClick={() => handleRepublish(art.id)}
                                                        disabled={actionLoadingId === art.id}
                                                        className="h-8 w-8 flex items-center justify-center rounded hover:bg-blue-50 text-gray-400 hover:text-blue-600 transition-colors"
                                                        title="Republier"
                                                    >
                                                        {actionLoadingId === art.id ? <Loader2 className="animate-spin" size={16}/> : <RotateCcw size={16}/>}
                                                    </button>
                                                    <button 
                                                        onClick={() => handleDeletePermanently(art.id)}
                                                        disabled={actionLoadingId === art.id}
                                                        className="h-8 w-8 flex items-center justify-center rounded hover:bg-red-50 text-gray-400 hover:text-red-500 transition-colors"
                                                        title="Supprimer définitivement"
                                                    >
                                                        <Trash2 size={16}/>
                                                    </button>
                                                    <span className="w-px h-4 bg-gray-200 dark:bg-zinc-800 mx-1"></span>
                                                </>
                                            )}

                                            {/* Bouton Principal (Voir/Valider) */}
                                            <button 
                                                onClick={() => openPreview(art)}
                                                className={cn(
                                                    "h-9 px-4 rounded-lg text-xs font-bold flex items-center gap-2 transition-all shadow-sm whitespace-nowrap",
                                                    activeTab === 'PENDING_REVIEW' 
                                                        ? "bg-[#3E7B52] hover:bg-[#2e623f] text-white hover:shadow-md dark:bg-[#13EC13] dark:text-black dark:hover:bg-[#0dbd0d]" 
                                                        : "bg-white border border-gray-200 hover:border-gray-300 hover:bg-gray-50 text-gray-600 dark:bg-zinc-800 dark:border-zinc-700 dark:text-gray-300"
                                                )}
                                            >
                                                {activeTab === 'PENDING_REVIEW' ? <CheckCircle size={14}/> : <Eye size={14}/>}
                                                <span className="hidden md:inline">{activeTab === 'PENDING_REVIEW' ? "Décider" : "Aperçu"}</span>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            )}
        </div>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\AdminRedacteur.tsx
================================================================================

"use client";

import React, { useEffect, useState } from 'react';
import { AdminService } from '@/services/admin'; // ✅ Logique déplacée ici
import { Users, User, ShieldCheck, UserPlus, X, Search, Loader2, Mail, Calendar, Hash } from 'lucide-react';
import { Button } from '@/components/ui/Button';
import { cn } from '@/lib/utils';
import { authService } from '@/services/auth';

interface UserData {
    id: number;
    nom: string;
    prenom: string;
    email: string;
    role: string;
    dateCreation?: string;
    actif?: boolean;
    stats?: {
        totalArticles: number;
        vues: number;
    };
}

export default function AdminRedacteurs() {
  const [activeTab, setActiveTab] = useState<'TEAM' | 'USERS'>('TEAM');
  const [dataList, setDataList] = useState<UserData[]>([]);
  const [loading, setLoading] = useState(true);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");

  useEffect(() => {
    loadData();
  }, [activeTab]);

  const loadData = async () => {
    setLoading(true);
    try {
        if (activeTab === 'TEAM') {
            const rawRedacteurs = await AdminService.getAllRedacteurs();
            
            // Enrichissement réel par l'API de Stats
            const enriched = await Promise.all(rawRedacteurs.map(async (u) => {
                const s = await AdminService.getAuthorStats(u.id);
                return {
                    ...u,
                    stats: {
                        totalArticles: s?.totalArticles || 0,
                        vues: s?.vues || s?.totalVues || 0 // Gestion des variantes de noms de champs
                    }
                };
            }));
            setDataList(enriched);
        } else {
            const all = await AdminService.getAllUsers();
            setDataList(all);
        }
    } catch(e) {
        console.error("Erreur de chargement de l'annuaire");
    } finally {
        setLoading(false);
    }
  };

  const handleSuccessCreate = () => {
      setIsModalOpen(false);
      setActiveTab('TEAM');
      loadData(); 
  };

  const filteredList = dataList.filter(u => 
      `${u.nom} ${u.prenom} ${u.email}`.toLowerCase().includes(searchQuery.toLowerCase())
  );

  return (
    <div className="pb-20 space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300">
        
        {/* --- HEADER (Couleurs passées en Vert #3E7B52) --- */}
        <div className="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 border-b border-gray-100 dark:border-zinc-800 pb-6">
            <div className="space-y-4">
                <div>
                    <h2 className="text-2xl font-black text-gray-900 dark:text-white flex items-center gap-3">
                        <Users className="text-[#3E7B52]" />
                        Annuaire des Membres
                    </h2>
                    <p className="text-sm text-gray-500 mt-1">Supervisez l'équipe de rédaction et les comptes utilisateurs.</p>
                </div>
                
                <div className="flex p-1 bg-gray-100 dark:bg-zinc-900 rounded-lg w-fit">
                    <button
                        onClick={() => { setActiveTab('TEAM'); setSearchQuery(""); }}
                        className={cn(
                            "px-4 py-2 text-xs font-bold rounded-md transition-all flex items-center gap-2",
                            activeTab === 'TEAM' 
                                ? "bg-white dark:bg-zinc-800 text-[#3E7B52] shadow-sm" 
                                : "text-gray-400 hover:text-gray-600"
                        )}
                    >
                        <ShieldCheck size={14}/> Équipe
                    </button>
                    <button
                        onClick={() => { setActiveTab('USERS'); setSearchQuery(""); }}
                        className={cn(
                            "px-4 py-2 text-xs font-bold rounded-md transition-all flex items-center gap-2",
                            activeTab === 'USERS' 
                                ? "bg-white dark:bg-zinc-800 text-[#3E7B52] shadow-sm" 
                                : "text-gray-400 hover:text-gray-600"
                        )}
                    >
                        <User size={14}/> Tous les membres
                    </button>
                </div>
            </div>

            <div className="flex gap-3 w-full md:w-auto items-center">
                <div className="relative w-full md:w-64">
                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-300" size={16}/>
                    <input 
                        type="text" 
                        placeholder="Rechercher..." 
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        className="pl-9 pr-4 h-10 w-full rounded-lg border border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-sm outline-none focus:ring-2 focus:ring-[#3E7B52]/20"
                    />
                </div>
                <Button 
                    onClick={() => setIsModalOpen(true)}
                    className="w-auto h-10 px-4 font-bold bg-[#3E7B52] hover:bg-[#326342] text-white border-none"
                >
                    <UserPlus size={16} className="mr-2"/> Rédacteur
                </Button>
            </div>
        </div>

        {/* --- LISTING --- */}
        {loading ? (
            <div className="py-20 flex flex-col items-center justify-center gap-4 text-gray-400">
                <Loader2 className="animate-spin text-[#3E7B52]" size={32}/>
                <p className="text-xs font-bold uppercase tracking-widest">Récupération des données...</p>
            </div>
        ) : filteredList.length === 0 ? (
            <div className="text-center py-20 bg-gray-50/50 dark:bg-zinc-900 rounded-xl border border-dashed dark:border-zinc-800">
                <p className="text-gray-500">Aucun profil ne correspond à cette recherche.</p>
            </div>
        ) : (
            <>
            {activeTab === 'TEAM' && (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {filteredList.map((r) => (
                        <div key={r.id} className="group bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 p-6 rounded-2xl shadow-sm hover:shadow-md transition-all">
                            <div className="flex items-start gap-4 mb-6">
                                <div className="w-12 h-12 bg-[#3E7B52] text-white rounded-xl flex items-center justify-center text-lg font-bold">
                                    {r.prenom?.[0]}{r.nom?.[0]}
                                </div>
                                <div className="overflow-hidden">
                                    <h3 className="font-bold text-gray-900 dark:text-white truncate">{r.prenom} {r.nom}</h3>
                                    <p className="text-[10px] font-black uppercase text-[#3E7B52] mt-0.5">{r.role}</p>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2 border-t dark:border-zinc-800 pt-4">
                                <div className="text-center">
                                    <p className="text-xl font-black text-gray-900 dark:text-white">{compactNumber(r.stats?.totalArticles)}</p>
                                    <p className="text-[9px] text-gray-400 font-bold uppercase">Articles</p>
                                </div>
                                <div className="text-center border-l dark:border-zinc-800">
                                    <p className="text-xl font-black text-[#13EC13]">{compactNumber(r.stats?.vues)}</p>
                                    <p className="text-[9px] text-gray-400 font-bold uppercase">Lectures</p>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            )}

            {activeTab === 'USERS' && (
                <div className="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 rounded-xl overflow-hidden">
                    <table className="w-full text-sm text-left">
                        <thead className="bg-gray-50 dark:bg-zinc-950 text-gray-400 text-[10px] font-bold uppercase tracking-wider">
                            <tr>
                                <th className="px-6 py-4">Nom Complet</th>
                                <th className="px-6 py-4">Contact Email</th>
                                <th className="px-6 py-4">Rôle Système</th>
                                <th className="px-6 py-4 text-right">Identifiant</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-50 dark:divide-zinc-800">
                            {filteredList.map((u) => (
                                <tr key={u.id} className="hover:bg-gray-50 dark:hover:bg-zinc-800/30 transition-colors">
                                    <td className="px-6 py-4 font-bold text-gray-900 dark:text-white">
                                        {u.prenom} {u.nom}
                                    </td>
                                    <td className="px-6 py-4 text-gray-500 font-mono text-xs">{u.email}</td>
                                    <td className="px-6 py-4">
                                        <span className={cn(
                                            "px-2 py-0.5 rounded text-[10px] font-bold uppercase border",
                                            u.role === 'ADMIN' ? "bg-purple-50 text-purple-700 border-purple-200" :
                                            u.role === 'REDACTEUR' ? "bg-green-50 text-[#3E7B52] border-[#3E7B52]/20" :
                                            "bg-gray-100 text-gray-500 border-gray-200"
                                        )}>
                                            {u.role}
                                        </span>
                                    </td>
                                    <td className="px-6 py-4 text-right text-gray-300 font-mono text-[10px]">#{u.id}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            )}
            </>
        )}

        {/* --- MODAL (Logique d'inscription Staff) --- */}
        {isModalOpen && (
            <div className="fixed inset-0 z-[60] flex items-center justify-center p-4">
                <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setIsModalOpen(false)}/>
                <div className="relative bg-white dark:bg-zinc-900 w-full max-w-md rounded-2xl shadow-2xl border dark:border-zinc-800 animate-in zoom-in-95">
                    <div className="px-6 py-4 border-b dark:border-zinc-800 flex justify-between items-center bg-gray-50/50">
                        <h3 className="font-bold text-[#3E7B52] uppercase text-xs">Ajouter à l'équipe</h3>
                        <button onClick={() => setIsModalOpen(false)}><X size={18} className="text-gray-400"/></button>
                    </div>
                    <form onSubmit={async (e) => {
                        e.preventDefault();
                        const data = new FormData(e.currentTarget);
                        try {
                            await authService.createRedacteur({
                                prenom: data.get('prenom') as string,
                                nom: data.get('nom') as string,
                                email: data.get('email') as string,
                                motDePasse: data.get('password') as string,
                            });
                            handleSuccessCreate();
                        } catch { alert("Échec de création. Vérifiez l'email."); }
                    }} className="p-6 space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                            <div className="space-y-1">
                                <label className="text-[10px] font-bold text-gray-400 uppercase">Prénom</label>
                                <input name="prenom" required className="w-full p-2 bg-gray-50 dark:bg-zinc-800 border rounded text-sm outline-none dark:text-white dark:border-zinc-700"/>
                            </div>
                            <div className="space-y-1">
                                <label className="text-[10px] font-bold text-gray-400 uppercase">Nom</label>
                                <input name="nom" required className="w-full p-2 bg-gray-50 dark:bg-zinc-800 border rounded text-sm outline-none dark:text-white dark:border-zinc-700"/>
                            </div>
                        </div>
                        <div className="space-y-1">
                            <label className="text-[10px] font-bold text-gray-400 uppercase">Email Pro</label>
                            <input name="email" type="email" required className="w-full p-2 bg-gray-50 dark:bg-zinc-800 border rounded text-sm outline-none dark:text-white dark:border-zinc-700"/>
                        </div>
                        <div className="space-y-1">
                            <label className="text-[10px] font-bold text-gray-400 uppercase">Mot de passe temporaire</label>
                            <input name="password" type="password" required className="w-full p-2 bg-gray-50 dark:bg-zinc-800 border rounded text-sm outline-none dark:text-white dark:border-zinc-700"/>
                        </div>
                        <Button type="submit" className="w-full h-11 bg-[#3E7B52] font-black uppercase text-xs">Créer le profil Staff</Button>
                    </form>
                </div>
            </div>
        )}
    </div>
  );
}

function compactNumber(num?: number) {
    if (!num) return '0';
    return Intl.NumberFormat('en-US', { notation: "compact", maximumFractionDigits: 1 }).format(num);
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\ArticlePreviewModal.tsx
================================================================================

"use client";

import React, { useEffect, useState } from "react";
import Image from "next/image";
import { 
  X, CheckCircle, Calendar, User, ArrowLeft, Loader2, 
  XCircle, Send, Archive, Globe, AlertTriangle, 
  Trash2, RotateCcw // ✅ Icônes ajoutées
} from "lucide-react";
import { ArticleReadDto } from "@/types/article"; 
import { Button } from "@/components/ui/Button";
import { cn } from "@/lib/utils";

interface PreviewProps {
  isOpen: boolean;
  onClose: () => void;
  article: ArticleReadDto | null;
  // Handlers d'actions (promesses pour gérer le loading local)
  onApprove?: (id: number) => Promise<void>;
  onReject?: (id: number) => Promise<void>;
  onPublish?: (id: number) => Promise<void>;
  onArchive?: (id: number) => Promise<void>;
  // ✅ Nouveaux Handlers pour les Archives
  onRepublish?: (id: number) => Promise<void>;
  onDelete?: (id: number) => Promise<void>;
  
  isLoading?: boolean; // Loading global du parent
}

export default function ArticlePreviewModal({ 
    isOpen, onClose, article, isLoading: parentLoading, 
    onApprove, onReject, onPublish, onArchive,
    onRepublish, onDelete // ✅ Destructuring des nouvelles props
}: PreviewProps) {
  
  // Gestion d'état local pour le loading des boutons d'action
  const [isActionLoading, setIsActionLoading] = useState(false);

  // Bloque le scroll du body quand le modal est ouvert
  useEffect(() => {
    document.body.style.overflow = isOpen ? "hidden" : "unset";
    return () => { document.body.style.overflow = "unset"; };
  }, [isOpen]);

  // Handler wrapper pour gérer le state de chargement
  const handleAction = async (action: ((id: number) => Promise<void>) | undefined) => {
      if (!action || !article) return;
      setIsActionLoading(true);
      try {
          await action(article.id);
          // Le modal ne se ferme pas ici, c'est le parent qui décide
      } catch (e) {
          console.error(e);
      } finally {
          setIsActionLoading(false);
      }
  };

  if (!isOpen) return null;

  if (!article || parentLoading) {
      return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-md animate-in fade-in">
            <div className="bg-white dark:bg-zinc-900 p-6 rounded-xl flex flex-col items-center gap-3 border border-gray-100 dark:border-zinc-800 shadow-2xl">
                <Loader2 className="animate-spin text-[#3E7B52]" size={32}/>
                <span className="text-sm font-medium dark:text-white">Chargement...</span>
            </div>
        </div>
      );
  }

  // Sécurisation et tri des blocs de contenu
  const safeBlocs = (article.blocsContenu || []).sort((a: any, b: any) => a.ordre - b.ordre);

  // --- Rendu des Blocs (Fonction de rendu) ---
  const renderBlock = (bloc: any, idx: number) => {
      if(bloc.type === 'IMAGE') {
          return (
            <figure key={idx} className="my-8 relative w-full group">
                <div className="relative w-full h-[300px] md:h-[500px] rounded-lg overflow-hidden bg-gray-100 dark:bg-zinc-800 shadow-sm border border-gray-100 dark:border-zinc-800">
                    <Image 
                        src={bloc.url || bloc.contenu || ""} 
                        alt={bloc.altText || "Illustration"} 
                        fill className="object-cover" unoptimized={true} 
                    />
                </div>
                {(bloc.legende) && (
                    <figcaption className="text-center text-xs text-gray-500 mt-2 italic border-b border-dashed border-gray-200 dark:border-zinc-800 pb-2 inline-block px-4">
                        {bloc.legende}
                    </figcaption>
                )}
            </figure>
          );
      }
      if(bloc.type === 'CITATION') {
          return (
            <blockquote key={idx} className="relative pl-6 my-10 italic text-xl md:text-2xl text-gray-800 dark:text-gray-200 leading-relaxed font-serif">
                <span className="absolute left-0 top-0 text-6xl text-[#3E7B52] opacity-30 font-black h-4 leading-3">“</span>
                {bloc.contenu}
            </blockquote>
          );
      }
      // HTML Text
      return (
          <div key={idx} 
               className="prose prose-lg dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-loose my-6 font-serif" 
               dangerouslySetInnerHTML={{ __html: bloc.contenu }} 
          />
      );
  };

  // Helper pour badge statut
  const getStatusInfo = (status: string) => {
      switch(status) {
          case 'PENDING_REVIEW': return { label: 'En attente de validation', class: 'bg-orange-100 text-orange-700 border-orange-200', icon: AlertTriangle };
          case 'APPROVED': return { label: 'Validé (Prêt à publier)', class: 'bg-blue-100 text-blue-700 border-blue-200', icon: CheckCircle };
          case 'PUBLISHED': return { label: 'En ligne (Publique)', class: 'bg-green-100 text-green-700 border-green-200', icon: Globe };
          case 'REJECTED': return { label: 'Rejeté', class: 'bg-red-100 text-red-700 border-red-200', icon: XCircle };
          case 'ARCHIVED': return { label: 'Archivé', class: 'bg-gray-100 text-gray-700 border-gray-200', icon: Archive };
          default: return { label: status, class: 'bg-gray-100 text-gray-500', icon: CheckCircle };
      }
  };

  const statusInfo = getStatusInfo(article.statut);
  const StatusIcon = statusInfo.icon;

  return (
    <div className="fixed inset-0 z-[60] flex justify-center items-end md:items-center animate-in fade-in duration-300">
      {/* Overlay Clsoing Click */}
      <div className="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onClick={onClose} />
      
      {/* Main Card */}
      <div className="relative w-full h-[95vh] md:w-[90vw] md:h-[90vh] bg-white dark:bg-[#0a0a0a] md:rounded-2xl shadow-2xl flex flex-col overflow-hidden ring-1 ring-white/10 animate-in slide-in-from-bottom-10 duration-500">
        
        {/* --- HEADER --- */}
        <div className="flex items-center justify-between px-6 py-4 border-b border-gray-100 dark:border-zinc-800 bg-white/80 dark:bg-[#0a0a0a]/80 backdrop-blur z-20 sticky top-0">
            <div className="flex items-center gap-4">
                <button onClick={onClose} className="p-2 -ml-2 hover:bg-gray-100 dark:hover:bg-zinc-800 rounded-full transition-colors text-gray-500 dark:text-white">
                    <ArrowLeft className="md:hidden" size={24} />
                    <X className="hidden md:block" size={24} />
                </button>
                <div className="flex flex-col">
                    <h3 className="font-bold text-gray-900 dark:text-white text-sm hidden md:block">
                        APERCU ARTICLE #{article.id}
                    </h3>
                    <div className={cn("flex items-center gap-1.5 px-2 py-0.5 rounded text-[10px] font-bold uppercase w-fit border", statusInfo.class)}>
                        <StatusIcon size={10} /> {statusInfo.label}
                    </div>
                </div>
            </div>
            
            {/* Infos rapides Admin */}
            <div className="flex items-center gap-4 text-xs font-mono text-gray-400">
                <span className="hidden sm:block">Auteur: {article.auteurNom}</span>
            </div>
        </div>

        {/* --- CONTENU DE L'ARTICLE (SCROLLABLE) --- */}
        <div className="flex-1 overflow-y-auto bg-white dark:bg-black scroll-smooth custom-scrollbar">
            <main className="max-w-[800px] mx-auto px-6 py-12 md:py-16">
                 
                 {/* En-tête Article */}
                 <div className="text-center max-w-3xl mx-auto mb-12">
                     <span className="text-[#3E7B52] dark:text-[#13EC13] text-xs font-black uppercase tracking-[0.2em] mb-4 inline-block px-3 py-1 rounded border border-[#3E7B52]/20 dark:border-[#13EC13]/20">
                         {article.rubriqueNom || "Rubrique"}
                     </span>
                     
                     <h1 className="text-3xl md:text-5xl lg:text-6xl font-black text-gray-900 dark:text-white leading-[1.1] mb-8 tracking-tight">
                        {article.titre}
                     </h1>
                     
                     <p className="text-lg md:text-xl text-gray-500 dark:text-zinc-400 font-serif leading-relaxed italic border-l-2 border-[#3E7B52] pl-6 md:pl-0 md:border-none">
                        {article.description}
                     </p>
                     
                     {/* Méta-données Auteur/Date */}
                     <div className="flex justify-center items-center gap-3 mt-10 pt-8 border-t border-gray-100 dark:border-zinc-800 text-xs font-bold uppercase tracking-wider text-gray-400">
                        <span className="flex items-center gap-2 text-black dark:text-white bg-gray-100 dark:bg-zinc-800 px-3 py-1.5 rounded-full">
                             <User size={14} className="text-[#3E7B52] dark:text-[#13EC13]"/> {article.auteurNom || "Rédaction"}
                        </span>
                        <span className="flex items-center gap-2 px-2">
                            <Calendar size={14}/> {article.dateCreation ? new Date(article.dateCreation).toLocaleDateString() : "Date N/A"}
                        </span>
                     </div>
                 </div>

                 {/* Cover Image (Grande) */}
                 {article.imageCouvertureUrl && (
                     <div className="relative w-full aspect-video md:aspect-[2/1] rounded-2xl overflow-hidden mb-16 shadow-2xl border-4 border-white dark:border-zinc-900 ring-1 ring-gray-100 dark:ring-zinc-800">
                         <Image src={article.imageCouvertureUrl} alt={article.titre} fill className="object-cover" priority unoptimized={true} />
                     </div>
                 )}

                 {/* Corps du texte */}
                 <div className="max-w-[700px] mx-auto article-content">
                    {safeBlocs.length > 0 
                        ? safeBlocs.map((b: any, i: number) => renderBlock(b, i)) 
                        : <div className="text-center py-20 bg-gray-50 dark:bg-zinc-900 rounded-xl border border-dashed dark:border-zinc-800"><p className="text-gray-400">Contenu vide.</p></div>
                    }
                 </div>
            </main>
        </div>

        {/* --- FOOTER : BARRE D'ACTIONS ADMIN (Sticky Bottom) --- */}
        <div className="p-4 md:px-8 border-t border-gray-100 dark:border-zinc-800 bg-white dark:bg-[#0a0a0a] z-30 shrink-0">
            <div className="flex flex-col sm:flex-row gap-3 items-center justify-between max-w-6xl mx-auto w-full">
                
                {/* Information contexte (Visible sur Desktop) */}
                <div className="hidden sm:flex items-center gap-2 text-xs text-gray-400">
                    <span className="font-mono">ID:{article.id}</span>
                    <span className="h-4 w-px bg-gray-200 dark:bg-zinc-700"/>
                    <span>Zone: {article.region || "Global"}</span>
                </div>
                
                {/* Zone de Boutons dynamiques selon Workflow */}
                <div className="flex gap-3 w-full sm:w-auto justify-end">
                    
                    {/* SCÉNARIO 1 : ARTICLE EN REVUE (DRAFT -> VALIDATED) */}
                    {article.statut === 'PENDING_REVIEW' && (
                        <>
                            {onReject && (
                                <Button 
                                    onClick={() => handleAction(onReject)}
                                    disabled={isActionLoading}
                                    variant="outline"
                                    className="border-red-200 p-3 text-red-600 hover:bg-red-50 hover:border-red-300 dark:border-red-900/50 dark:text-red-400 dark:hover:bg-red-950"
                                >
                                    <XCircle size={18} className="mr-2"/> Rejeter
                                </Button>
                            )}
                            {onApprove && (
                                <Button 
                                    onClick={() => handleAction(onApprove)} 
                                    disabled={isActionLoading}
                                    className="bg-blue-600 p-3 hover:bg-blue-700 text-white font-bold"
                                >
                                    {isActionLoading ? <Loader2 className="animate-spin mr-2" size={18}/> : <CheckCircle size={18} className="mr-2"/>}
                                    Approuver la rédaction
                                </Button>
                            )}
                        </>
                    )}

                    {/* SCÉNARIO 2 : ARTICLE VALIDÉ (APPROVED -> PUBLISHED) */}
                    {article.statut === 'APPROVED' && onPublish && (
                        <>
                            <div className="text-xs text-blue-600 font-bold bg-blue-50 dark:bg-blue-900/20 px-3 py-2 rounded hidden sm:block">
                                Cet article a été validé. Prêt pour mise en ligne.
                            </div>
                            <Button 
                                onClick={() => handleAction(onPublish)}
                                disabled={isActionLoading}
                                className="w-full p-3 sm:w-auto bg-[#3E7B52] hover:bg-[#326342] text-white font-bold shadow-lg shadow-green-900/20"
                            >
                                {isActionLoading ? <Loader2 className="animate-spin mr-2" size={18}/> : <Globe size={18} className="mr-2"/>}
                                Publier maintenant
                            </Button>
                        </>
                    )}

                    {/* SCÉNARIO 3 : ARTICLE EN LIGNE (PUBLISHED -> ARCHIVED) */}
                    {article.statut === 'PUBLISHED' && onArchive && (
                        <Button 
                            onClick={() => handleAction(onArchive)}
                            disabled={isActionLoading}
                            variant="outline"
                            className="text-gray-500 p-3 border-gray-300 hover:bg-gray-100 hover:text-black dark:border-zinc-700 dark:text-gray-400 dark:hover:text-white"
                        >
                            {isActionLoading ? <Loader2 className="animate-spin mr-2" size={18}/> : <Archive size={18} className="mr-2"/>}
                            Archiver / Retirer du site
                        </Button>
                    )}

                    {/* ✅ SCÉNARIO 4 : ARTICLE ARCHIVÉ (ARCHIVED -> RESTORE or DELETE) */}
                    {article.statut === 'ARCHIVED' && (
                        <>
                           <div className="text-xs text-gray-400 italic font-medium px-3 py-2 hidden sm:block">
                                Cet article est hors ligne.
                            </div>
                            {onDelete && (
                                <Button 
                                    onClick={() => handleAction(onDelete)}
                                    disabled={isActionLoading}
                                    variant="outline"
                                    className="border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 dark:border-red-900/50 dark:text-red-400 dark:hover:bg-red-950/20"
                                >
                                    <Trash2 size={18} className="mr-2"/> Supprimer
                                </Button>
                            )}
                            {onRepublish && (
                                <Button 
                                    onClick={() => handleAction(onRepublish)}
                                    disabled={isActionLoading}
                                    className="bg-blue-600 hover:bg-blue-700 text-white font-bold"
                                >
                                    {isActionLoading ? <Loader2 className="animate-spin mr-2" size={18}/> : <RotateCcw size={18} className="mr-2"/>}
                                    Republier
                                </Button>
                            )}
                        </>
                    )}

                    {/* Default fallback */}
                    {['REJECTED', 'DRAFT'].includes(article.statut) && (
                        <span className="text-xs text-gray-400 italic">
                            Aucune action disponible pour le statut {article.statut}.
                        </span>
                    )}
                </div>
            </div>
        </div>

      </div>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\NewArticle.tsx
================================================================================

// FICHIER: components/dashboard/NewArticle.tsx - VERSION CORRIGÉE

"use client";

import React, { useState, useEffect } from 'react';
import { Save, Loader2, Send, ArrowLeft, AlertTriangle } from 'lucide-react';
import { Button } from '@/components/ui/Button'; 
import { ArticleService } from '@/services/article';
import { useAuth } from '@/context/AuthContext';
import { cn, getImageUrl } from '@/lib/utils';
import ArticleSettings from './new-article/ArticleSettings';
import Toolbar from './new-article/Toolbar';
import EditorContentComp from './new-article/EditorContent';
import { ArticlePayloadDto, BlocContenuDto } from '@/types/article';

interface NewArticleProps {
  onSuccess?: () => void;
  onCancel?: () => void;
  editArticleId?: number | null; 
}

// Sous-composant Skeleton pour NewArticle
const ArticleEditorSkeleton = () => (
  <div className="max-w-7xl mx-auto pb-32 animate-pulse space-y-6">
    
    {/* Header Skeleton */}
    <div className="sticky top-0 z-40 bg-white/95 dark:bg-black/95 backdrop-blur py-4 border-b border-gray-100 dark:border-zinc-800 flex justify-between items-center">
        <div className="flex items-center gap-3">
             {/* Back Button */}
             <div className="w-10 h-10 rounded-full bg-gray-200 dark:bg-zinc-800"></div>
             <div className="space-y-2">
                 {/* Title */}
                 <div className="w-32 h-5 bg-gray-200 dark:bg-zinc-800 rounded"></div>
                 {/* Subtitle */}
                 <div className="w-20 h-3 bg-gray-200 dark:bg-zinc-800 rounded"></div>
             </div>
        </div>
        <div className="flex gap-3">
             {/* Action Buttons */}
             <div className="w-24 h-10 rounded-lg bg-gray-200 dark:bg-zinc-800"></div>
             <div className="w-32 h-10 rounded-lg bg-gray-200 dark:bg-zinc-800"></div>
        </div>
    </div>

    {/* Content Grid Skeleton */}
    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
        
        {/* Colonne Principale (Éditeur) */}
        <div className="lg:col-span-8 space-y-4">
             <div className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-2xl h-[700px] p-4 flex flex-col gap-4">
                 {/* Toolbar fake */}
                 <div className="w-full h-12 bg-gray-100 dark:bg-zinc-800 rounded-lg"></div>
                 {/* Text fake */}
                 <div className="space-y-4 mt-4 px-4">
                      <div className="w-3/4 h-4 bg-gray-100 dark:bg-zinc-800 rounded"></div>
                      <div className="w-full h-4 bg-gray-100 dark:bg-zinc-800 rounded"></div>
                      <div className="w-5/6 h-4 bg-gray-100 dark:bg-zinc-800 rounded"></div>
                      <div className="w-full h-64 bg-gray-100 dark:bg-zinc-800 rounded-xl mt-8"></div>
                      <div className="w-full h-4 bg-gray-100 dark:bg-zinc-800 rounded"></div>
                 </div>
             </div>
        </div>

        {/* Colonne Sidebar (Paramètres) */}
        <div className="lg:col-span-4 space-y-6">
            
            {/* Box 1: Infos */}
            <div className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl p-5 space-y-6">
                 {/* Input Titre */}
                 <div className="space-y-2">
                     <div className="flex justify-between">
                         <div className="w-20 h-3 bg-gray-200 dark:bg-zinc-800 rounded"></div>
                         <div className="w-8 h-3 bg-gray-200 dark:bg-zinc-800 rounded"></div>
                     </div>
                     <div className="w-full h-12 bg-gray-100 dark:bg-zinc-800 rounded-lg"></div>
                 </div>
                 {/* Input Description */}
                 <div className="space-y-2">
                     <div className="flex justify-between">
                         <div className="w-20 h-3 bg-gray-200 dark:bg-zinc-800 rounded"></div>
                         <div className="w-8 h-3 bg-gray-200 dark:bg-zinc-800 rounded"></div>
                     </div>
                     <div className="w-full h-24 bg-gray-100 dark:bg-zinc-800 rounded-lg"></div>
                 </div>
            </div>

            {/* Box 2: Image */}
            <div className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl p-5">
                 <div className="w-24 h-3 bg-gray-200 dark:bg-zinc-800 rounded mb-3"></div>
                 <div className="w-full aspect-video bg-gray-100 dark:bg-zinc-800 rounded-xl"></div>
            </div>

             {/* Box 3: Targeting */}
            <div className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-xl p-5 space-y-4">
                 <div className="w-full h-12 bg-gray-100 dark:bg-zinc-800 rounded-lg"></div>
                 <div className="w-full h-12 bg-gray-100 dark:bg-zinc-800 rounded-lg"></div>
            </div>

        </div>

    </div>
  </div>
);

export default function NewArticle({ onSuccess, editArticleId, onCancel }: NewArticleProps) {
  
  const { user } = useAuth();
  
  // === STATE ===
  const [articleId, setArticleId] = useState<number | null>(null);
  const [titre, setTitre] = useState("");
  const [description, setDescription] = useState("");
  const [rubriqueId, setRubriqueId] = useState<number | null>(null);
  const [region, setRegion] = useState("GLOBAL");
  const [coverImageId, setCoverImageId] = useState<string | number | null>(null);
  const [coverImageUrl, setCoverImageUrl] = useState<string | null>(null);
  const [editorInstance, setEditorInstance] = useState<any>(null);
  const [htmlContent, setHtmlContent] = useState("");
  const [contentLoaded, setContentLoaded] = useState(false); // Flag pour savoir si le HTML est prêt
    // ✅ STATE TAGS
  const [tags, setTags] = useState<string[]>([]);
  const [isAutoTagging, setIsAutoTagging] = useState(false);

  // UI State
  const [uiState, setUiState] = useState({ 
    loading: false, 
    saving: false, 
    error: null as string | null 
  });

  // =========================================================
  // 1. CHARGEMENT DES DONNÉES (API -> STATE)
  // =========================================================
  useEffect(() => {
    if (editArticleId) {
      setUiState(p => ({ ...p, loading: true }));
      setContentLoaded(false);
      
      console.log(`📡 [NewArticle] Chargement du brouillon #${editArticleId}...`);

      ArticleService.getById(editArticleId)
        .then(article => {
          setArticleId(article.id);
          setTitre(article.titre || "");
          setDescription(article.description || "");
          setRubriqueId(article.rubriqueId || null);
          setRegion(article.region || "GLOBAL");
          
          // Image Couverture
          setCoverImageUrl(getImageUrl(article.imageCouvertureUrl) || null);
          setCoverImageId(article.imageCouvertureId || null);

          // RECONSTRUCTION DU HTML DEPUIS LES BLOCS
          if (article.blocsContenu && Array.isArray(article.blocsContenu)) {
            const sorted = [...article.blocsContenu].sort((a, b) => a.ordre - b.ordre);
            
            let rebuiltHtml = "";
            
            sorted.forEach(bloc => {
              if (bloc.type === 'IMAGE') {
                // IMPORTANT: On reconstruit l'image avec data-media-id pour le parsing futur
                const mediaIdAttr = bloc.mediaId ? `data-media-id="${bloc.mediaId}"` : "";
                // Utiliser bloc.url s'il existe (url absolue), sinon bloc.contenu (path relatif)
                const rawSrc = bloc.url || bloc.contenu;
                const finalSrc = getImageUrl(rawSrc);

                rebuiltHtml += `<img src="${finalSrc}" alt="${bloc.altText || ''}" title="${bloc.legende || ''}" ${mediaIdAttr} class="article-content-image" />`;
                // Ajout d'un saut de ligne après image pour éditeur plus propre
                rebuiltHtml += `<p></p>`; 
              
              } else if (bloc.type === 'CITATION') {
                rebuiltHtml += `<blockquote>${bloc.contenu}</blockquote>`;
              
              } else if (bloc.type === 'VIDEO') {
                  // Reconstruction vidéo basique pour preview
                  rebuiltHtml += `<p>[VIDEO: ${bloc.url || bloc.contenu}]</p>`;

              } else {
                // Type TEXTE (C'est du HTML brut sauvegardé)
                rebuiltHtml += bloc.contenu;
              }
            });

            console.log("📝 Contenu HTML reconstruit :", rebuiltHtml.substring(0, 50) + "...");
            setHtmlContent(rebuiltHtml);
            setContentLoaded(true);
          } else {
              setHtmlContent("");
              setContentLoaded(true);
          }
        })
        .catch((err) => {
            console.error("❌ Erreur chargement", err);
            setUiState(p => ({ ...p, error: "Impossible de charger l'article." }));
        })
        .finally(() => setUiState(p => ({ ...p, loading: false })));
    } else {
        // Mode Création : on dit que le contenu est chargé (vide)
        setContentLoaded(true);
    }
  }, [editArticleId]);

  // =========================================================
  // 2. SYNCHRONISATION (STATE -> EDITOR)
  // =========================================================
  // On attend que l'éditeur soit monté ET que le contenu soit fetché
  useEffect(() => {
      if (editorInstance && !editorInstance.isDestroyed && contentLoaded && editArticleId) {
          // On vérifie si l'éditeur est vide pour éviter d'écraser si l'utilisateur a commencé à taper pendant un re-render
          // (Optionnel: forcer l'overwrite pour être sûr d'avoir le brouillon exact)
          console.log("🔄 Injection du contenu dans l'éditeur Tiptap");
          editorInstance.commands.setContent(htmlContent);
      }
  }, [editorInstance, contentLoaded, editArticleId]); // Retrait de htmlContent des dépendances pour éviter boucle infinie

// ✅ FONCTION PARSE: DOM -> BLOC OBJECTS
  const parseEditorContent = (html: string): BlocContenuDto[] => {
     if (typeof window === 'undefined') return [];
     const parser = new DOMParser();
     const doc = parser.parseFromString(html, 'text/html');
     const nodes = Array.from(doc.body.children);
     const blocs: BlocContenuDto[] = [];
     let counter = 0;

     // Fonction locale de nettoyage string
     const str = (v: any) => (v ? String(v).trim() : "");

     nodes.forEach((node) => {
         // --- CAS IMAGE ---
         if (node.tagName === 'IMG' || node.querySelector('img')) {
             const img = (node.tagName === 'IMG' ? node : node.querySelector('img')) as HTMLImageElement;
             const src = img.getAttribute('src');
             // Si pas de source, on ignore
             if(!src) return;

             blocs.push({
                 type: 'IMAGE',
                 ordre: counter++,
                 url: src,
                 contenu: src,
                 altText: str(img.getAttribute('alt')),
                 legende: str(img.getAttribute('title')),
                 // Récupération sécurisée du UUID stocké
                 mediaId: str(img.getAttribute('data-media-id')) || null, 
                 articleId: 0
             });
             return;
         }

         // --- CAS CITATION ---
         if (node.tagName === 'BLOCKQUOTE') {
             blocs.push({
                 type: 'CITATION',
                 ordre: counter++,
                 contenu: node.innerHTML,
                 url: "", altText: "", legende: "", mediaId: null, articleId: 0
             });
             return;
         }

         // --- CAS TEXTE STANDARD ---
         const txt = node.textContent?.trim();
         // On sauvegarde le bloc s'il a du texte ou du contenu HTML significatif
         if (txt || node.innerHTML.includes('<')) {
            blocs.push({
                type: 'TEXTE',
                ordre: counter++,
                contenu: node.outerHTML,
                url: "", altText: "", legende: "", mediaId: null, articleId: 0
            });
         }
     });
     return blocs;
  };

  // ✅ FONCTION IA AUTO-TAGGING
  const handleAutoTag = async () => {
      // Pour auto-tagger, l'article doit être sauvegardé ou on envoie le contenu texte ?
      // L'endpoint est POST /articles/{id}/auto-tag. Il faut donc un ID.
      // Si pas d'ID (nouvel article), on doit d'abord faire un "brouillon auto".
      
      if (!articleId && !confirm("L'article doit être sauvegardé en brouillon pour l'analyse IA. Sauvegarder maintenant ?")) {
          return;
      }
      
      try {
          setIsAutoTagging(true);
          
          // 1. Si pas d'ID, on sauvegarde
          let currentId = articleId;
          if (!currentId) {
             await handleSave(false); // Cela va setArticleId
             // Attention: setState est asynchrone, dans ce scope articleId peut être null
             // Hack: handleSave met à jour l'UI, on force l'utilisateur à re-cliquer ou on attend le re-render.
             // Mieux: retourner l'ID dans handleSave. Pour ce correctif, supposons qu'il est sauvegardé.
             alert("Brouillon créé. Cliquez à nouveau sur 'Générer' pour lancer l'IA.");
             return;
          }

          // 2. Appel Service
          const generatedTags = await ArticleService.generateAutoTags(currentId!);
          
          // 3. Merge avec existants
          setTags(prev => [...new Set([...prev, ...generatedTags])]);

      } catch (e) {
          alert("Erreur génération tags");
      } finally {
          setIsAutoTagging(false);
      }
  };


 // === SAUVEGARDE ===
  const handleSave = async (isSubmission: boolean) => {
    // Validations (inchangées)
    if (!titre.trim()) return setUiState(p => ({ ...p, error: "Titre requis" }));
    if (!description.trim()) return setUiState(p => ({ ...p, error: "Description requise" }));
    if (!rubriqueId) return setUiState(p => ({ ...p, error: "Rubrique requise" }));
    if (!user?.id) return setUiState(p => ({ ...p, error: "Session expirée" }));

    setUiState(p => ({ ...p, saving: true, error: null }));

    try {
            // 1. Récupération HTML Editor actuel
      // Si l'éditeur n'est pas chargé, on prend le htmlContent initial (cas modification métadonnées seule)
      const currentHtml = editorInstance ? editorInstance.getHTML() : htmlContent;

      const blocksPayload = parseEditorContent(htmlContent);
            // Sécurité pour ne pas effacer un article par erreur
      if (blocksPayload.length === 0 && !confirm("L'article semble vide. Continuer la sauvegarde ?")) {
          setUiState(p => ({ ...p, saving: false }));
          return;
      }

      // ID Cover Image (Int32 pour article, attention)
      // Si l'article prend un Int pour cover, on garde parseInt. Si c'est UUID, on change.
      // D'après swagger "ArticleCreateDto", imageCouvertureId est Int32. On garde ça comme avant.
      let finalCoverId: number | null = null;
      if (coverImageId) {
         if (typeof coverImageId === 'string') finalCoverId = parseInt(coverImageId);
         else finalCoverId = coverImageId;
      }

      const payload: ArticlePayloadDto = {
        titre: titre.trim(),
        description: description.trim(),
        rubriqueId: rubriqueId,
        auteurId: user.id,
        imageCouvertureId: finalCoverId, 
        region: region,
        visible: false,
        statut: isSubmission ? 'PENDING_REVIEW' : (articleId ? 'DRAFT' : 'DRAFT'), // Si modification on garde le statut ou force Draft
        tagIds: [],
        blocsContenu: blocksPayload // Contient des UUID strings dans mediaId
      };

      let targetId = articleId;

        if (articleId) {
             await ArticleService.update(articleId, payload);
        } else {
             const created = await ArticleService.create(payload);
             targetId = created.id;
             setArticleId(created.id);
        }

        // ✅ SAUVEGARDE DES TAGS (Appel séparé)
        // On ne le fait que si l'article est créé avec succès
        if (targetId && tags.length > 0) {
             await ArticleService.assignTags(targetId, tags);
        }

      if (articleId) {
        await ArticleService.update(articleId, payload);
        if(isSubmission) await ArticleService.submit(articleId, user.id);
      } else {
        const created = await ArticleService.create(payload);
        setArticleId(created.id);
        if(isSubmission) await ArticleService.submit(created.id, user.id);
      }
      
      alert(isSubmission ? "Envoyé pour validation !" : "Brouillon sauvegardé !");
      if (onSuccess) onSuccess();

    } catch (e: any) {
      setUiState(p => ({ ...p, error: e.message }));
    } finally {
      setUiState(p => ({ ...p, saving: false }));
    }
  };



  if (uiState.loading) {
      return <ArticleEditorSkeleton />;
  }

  return (
    <div className="max-w-6xl mx-auto pb-32 animate-in fade-in">
      
      {/* BARRE DU HAUT */}
      <div className="sticky top-0 z-40 bg-[#FBFBFB] dark:bg-black py-4 border-b border-gray-100 dark:border-zinc-800 flex justify-between items-center mb-6">
        <div className="flex items-center gap-3">
          <button 
            onClick={onCancel} 
            className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-800"
          >
            <ArrowLeft size={20} />
          </button>
          <div>
            <h2 className="text-xl font-bold dark:text-white">
              {articleId ? `Édition: ${titre.substring(0, 20)}...` : "Nouvel Article"}
            </h2>
            {uiState.error && (
              <p className="text-xs text-red-500 font-bold flex items-center gap-1 mt-1">
                <AlertTriangle size={12} /> {uiState.error}
              </p>
            )}
          </div>
        </div>
        
        <div className="flex gap-3">
          <Button 
            variant="outline"
            disabled={uiState.saving}
            onClick={() => handleSave(false)}
            className="h-10 bg-white dark:bg-zinc-900 p-3 border-gray-300"
          >
            {uiState.saving ? (
              <Loader2 className="animate-spin" size={16} />
            ) : (
              <Save size={16} className="mr-2" />
            )}
            Brouillon
          </Button>
          <Button 
            disabled={uiState.saving}
            onClick={() => {
              if (confirm("Confirmer la soumission pour validation ?")) {
                handleSave(true);
              }
            }}
            className="h-10 bg-[#3E7B52] p-3 text-white hover:bg-[#2d5a3c]"
          >
            <Send size={16} className="mr-2" /> Soumettre
          </Button>
        </div>
      </div>

      {/* CHARGEMENT */}
      {uiState.loading ? (
        <div className="h-96 flex items-center justify-center">
          <Loader2 className="animate-spin text-[#3E7B52]" size={40} />
        </div>
      ) : (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          
          {/* ÉDITEUR CENTRAL */}
          <div className="lg:col-span-2 space-y-4">
            <div className="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-800 rounded-xl overflow-hidden shadow-sm flex flex-col min-h-[80vh]">
              <Toolbar editor={editorInstance} />
              <EditorContentComp 
                setEditorRef={setEditorInstance} 
                onChange={setHtmlContent} 
                initialContent={htmlContent}
              />
            </div>
          </div>

          {/* SIDEBAR RÉGLAGES */}
          <div className="lg:col-span-1">
            <ArticleSettings 
              titre={titre} 
              setTitre={setTitre}
              description={description} 
              setDescription={setDescription}
              rubriqueId={rubriqueId} 
              setRubriqueId={setRubriqueId}
              coverImageId={coverImageId} 
              setCoverImageId={setCoverImageId}
              coverImageUrl={coverImageUrl} 
              setCoverImageUrl={setCoverImageUrl}
              region={region} 
              setRegion={setRegion}
              tags={tags}           // 👈 PASS
              setTags={setTags}     // 👈 PASS
              onAutoTag={handleAutoTag}  // 👈 PASS
              isAutoTagging={isAutoTagging} // 👈 PASS
            />
            
            {/* Bloc info */}
            <div className="mt-4 p-4 bg-blue-50 dark:bg-blue-900/10 rounded-xl border border-blue-100 dark:border-blue-800 text-xs text-blue-800 dark:text-blue-300">
              <p className="flex items-center gap-2 font-bold mb-1">
                <AlertTriangle size={12} /> Note Importante
              </p>
              L'IA générera automatiquement des mots-clés lors de la soumission basés sur votre contenu riche.
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\dashboard\AdvancedPublishModal.tsx
================================================================================

"use client";

import React, { useState } from 'react';
import { X, Calendar, Globe, Bell, Share2, Rocket, Lock } from 'lucide-react';
import { Button } from '@/components/ui/Button';
import { ArticleService } from '@/services/article';
import { ArticlePublicationDto } from '@/types/article';

interface AdvancedPublishModalProps {
    isOpen: boolean;
    onClose: () => void;
    articleId: number;
    onSuccess: () => void;
}

export default function AdvancedPublishModal({ isOpen, onClose, articleId, onSuccess }: AdvancedPublishModalProps) {
    const [isLoading, setIsLoading] = useState(false);
    
    // Form States
    const [scheduleDate, setScheduleDate] = useState("");
    const [isPremium, setIsPremium] = useState(false); // Avant-première
    const [previewEndDate, setPreviewEndDate] = useState("");
    const [regions, setRegions] = useState<string[]>([]);
    const [notify, setNotify] = useState(true);
    const [socials, setSocials] = useState(false);

    if (!isOpen) return null;

    const handleSubmit = async () => {
        setIsLoading(true);
        try {
            const payload: ArticlePublicationDto = {
                datePublication: scheduleDate ? new Date(scheduleDate).toISOString() : null,
                enAvantPremiere: isPremium,
                dateFinAvantPremiere: previewEndDate ? new Date(previewEndDate).toISOString() : null,
                regionsTargetees: regions.length > 0 ? regions : undefined,
                notifierAbonnes: notify,
                publierReseauxSociaux: socials,
                plateformesSociales: socials ? ["FACEBOOK", "TWITTER"] : [], // Par défaut si coché
                forcerVisibilite: true // On veut que ça soit visible
            };

            await ArticleService.publishAdvanced(articleId, payload);
            onSuccess();
            onClose();
        } catch (error: any) {
            alert(error.message || "Erreur de publication");
        } finally {
            setIsLoading(false);
        }
    };

    const toggleRegion = (reg: string) => {
        setRegions(prev => prev.includes(reg) ? prev.filter(r => r !== reg) : [...prev, reg]);
    };

    return (
        <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in">
            <div className="bg-white dark:bg-zinc-900 w-full max-w-lg rounded-2xl shadow-2xl border dark:border-zinc-800 overflow-hidden flex flex-col max-h-[90vh]">
                
                {/* Header */}
                <div className="px-6 py-4 border-b border-gray-100 dark:border-zinc-800 flex justify-between items-center bg-gray-50 dark:bg-zinc-950">
                    <h3 className="font-bold text-gray-900 dark:text-white flex items-center gap-2">
                        <Rocket className="text-[#3E7B52]" size={20}/>
                        Publication Avancée
                    </h3>
                    <button onClick={onClose} className="text-gray-400 hover:text-red-500 transition"><X size={20}/></button>
                </div>

                {/* Body Scrollable */}
                <div className="p-6 overflow-y-auto space-y-6 custom-scrollbar">
                    
                    {/* 1. Programmation */}
                    <div className="space-y-3">
                        <label className="text-xs font-bold uppercase text-gray-500 tracking-wider flex items-center gap-2">
                            <Calendar size={14}/> Date de publication
                        </label>
                        <div className="grid grid-cols-2 gap-4">
                             <div 
                                className={`p-3 border rounded-xl text-center cursor-pointer transition-all ${!scheduleDate ? 'border-[#3E7B52] bg-green-50 text-[#3E7B52] font-bold' : 'border-gray-200 dark:border-zinc-700'}`}
                                onClick={() => setScheduleDate("")}
                             >
                                Immédiate
                             </div>
                             <input 
                                type="datetime-local" 
                                className="p-2 border border-gray-200 dark:border-zinc-700 rounded-xl text-xs dark:bg-black dark:text-white outline-none focus:border-[#3E7B52]"
                                onChange={(e) => setScheduleDate(e.target.value)}
                             />
                        </div>
                    </div>

                    {/* 2. Avant-Première */}
                    <div className="space-y-3 pt-4 border-t border-dashed dark:border-zinc-800">
                        <div className="flex items-center justify-between">
                             <label className="text-xs font-bold uppercase text-gray-500 tracking-wider flex items-center gap-2">
                                <Lock size={14}/> Mode Avant-Première
                             </label>
                             <input type="checkbox" className="toggle-checkbox" checked={isPremium} onChange={e => setIsPremium(e.target.checked)} />
                        </div>
                        {isPremium && (
                            <div className="p-3 bg-amber-50 dark:bg-amber-900/20 rounded-xl border border-amber-100 dark:border-amber-800 text-xs">
                                <p className="text-amber-800 dark:text-amber-200 mb-2">Accessible uniquement aux abonnés jusqu'au :</p>
                                <input 
                                    type="datetime-local" 
                                    className="w-full p-2 bg-white dark:bg-black border rounded-lg"
                                    onChange={(e) => setPreviewEndDate(e.target.value)}
                                />
                            </div>
                        )}
                    </div>

                    {/* 3. Ciblage Régional */}
                    <div className="space-y-3 pt-4 border-t border-dashed dark:border-zinc-800">
                         <label className="text-xs font-bold uppercase text-gray-500 tracking-wider flex items-center gap-2">
                            <Globe size={14}/> Ciblage Régional
                         </label>
                         <div className="flex flex-wrap gap-2">
                             {['FR', 'UK', 'US', 'CM', 'NG', 'ZA'].map(geo => (
                                 <button
                                    key={geo}
                                    onClick={() => toggleRegion(geo)}
                                    className={`px-3 py-1 rounded-full text-xs font-bold border transition-all ${regions.includes(geo) ? 'bg-[#3E7B52] text-white border-[#3E7B52]' : 'bg-gray-50 text-gray-500 border-gray-200'}`}
                                 >
                                     {geo}
                                 </button>
                             ))}
                         </div>
                    </div>

                    {/* 4. Diffusion */}
                    <div className="space-y-3 pt-4 border-t border-dashed dark:border-zinc-800">
                         <label className="flex items-center gap-3 p-3 border rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-zinc-800 transition">
                            <input type="checkbox" checked={notify} onChange={e => setNotify(e.target.checked)} className="accent-[#3E7B52]"/>
                            <div className="flex-1">
                                <p className="font-bold text-sm dark:text-white flex items-center gap-2"><Bell size={14}/> Notifier les abonnés</p>
                            </div>
                         </label>

                         <label className="flex items-center gap-3 p-3 border rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-zinc-800 transition">
                            <input type="checkbox" checked={socials} onChange={e => setSocials(e.target.checked)} className="accent-[#3E7B52]"/>
                            <div className="flex-1">
                                <p className="font-bold text-sm dark:text-white flex items-center gap-2"><Share2 size={14}/> Partager sur Réseaux Sociaux</p>
                                <p className="text-[10px] text-gray-400">Facebook, Twitter (X)</p>
                            </div>
                         </label>
                    </div>

                </div>

                {/* Footer Actions */}
                <div className="p-6 border-t border-gray-100 dark:border-zinc-800 bg-gray-50/50 dark:bg-zinc-900/50">
                    <Button 
                        onClick={handleSubmit} 
                        disabled={isLoading}
                        className="w-full bg-[#3E7B52] hover:bg-[#326342] text-white font-bold h-12 shadow-lg shadow-[#3E7B52]/20"
                    >
                        {isLoading ? "Configuration..." : (scheduleDate ? "Programmer la publication" : "Publier Maintenant")}
                    </Button>
                </div>
            </div>
        </div>
    );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\article\CommentSystem.tsx
================================================================================

"use client";

import React, { useEffect, useState, useRef } from "react";
import Link from "next/link";
import { formatDistanceToNow } from "date-fns";
import { fr } from "date-fns/locale";
import { 
  MessageSquare, Send, Lock, User, ThumbsUp, 
  MessageCircle, CornerDownRight, Loader2 
} from "lucide-react";
import { PublicService } from "@/services/public";
import { useAuth } from "@/context/AuthContext";
import { CommentaireDto } from "@/types/article";
import { Button } from "@/components/ui/Button";
import { cn } from "@/lib/utils";

interface CommentSystemProps {
  articleId: number;
}

// Fonction pour générer une couleur d'avatar basée sur le nom
const getAvatarColor = (name: string = "") => {
  const colors = [
    "from-blue-400 to-indigo-500",
    "from-emerald-400 to-green-500",
    "from-orange-400 to-red-500",
    "from-purple-400 to-pink-500",
    "from-cyan-400 to-blue-500",
  ];
  const index = name.length % colors.length;
  return colors[index];
};

export default function CommentSystem({ articleId }: CommentSystemProps) {
  const { user } = useAuth();
  
  const [comments, setComments] = useState<CommentaireDto[]>([]);
  const [loading, setLoading] = useState(true);
  const [inputContent, setInputContent] = useState("");
  const [isSubmitting, setIsSubmitting] = useState(false);
  const listRef = useRef<HTMLDivElement>(null);

  // Charger les commentaires au montage
  useEffect(() => {
    loadComments();
  }, [articleId]);

  const loadComments = async () => {
    try {
      setLoading(true);
      // On récupère "Tous" les commentaires (ou approved selon config API)
      // Note: Si l'API filtre encore les PENDING, assurez-vous que le backend renvoie tout pour ce contexte
      const data = await PublicService.getCommentsByArticle(articleId);
      
      // Tri : Les plus récents en premier
      const sorted = (data || []).sort((a, b) => 
        new Date(b.dateCreation).getTime() - new Date(a.dateCreation).getTime()
      );
      setComments(sorted);
    } catch (e) {
      console.error("Erreur chargement commentaires", e);
    } finally {
      setLoading(false);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!user || !inputContent.trim()) return;

    setIsSubmitting(true);
    
    // 1. Optimistic Update (On crée un faux commentaire temporaire pour l'UI instantanée)
    const tempId = Date.now();
    const optimisticComment: CommentaireDto = {
        id: tempId,
        contenu: inputContent,
        articleId: articleId,
        auteurId: user.id,
        auteurNom: user.fullName || `${user.prenom} ${user.nom}`,
        dateCreation: new Date().toISOString(),
        status: 'APPROVED', // On considère que c'est direct visible
        likes: 0
    };

    // On l'ajoute tout de suite en haut de la liste
    setComments((prev) => [optimisticComment, ...prev]);
    const prevInput = inputContent;
    setInputContent(""); // Reset input

    try {
      // 2. Appel Réseau réel
      await PublicService.postComment({
        articleId,
        auteurId: user.id,
        contenu: prevInput,
        parentId: null 
      });

      // Optionnel : Recharger proprement pour avoir le vrai ID et date serveur
      // Ou garder l'optimistic si on veut économiser un call. 
      // Ici on reload silencieusement pour synchroniser les IDs pour la suppression/édition future
      const refreshedList = await PublicService.getCommentsByArticle(articleId);
      setComments(refreshedList.sort((a, b) => 
        new Date(b.dateCreation).getTime() - new Date(a.dateCreation).getTime()
      ));

    } catch (error) {
      console.error(error);
      alert("Erreur lors de l'envoi.");
      // Rollback en cas d'erreur
      setComments((prev) => prev.filter(c => c.id !== tempId));
      setInputContent(prevInput);
    } finally {
      setIsSubmitting(false);
    }
  };

  if (loading) {
      return (
        <div className="flex flex-col gap-4 p-6 bg-gray-50/50 dark:bg-zinc-900/20 rounded-2xl animate-pulse h-full border border-gray-100 dark:border-zinc-800">
            <div className="h-6 w-1/3 bg-gray-200 dark:bg-zinc-800 rounded"></div>
            <div className="space-y-4 mt-4">
               {[1,2,3].map(i => (
                 <div key={i} className="flex gap-3">
                    <div className="w-8 h-8 rounded-full bg-gray-200 dark:bg-zinc-800"></div>
                    <div className="flex-1 space-y-2">
                        <div className="h-3 w-1/4 bg-gray-200 dark:bg-zinc-800 rounded"></div>
                        <div className="h-10 w-full bg-gray-200 dark:bg-zinc-800 rounded-xl"></div>
                    </div>
                 </div>
               ))}
            </div>
        </div>
      );
  }

  return (
    <div className="bg-white/80 dark:bg-zinc-900/50 backdrop-blur-xl rounded-3xl p-0 border border-gray-200 dark:border-zinc-800 shadow-sm flex flex-col h-full overflow-hidden">
      
      {/* --- HEADER --- */}
      <div className="px-6 py-4 border-b border-gray-100 dark:border-zinc-800/50 flex justify-between items-center bg-gray-50/50 dark:bg-zinc-950/30">
        <div className="flex items-center gap-2">
            <div className="bg-[#3E7B52]/10 dark:bg-[#13EC13]/10 p-1.5 rounded-lg text-[#3E7B52] dark:text-[#13EC13]">
                <MessageSquare size={16} strokeWidth={2.5}/>
            </div>
            <h3 className="font-bold text-gray-900 dark:text-white text-sm uppercase tracking-wide">
                Discussions
            </h3>
        </div>
        <span className="text-[10px] font-bold text-gray-400 dark:text-zinc-500 bg-white dark:bg-zinc-800 px-2 py-0.5 rounded-full border border-gray-100 dark:border-zinc-700 shadow-sm">
            {comments.length} Réactions
        </span>
      </div>

      {/* --- LISTE DES COMMENTAIRES --- */}
      <div 
        ref={listRef} 
        className="flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6"
      >
        {comments.length === 0 ? (
          <div className="h-full flex flex-col items-center justify-center text-center py-10 opacity-70">
            <div className="w-16 h-16 bg-gray-50 dark:bg-zinc-800/50 rounded-full flex items-center justify-center mb-4 shadow-inner">
                <MessageCircle size={28} className="text-gray-300 dark:text-zinc-600" />
            </div>
            <p className="text-sm font-semibold text-gray-600 dark:text-zinc-300">Aucun commentaire</p>
            <p className="text-[11px] text-gray-400 dark:text-zinc-500 max-w-[180px] leading-snug mt-1">
                Soyez le premier à partager votre avis sur cet article.
            </p>
          </div>
        ) : (
          comments.map((comment, index) => {
            const isMe = user?.id === comment.auteurId;
            return (
                <div key={comment.id} className="group animate-in fade-in slide-in-from-bottom-2 flex gap-4 items-start" style={{ animationDelay: `${index * 50}ms` }}>
                  
                  {/* AVATAR */}
                  <div className={cn(
                      "w-9 h-9 rounded-2xl flex items-center justify-center text-white text-[10px] font-black shadow-md bg-gradient-to-br shrink-0 select-none",
                      getAvatarColor(comment.auteurNom)
                  )}>
                      {comment.auteurNom?.charAt(0).toUpperCase() || <User size={12}/>}
                  </div>
                  
                  {/* CONTENU */}
                  <div className="flex-1 min-w-0">
                      <div className="flex justify-between items-baseline mb-1">
                          <span className="text-[12px] font-bold text-gray-900 dark:text-gray-200">
                              {comment.auteurNom || "Utilisateur Inconnu"}
                          </span>
                          <span className="text-[10px] font-medium text-gray-400">
                              {formatDistanceToNow(new Date(comment.dateCreation), { addSuffix: true, locale: fr })}
                          </span>
                      </div>
                      
                      <div className={cn(
                          "text-sm text-gray-600 dark:text-zinc-300 leading-relaxed bg-gray-50 dark:bg-zinc-800/50 p-3 rounded-2xl rounded-tl-none whitespace-pre-wrap",
                          isMe ? "border border-[#3E7B52]/20 dark:border-[#13EC13]/20 bg-[#3E7B52]/5 dark:bg-[#13EC13]/5" : ""
                      )}>
                          {comment.contenu}
                      </div>

                      {/* INTERACTIONS LÉGÈRES */}
                      <div className="flex gap-4 mt-1.5 ml-2">
                          <button className="flex items-center gap-1 text-[10px] font-bold text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                              <ThumbsUp size={10} strokeWidth={2.5} /> {comment.likes || 0}
                          </button>
                          <button className="flex items-center gap-1 text-[10px] font-bold text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                              <CornerDownRight size={10} strokeWidth={2.5} /> Répondre
                          </button>
                      </div>
                  </div>
                </div>
            );
          })
        )}
      </div>

      {/* --- ZONE DE SAISIE --- */}
      <div className="p-4 border-t border-gray-100 dark:border-zinc-800 bg-white dark:bg-[#0a0a0a] z-10 relative">
        {user ? (
            <form 
                onSubmit={handleSubmit} 
                className={cn(
                    "relative group transition-all duration-300 rounded-2xl border bg-gray-50 dark:bg-zinc-900",
                    inputContent.length > 0 
                        ? "border-[#3E7B52] shadow-sm ring-1 ring-[#3E7B52]/20 dark:border-[#3E7B52]/50" 
                        : "border-gray-200 dark:border-zinc-800"
                )}
            >
                <textarea
                    value={inputContent}
                    onChange={(e) => setInputContent(e.target.value)}
                    placeholder="Écrivez votre commentaire..."
                    className="w-full h-12 py-3 px-4 text-sm bg-transparent resize-none outline-none text-gray-800 dark:text-white placeholder:text-gray-400 focus:h-24 transition-[height] ease-in-out duration-200 rounded-2xl"
                    style={{ minHeight: "3rem" }}
                    maxLength={2000}
                />
                
                {/* Footer Input */}
                <div className="flex justify-between items-center px-2 pb-2">
                    <span className={cn("text-[9px] font-medium transition-opacity px-2", inputContent.length > 1800 ? "text-red-500" : "text-gray-400 opacity-50 group-focus-within:opacity-100")}>
                        {inputContent.length > 0 && `${inputContent.length}/2000`}
                    </span>
                    
                    <button 
                        type="submit" 
                        disabled={isSubmitting || inputContent.trim().length === 0}
                        className={cn(
                            "p-2 rounded-xl transition-all shadow-sm flex items-center justify-center",
                            inputContent.trim().length > 0 
                                ? "bg-[#3E7B52] hover:bg-[#2d5f3e] text-white scale-100 opacity-100 cursor-pointer" 
                                : "bg-gray-200 dark:bg-zinc-800 text-gray-400 cursor-not-allowed"
                        )}
                        title="Envoyer"
                    >
                        {isSubmitting ? <Loader2 className="animate-spin" size={16} /> : <Send size={16} strokeWidth={2.5} className={inputContent.length > 0 ? "ml-0.5" : ""} />}
                    </button>
                </div>
            </form>
        ) : (
            <div className="bg-gradient-to-r from-gray-50 to-white dark:from-zinc-900 dark:to-zinc-950 p-4 rounded-xl border border-dashed border-gray-300 dark:border-zinc-700 flex flex-col items-center justify-center gap-3">
                 <p className="text-xs font-medium text-gray-500 dark:text-gray-400 flex items-center gap-2">
                     <Lock size={12} /> Connectez-vous pour rejoindre la discussion
                 </p>
                 <Link href="/login">
                    <Button size="sm" variant="outline" className="h-8 text-[10px] font-bold border-gray-300 dark:border-zinc-700 text-gray-700 dark:text-white hover:bg-gray-100 dark:hover:bg-zinc-800 uppercase tracking-wide px-6">
                        Se connecter
                    </Button>
                 </Link>
            </div>
        )}
      </div>

    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\components\article\SimilarArticles.tsx
================================================================================

"use client";

import React, { useEffect, useState } from 'react';
import Link from "next/link";
import Image from "next/image";
import { Sparkles } from "lucide-react";
import { PublicService } from '@/services/public';
import { ArticleReadDto } from '@/types/article';
import { getImageUrl, cn } from '@/lib/utils';

interface SimilarArticlesProps {
  currentArticleId: number;
}

// ✨ SQUELETTE DE CHARGEMENT POUR SIMULER LES MINI-CARDS
const SimilarSkeleton = () => (
    <div className="space-y-4 animate-pulse">
        {[1, 2, 3, 4].map(i => (
            <div key={i} className="flex gap-3">
                <div className="w-20 h-14 bg-gray-200 dark:bg-zinc-800 rounded-lg shrink-0"></div>
                <div className="flex-1 space-y-2 py-1">
                    <div className="h-3 bg-gray-200 dark:bg-zinc-800 rounded w-full"></div>
                    <div className="h-3 bg-gray-200 dark:bg-zinc-800 rounded w-2/3"></div>
                </div>
            </div>
        ))}
    </div>
);

export default function SimilarArticles({ currentArticleId }: SimilarArticlesProps) {
  const [articles, setArticles] = useState<ArticleReadDto[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchSimilaires = async () => {
        setLoading(true);
        try {
            // Utilise l'endpoint /articles/{id}/similar?limit=5
            const data = await PublicService.getSimilarArticles(currentArticleId, 5);
            // Filtrer l'article courant si l'API ne le fait pas (sécurité)
            setArticles(data.filter(a => a.id !== currentArticleId));
        } catch (e) {
            console.error(e);
        } finally {
            setLoading(false);
        }
    };
    if (currentArticleId) fetchSimilaires();
  }, [currentArticleId]);

  // Ne rien afficher si vide et chargé
  if (!loading && articles.length === 0) return null;

  return (
    <div className="bg-white dark:bg-zinc-900 border border-gray-100 dark:border-zinc-800 rounded-2xl p-6 shadow-sm sticky top-24">
        
        {/* Titre Stylé */}
        <div className="flex items-center gap-2 mb-6 pb-2 border-b border-gray-50 dark:border-zinc-800/50">
            <Sparkles className="text-[#3E7B52]" size={16}/>
            <h4 className="font-extrabold text-sm uppercase tracking-wider text-gray-900 dark:text-white">
                Dans la même thématique
            </h4>
        </div>

        {/* Liste */}
        {loading ? (
            <SimilarSkeleton />
        ) : (
            <div className="flex flex-col gap-5">
                {articles.map((art) => (
                    <Link href={`/article/${art.id}`} key={art.id} className="group flex gap-3 items-start">
                        {/* Image miniature */}
                        <div className="relative w-20 h-16 shrink-0 rounded-lg overflow-hidden bg-gray-100 border border-gray-100 dark:border-zinc-800">
                             <Image 
                                src={getImageUrl(art.imageCouvertureUrl)} 
                                alt={art.titre}
                                fill
                                className="object-cover group-hover:scale-110 transition-transform duration-500"
                                unoptimized
                             />
                        </div>
                        
                        {/* Contenu */}
                        <div className="flex-1 min-w-0 flex flex-col justify-center gap-1">
                             <span className="text-[9px] font-bold text-[#3E7B52] dark:text-[#13EC13] uppercase tracking-wide">
                                 {art.rubriqueNom || "Actualité"}
                             </span>
                             <h5 className="text-xs font-bold text-gray-800 dark:text-zinc-200 leading-snug line-clamp-2 group-hover:text-[#3E7B52] transition-colors">
                                 {art.titre}
                             </h5>
                        </div>
                    </Link>
                ))}
            </div>
        )}
        
        {/* Petit label algo */}
        <div className="mt-6 pt-4 border-t border-dashed border-gray-200 dark:border-zinc-800 text-center">
            <span className="text-[9px] text-gray-400 bg-gray-50 dark:bg-zinc-800 px-2 py-1 rounded">
                Recommandé par notre algorithme et conçu pour vous plaire
            </span>
        </div>
    </div>
  );
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\lib\constant.ts
================================================================================

import { 
  Globe, 
  TrendingUp, 
  Landmark, 
  Scale, 
  Sprout, 
  GraduationCap, 
  ShieldPlus, 
  Cpu 
} from "lucide-react";



export const APP_CONFIG = {
  name: "TODAY'S AFRICA",
  year: 2025,
  // ✅ CORRECTION : Utilisation du proxy local Next.js
  apiUrl: "/api/proxy",
  backendUrl: "http://194.163.175.53:8080", 
  mediaBaseUrl: "http://194.163.175.53:8080/api/v1/media/", 
};


export const COLORS = {
  primaryLight: "#13EC13",
  primaryDK: "#3E7B52",
  backgroundBeige: "#F9F9F7",
  textDark: "#111111",
  textGray: "#666666",
};

export const LOGIN_TEXT = {
  header: {
    logoAlt: "Logo Today's Africa",
    leftTitle: "Bienvenue sur l'espace contributeur",
    leftSubtitle: "Votre voix est essentielle pour éclairer, informer et façonner l'avenir de l'Afrique.",
    footer: `© ${APP_CONFIG.year} ${APP_CONFIG.name}. Tous droits réservés.`,
  },
  form: {
    title: "Accès Rédacteurs & Admin",
    subtitle: "Connectez-vous ou créez votre compte",
    tabLogin: "Connexion",
    tabRegister: "Inscription",
    emailLabel: "Adresse e-mail",
    emailPlaceholder: "exemple@todaysafrica.com",
    passwordLabel: "Mot de passe",
    passwordPlaceholder: "Entrez votre mot de passe",
    forgotPassword: "Mot de passe oublié ?",
    submitButton: "Se connecter",
    separator: "OU",
    googleButton: "S'inscrire avec Google",
  },
};

export const HOME_DATA = {
   // Correction ici : Tableau d'objets pour les liens, et non de strings simples
  navLinks: [
    { label: "Gouvernance", slug: "gouvernance" },
    { label: "Économie", slug: "economie" },
    { label: "Politique", slug: "politique" },
    { label: "Développement", slug: "developpement" },
    { label: "Technologie", slug: "technologie" }
  ],
  hero: {
    titlePrefix: "Les Histoires les Plus Importantes qui Façonnent l'Afrique en",
    year: "2025",
    description: "Informations vérifiées et analyses approfondies sur l'économie, la politique et le développement à travers le continent.",
    cta: "Lire l'Article Principal",
  },
  latestNews: [
    {
      id: 1,
      category: "ÉCONOMIE",
      title: "Le Forum Économique Fixe de Nouveaux Objectifs pour le Commerce Ouest-Africain",
      date: "10 juin 2025",
      color: "text-green-600",
      image: "https://images.unsplash.com/photo-1526304640152-d46196bfc4c8?q=80&w=2070&auto=format&fit=crop", // Placeholder image chart
    },
    {
      id: 2,
      category: "POLITIQUE NATIONALE",
      title: "Les Élections Nationales se Concluent avec un Taux de Participation Record",
      date: "10 juin 2025",
      color: "text-green-700",
      image: "https://images.unsplash.com/photo-1541888946425-d81bb19240f5?q=80&w=2070&auto=format&fit=crop", // Placeholder election
    },
    {
      id: 3,
      category: "DÉVELOPPEMENT",
      title: "Les Innovations en Agriculture Durable Stimulent les Communautés Locales",
      date: "9 juin 2025",
      color: "text-emerald-600",
      image: "https://images.unsplash.com/photo-1595813430058-20d089c7081c?q=80&w=1955&auto=format&fit=crop", // Placeholder agri
    },
  ],
  categories: [
    { id: 1, label: "Gouvernance", icon: Landmark },
    { id: 2, label: "Économie", icon: TrendingUp },
    { id: 3, label: "Politique Nationale", icon: Scale }, // Icone proche
    { id: 4, label: "Politique Internationale", icon: Globe },
    { id: 5, label: "Développement", icon: Sprout },
    { id: 6, label: "Éducation", icon: GraduationCap },
    { id: 7, label: "Santé", icon: ShieldPlus },
    { id: 8, label: "Technologie", icon: Cpu },
  ],
  footer: {
    description: "Informations vérifiées pour le continent.",
    sections: ["Économie", "Politique", "Gouvernance", "Développement"],
    about: ["Notre Mission", "Contact", "Conditions d'utilisation"],
  }
};

// Types pour TypeScript
export type ArticleCategory = "economie" | "politique" | "gouvernance" | "developpement" | "technologie" | "sante" | "education";

export interface Article {
  id: string;
  title: string;
  category: string;
  categorySlug: ArticleCategory;
  author: string;
  date: string;
  image: string;
  summary: string;
  content: string[]; // Paragraphes simulés
}

// === BASE DE DONNÉES SIMULÉE ===
export const ARTICLES_DATA: Article[] = [
  // --- ÉCONOMIE ---
  {
    id: "eco-1",
    title: "Le Cameroun signe un nouvel accord commercial historique avec l'UE",
    category: "Économie",
    categorySlug: "economie",
    author: "Jean Dupont",
    date: "15 Oct 2025",
    image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=2070&auto=format&fit=crop",
    summary: "Un tournant décisif pour l'exportation des matières premières, promettant une augmentation de 15% des échanges.",
    content: [
      "La capitale camerounaise a vibré ce matin au rythme des signatures officielles. L'accord de partenariat économique, en discussion depuis trois ans, vient d'être ratifié.",
      "Cet accord prévoit la suppression progressive des barrières douanières pour 80% des exportations camerounaises vers le marché européen. Une aubaine pour les producteurs de cacao et de café.",
      "Cependant, des voix s'élèvent au sein de la société civile pour mettre en garde contre la concurrence potentielle des produits manufacturés européens."
    ]
  },
  {
    id: "eco-2",
    title: "Analyse : L'impact de l'inflation sur les marchés ouest-africains",
    category: "Économie",
    categorySlug: "economie",
    author: "Paul Martin",
    date: "14 Oct 2025",
    image: "https://images.unsplash.com/photo-1628126235206-526058b884ce?q=80&w=2070&auto=format&fit=crop",
    summary: "Alors que le Franc CFA subit des fluctuations, le panier de la ménagère à Dakar et Abidjan en ressent les effets.",
    content: ["Le coût de la vie a augmenté de 4% en moyenne...", "Les solutions proposées par la BCEAO..."]
  },
  {
    id: "eco-3",
    title: "Investissements étrangers : tendances et prévisions 2026",
    category: "Économie",
    categorySlug: "economie",
    author: "Fatou N'diaye",
    date: "13 Oct 2025",
    image: "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1932&auto=format&fit=crop",
    summary: "Les IDE en Afrique subsaharienne devraient croître, portés par le secteur des énergies renouvelables.",
    content: ["Les analystes de la Banque Mondiale sont optimistes...", "La Chine reste le premier partenaire..."]
  },
  {
    id: "eco-4",
    title: "Le rôle des PME dans l'économie locale du Kenya",
    category: "Économie",
    categorySlug: "economie",
    author: "Olivier Dubois",
    date: "12 Oct 2025",
    image: "https://images.unsplash.com/photo-1556740738-b6a63e27c4df?q=80&w=2070&auto=format&fit=crop",
    summary: "Comment les micro-entreprises transforment le paysage urbain de Nairobi.",
    content: ["Le secteur informel représente 80% des emplois...", "Digitalisation des paiements..."]
  },
  {
    id: "eco-5",
    title: "Perspectives agricoles pour la prochaine décennie",
    category: "Économie",
    categorySlug: "economie",
    author: "Marie Claire",
    date: "11 Oct 2025",
    image: "https://images.unsplash.com/photo-1500937386664-56d1dfef3854?q=80&w=2069&auto=format&fit=crop",
    summary: "Modernisation, mécanisation et durabilité : le tiercé gagnant.",
    content: ["L'autosuffisance alimentaire est l'objectif numéro un...", "Les drones dans les champs..."]
  },

  // --- TECHNOLOGIE ---
  {
    id: "tech-1",
    title: "La Fintech en Afrique de l'Ouest : une révolution en marche",
    category: "Technologie",
    categorySlug: "technologie",
    author: "Amina Diallo",
    date: "20 Oct 2025",
    image: "https://images.unsplash.com/photo-1563986768609-322da13575f3?q=80&w=2070&auto=format&fit=crop",
    summary: "Comment le Mobile Money a surpassé le système bancaire traditionnel en taux de pénétration.",
    content: [
      "Il y a dix ans, ouvrir un compte bancaire était un parcours du combattant. Aujourd'hui, un numéro de téléphone suffit.",
      "Le Sénégal et la Côte d'Ivoire mènent la danse avec des startups comme Wave qui bouleversent le marché.",
      "La réglementation tente de suivre cette innovation rapide pour garantir la sécurité des fonds."
    ]
  },
  {
    id: "tech-2",
    title: "Comment la technologie peut-elle améliorer la transparence ?",
    category: "Technologie",
    categorySlug: "technologie",
    author: "Dr. K. Mensah",
    date: "18 Oct 2025",
    image: "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070&auto=format&fit=crop",
    summary: "Blockchain et gouvernance : le duo gagnant pour l'administration publique ?",
    content: ["L'utilisation de la blockchain pour le cadastre...", "Lutter contre la corruption..."]
  },
  {
    id: "tech-3",
    title: "L'intelligence artificielle Made in Africa",
    category: "Technologie",
    categorySlug: "technologie",
    author: "Sarah Connor",
    date: "17 Oct 2025",
    image: "https://images.unsplash.com/photo-1531746790731-6c087fecd65a?q=80&w=2006&auto=format&fit=crop",
    summary: "Google ouvre son troisième centre de recherche IA à Accra.",
    content: ["Le focus est mis sur la résolution de problèmes locaux : santé, agriculture..."]
  },
  {
    id: "tech-4",
    title: "Startups : Lagos, la Silicon Valley africaine ?",
    category: "Technologie",
    categorySlug: "technologie",
    author: "John Doe",
    date: "15 Oct 2025",
    image: "https://images.unsplash.com/photo-1599596009890-fb64db335c02?q=80&w=2074&auto=format&fit=crop",
    summary: "Yabacon Valley continue d'attirer les investisseurs internationaux malgré la crise.",
    content: ["Les licornes nigérianes se multiplient..."]
  },
  {
    id: "tech-5",
    title: "Déploiement de la 5G : Où en sommes-nous ?",
    category: "Technologie",
    categorySlug: "technologie",
    author: "Tech Reporter",
    date: "10 Oct 2025",
    image: "https://images.unsplash.com/photo-1535303311164-664fc9ec6532?q=80&w=1974&auto=format&fit=crop",
    summary: "L'Afrique du Sud et le Nigeria en tête, le reste du continent suit le pas.",
    content: ["Les défis de l'infrastructure...", "Le coût des terminaux..."]
  },

  // --- POLITIQUE ---
  {
    id: "pol-1",
    title: "Les nouveaux enjeux de la gouvernance à l'ère du digital",
    category: "Politique",
    categorySlug: "politique",
    author: "Pierre Mvié",
    date: "22 Oct 2025",
    image: "https://images.unsplash.com/photo-1541872703-74c59636a226?q=80&w=2070&auto=format&fit=crop",
    summary: "La participation citoyenne en ligne force les gouvernements à plus de réactivité.",
    content: ["Les réseaux sociaux sont devenus le nouveau parlement...", "Le concept de e-citoyenneté..."]
  },
  {
    id: "pol-2",
    title: "Le Forum Africain pour la Paix : Bilan de la 12ème édition",
    category: "Politique",
    categorySlug: "politique",
    author: "Alice Nguéma",
    date: "21 Oct 2025",
    image: "https://images.unsplash.com/photo-1529104661330-36a8d6dc3e3e?q=80&w=2070&auto=format&fit=crop",
    summary: "Les chefs d'états s'accordent sur une force d'intervention conjointe.",
    content: ["Lutter contre le terrorisme au Sahel...", "Financement autonome de l'UA..."]
  },
  {
    id: "pol-3",
    title: "Élections en RDC : Les observateurs rendent leur rapport",
    category: "Politique",
    categorySlug: "politique",
    author: "Correspondant Kinshasa",
    date: "19 Oct 2025",
    image: "https://images.unsplash.com/photo-1575320181282-9afab399332c?q=80&w=2070&auto=format&fit=crop",
    summary: "Des progrès notés dans la transparence, mais des défis logistiques persistent.",
    content: ["Les machines à voter...", "La participation des jeunes..."]
  },
  {
    id: "pol-4",
    title: "Diplomatie : Le grand retour du Maroc dans les instances de l'UA",
    category: "Politique",
    categorySlug: "politique",
    author: "Hassan B.",
    date: "15 Oct 2025",
    image: "https://images.unsplash.com/photo-1532375810709-75b1da00537c?q=80&w=2076&auto=format&fit=crop",
    summary: "Une stratégie diplomatique payante sur le long terme.",
    content: ["Investissements économiques et soft power..."]
  },
  {
    id: "pol-5",
    title: "Réformes constitutionnelles : Vers la fin des mandats illimités ?",
    category: "Politique",
    categorySlug: "politique",
    author: "Analyse Politique",
    date: "10 Oct 2025",
    image: "https://images.unsplash.com/photo-1589829545331-cb64afb46766?q=80&w=2070&auto=format&fit=crop",
    summary: "Une tendance qui se généralise en Afrique de l'Ouest.",
    content: ["La pression de la CEDEAO...", "La société civile veille au grain..."]
  },
];

// Mapper pour lier les slugs aux titres d'affichage et icônes
export const CATEGORY_MAP = {
  economie: { label: "Économie", icon: TrendingUp },
  politique: { label: "Politique", icon: Scale },
  gouvernance: { label: "Gouvernance", icon: Landmark },
  developpement: { label: "Développement", icon: Sprout },
  technologie: { label: "Technologie", icon: Cpu },
  sante: { label: "Santé", icon: ShieldPlus },
  education: { label: "Éducation", icon: GraduationCap },
  "politique-nationale": { label: "Politique Nationale", icon: Scale },
  "politique-internationale": { label: "Politique Internationale", icon: Globe },
};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\lib\utils.ts
================================================================================

// FICHIER: lib/utils.ts
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";
import { APP_CONFIG } from "@/lib/constant";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

// AJOUT : Fonction pour décoder le JWT
export function parseJwt(token: string) {
  try {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));

    return JSON.parse(jsonPayload);
  } catch (e) {
    console.error("Erreur parsing JWT", e);
    return null;
  }
}

/**
 * Construit l'URL complète d'une image
 * @param imagePath L'URL, le chemin, ou le HASH reçu du backend
 */
export function getImageUrl(imagePath: string | null | undefined): string {
  if (!imagePath) {
    return "/images/image4.jpeg"; // Placeholder par défaut
  }
  
  // 1. URL déjà complète (ex: via Cloudinary ou externe)
  if (imagePath.startsWith('http')) {
    return imagePath;
  }
  
  // 2. URL relative classique
  if (imagePath.startsWith('/images/') || imagePath.startsWith('/icons/')) {
    return imagePath;
  }

  // 3. Gestion spécifique Backend (API Proxy)
  // Si le backend renvoie "/uploads/fichier.jpg" ou juste le hash
  const baseUrl = "http://194.163.175.53:8080/api/v1"; // Hardcodé selon vos docs pour être sûr, ou utilisez APP_CONFIG

  if (imagePath.startsWith('/uploads/')) {
     // Le serveur Java sert les uploads statiques à la racine ou via un controlleur ?
     // D'après votre swagger: GET /uploads/{filename} -> tags "static-file-controller"
     // Donc http://ip:port/uploads/filename
     return `http://194.163.175.53:8080${imagePath}`;
  }

  // 4. Cas du Hash/Filename brut renvoyé par MediaReadDto.hashSha256
  // Swagger: GET /api/v1/media/file/{filename} (Sert le fichier pour affichage direct)
  if (!imagePath.includes('/')) {
     // C'est probablement un ID ou un Hash brut
     return `${baseUrl}/media/file/${imagePath}`;
  }

  return imagePath;
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\context\AuthContext.tsx
================================================================================

// FICHIER: context/AuthContext.tsx
"use client";

import React, { createContext, useContext, useEffect, useState } from "react";
import { User, authService } from "@/services/auth";
import { useRouter } from "next/navigation";

// Définition de ce que le contexte expose aux composants
interface AuthContextType {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  login: (email: string, mdp: string) => Promise<void>;
  logout: () => void;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider = ({ children }: { children: React.ReactNode }) => {
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const router = useRouter();

  // 1. Restauration de la session au chargement de l'application
  useEffect(() => {
    const initializeAuth = () => {
      console.log("🔄 [AuthContext] Initialisation...");
      const storedUser = authService.getUserFromStorage();
      const token = authService.getToken();

      if (token && storedUser && storedUser.id) {
        console.log(`✅ [AuthContext] Utilisateur restauré: ${storedUser.fullName} (ID: ${storedUser.id})`);
        setUser(storedUser);
      } else {
        console.log("ℹ️ [AuthContext] Pas de session active");
        setUser(null);
      }
      setIsLoading(false);
    };

    initializeAuth();
  }, []);

  // 2. Fonction Login wrappée
  const login = async (email: string, mdp: string) => {
    setIsLoading(true);
    try {
      const userDatas = await authService.login(email, mdp);
      setUser(userDatas); // Met à jour l'état global React
      
      // Redirection selon rôle
      if(['SUPER_ADMIN','ADMIN','REDACTEUR'].includes(userDatas.role)) {
        router.push("/dashboard");
      } else {
        router.push("/");
      }
    } catch (error) {
      console.error("❌ [AuthContext] Login Failed", error);
      throw error;
    } finally {
      setIsLoading(false);
    }
  };

  // 3. Fonction Logout wrappée
  const logout = () => {
    authService.logout();
    setUser(null);
    router.push("/login");
  };

  return (
    <AuthContext.Provider value={{ 
      user, 
      isAuthenticated: !!user, 
      isLoading, 
      login, 
      logout 
    }}>
      {children}
    </AuthContext.Provider>
  );
};

// Hook personnalisé pour consommer le context
export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error("useAuth doit être utilisé à l'intérieur d'un <AuthProvider>");
  }
  return context;
};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\services\auth.ts
================================================================================

// FICHIER: services/auth.ts
import { APP_CONFIG } from "@/lib/constant";

// Clés de stockage
export const STORAGE_KEY_TOKEN = "tody_jwt_token";
export const STORAGE_KEY_USER = "tody_user_details";

// Structure de réponse du Backend (cf. ta spec)
interface LoginResponseBackend {
  token: string;
  userId: number; // Important: Le backend renvoie 'userId'
  email: string;
  nom: string;
  prenom: string;
  role: "SUPER_ADMIN" | "ADMIN" | "REDACTEUR" | "USER";
  actif: boolean;
  message: string;
}

// Structure Utilisateur dans notre App Frontend
export interface User {
  id: number;      // On standardise en 'id'
  email: string;
  role: "SUPER_ADMIN" | "ADMIN" | "REDACTEUR" | "USER";
  nom: string;
  prenom: string;
  fullName: string;
}

interface RegisterRequest {
  email: string;
  motDePasse: string;
  nom?: string;
  prenom?: string;
}

export const authService = {
  // === INSCRIPTION (USER) ===
  register: async (data: RegisterRequest): Promise<any> => {
    console.log("🔐 [AuthService] Inscription...");
    const response = await fetch(`${APP_CONFIG.apiUrl}/auth/register`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new Error(errorData?.message || "Échec de l'inscription");
    }
    return await response.json();
  },

  // === CONNEXION CORRIGÉE ET FIABILISÉE ===
  login: async (email: string, motDePasse: string): Promise<User> => {
    console.group("🔐 [AuthService] Login Request");
    console.log("Credentials:", { email });

    const response = await fetch(`${APP_CONFIG.apiUrl}/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, motDePasse }),
    });

    if (!response.ok) {
      console.error("Erreur Backend Login:", response.status);
      console.groupEnd();
      throw new Error("Identifiants incorrects ou compte inactif");
    }

    const data: LoginResponseBackend = await response.json();
    console.log("📥 Payload Backend Reçu:", data);

    // MAPPING Backend -> Frontend
    const user: User = { 
        id: data.userId, // Mapping userId -> id
        email: data.email, 
        role: data.role,
        nom: data.nom,
        prenom: data.prenom,
        fullName: `${data.prenom} ${data.nom}`
    };

    // Persistence immédiate
    if (typeof window !== "undefined") {
      localStorage.setItem(STORAGE_KEY_TOKEN, data.token);
      localStorage.setItem(STORAGE_KEY_USER, JSON.stringify(user));
      console.log("✅ Token et User stockés en LocalStorage");
    }
    
    console.groupEnd();
    return user;
  },
  
  createRedacteur: async (data: RegisterRequest): Promise<void> => {
    const token = localStorage.getItem(STORAGE_KEY_TOKEN);
    if (!token) throw new Error("Non autorisé");

    const response = await fetch(`${APP_CONFIG.apiUrl}/auth/admin/create-redacteur`, {
      method: "POST",
      headers: { 
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}` 
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) throw new Error("Erreur création rédacteur");
  },

  logout: () => {
    console.log("🚪 [AuthService] Logout triggered");
    if (typeof window !== "undefined") {
      localStorage.removeItem(STORAGE_KEY_TOKEN);
      localStorage.removeItem(STORAGE_KEY_USER);
      // Redirection brute
      window.location.href = "/login";
    }
  },

  // Utilitaires rapides (hors context)
  getToken: (): string | null => {
    if (typeof window !== "undefined") return localStorage.getItem(STORAGE_KEY_TOKEN);
    return null;
  },
  
  getUserFromStorage: (): User | null => {
    if (typeof window !== "undefined") {
      const str = localStorage.getItem(STORAGE_KEY_USER);
      try {
        return str ? JSON.parse(str) : null;
      } catch { return null; }
    }
    return null;
  },
    // 🔥 IMPORTANT: Alias pour la compatibilité avec l'ancien code qui appelle getUser()
  getUser: (): User | null => {
    return authService.getUserFromStorage();
  }
};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\services\article.ts
================================================================================

// FICHIER: services/article.ts - VERSION CORRIGÉE

import { APP_CONFIG } from "@/lib/constant";
import { authService } from "@/services/auth";
import { 
  ArticlePayloadDto, 
  ArticleReadDto, 
  MediaResponseDto, 
  Rubrique,
  validateArticlePayload
} from "@/types/article";

const API_PROXY = APP_CONFIG.apiUrl; 

export const ArticleService = {
  
  // ==========================================
  // MÉDIAS (UPLOAD & GET)
  // ==========================================
  
  /**
   * 1. RECUPÉRER VIA ID
   */
  getMedia: async (id: string | number): Promise<MediaResponseDto> => {
    const token = authService.getToken();
    try {
        console.log(`🔎 [ArticleService] getMedia demandé pour ID: ${id}`);
        const res = await fetch(`${API_PROXY}/media/info/${id}`, {
            headers: token ? { "Authorization": `Bearer ${token}` } : {}
        });

        if (!res.ok) throw new Error("Média introuvable via l'API");
        const data = await res.json();
        
        // Log important pour débogage
        console.log("📥 [ArticleService] Données média brutes:", data);

        return ArticleService._formatMediaResponse(data);
    } catch (error) {
        console.error("❌ Erreur getMedia:", error);
        throw error;
    }
  },

  /**
   * 2. UPLOAD FICHIER
   */
  uploadMedia: async (file: File): Promise<MediaResponseDto> => {
    const token = authService.getToken();
    if (!token) throw new Error("Authentification requise");

    const safeName = encodeURIComponent(file.name);
    // Utilisation des query params pour Swagger
    const endpoint = `${API_PROXY}/media/upload?altText=${safeName}&legende=${safeName}`;
    
    const fd = new FormData();
    fd.append("file", file); // Clé 'file' selon swagger

    console.log(`📤 [ArticleService] Début Upload: ${file.name} (${file.size} bytes)`);

    const res = await fetch(endpoint, {
      method: "POST",
      headers: { "Authorization": `Bearer ${token}` },
      body: fd,
    });

    if (!res.ok) {
      const errorText = await res.text();
      console.error("❌ Echec Upload:", errorText);
      throw new Error(`Erreur serveur (${res.status}): ${errorText}`);
    }
    
    const data = await res.json();
    
    // --- ✅ DEBUG CRUCIAL DEMANDÉ ---
    console.group("✅ UPLOAD REUSSI");
    console.log("📦 Réponse Backend:", data);
    const formatted = ArticleService._formatMediaResponse(data);
    console.log("🔗 URL RECONSTRUITE POUR LE FRONT:", formatted.urlAcces);
    console.groupEnd();

    return formatted;
  },

  /**
   * HELPER: NORMALISE LA RÉPONSE DU BACKEND
   * Construit l'URL absolue utilisable par <Image /> et <img>
   */
  _formatMediaResponse: (data: any): MediaResponseDto => {
    // 1. Détecter l'ID
    let mediaId = data.id;
    // Si c'est une string ID, on tente le parsing INT si possible, sinon on garde String
    // Ton ArticleCreateDto veut Int32, mais MediaReadDto a UUID. C'est le point de conflit.
    // On garde l'original 'id' brut du retour média ici.

    // 2. Construction de l'URL absolue (Priorité absolue !)
    let finalUrl = "";

    // CAS A: Backend renvoie déjà une URL complète (ex: http://...)
    if (data.urlAcces && data.urlAcces.startsWith('http')) {
        finalUrl = data.urlAcces;
    }
    // CAS B: Backend renvoie un chemin relatif (ex: /uploads/...)
    // => On le préfixe avec l'adresse du backend (194.163.175.53:8080)
    else if (data.urlAcces && data.urlAcces.startsWith('/')) {
        finalUrl = `${APP_CONFIG.backendUrl}${data.urlAcces}`;
    }
    // CAS C: Backend ne renvoie que le hash/filename, pas d'urlAcces
    else if (data.fileName || data.hashSha256) {
        // Selon swagger: GET /api/v1/media/file/{filename} ou /uploads/{filename}
        const identifier = data.fileName || data.hashSha256;
        finalUrl = `${APP_CONFIG.mediaBaseUrl}${identifier}`; 
    }
    else {
        // Fallback: Si rien ne va
        finalUrl = "/images/image4.jpeg";
    }

    return {
      id: mediaId,
      urlAcces: finalUrl,
      nomOriginal: data.nomOriginal || "media-sans-nom",
      typeMime: data.typeMime || "image/jpeg",
      hashSha256: data.hashSha256
    };
  },


  // === CRÉATION ARTICLE ===
  create: async (payload: ArticlePayloadDto): Promise<ArticleReadDto> => {
    const token = authService.getToken();
    if (!token) throw new Error("Non authentifié");

    // Validation
    const errors = validateArticlePayload(payload);
    if (errors.length > 0) throw new Error(errors[0]);

    // ✅ NETTOYAGE CRITIQUE DU PAYLOAD
    // Pour éviter les erreurs 400 Bad Request JSON
    const cleanPayload = {
      titre: payload.titre,
      description: payload.description,
      rubriqueId: payload.rubriqueId,
      auteurId: payload.auteurId,
      // Pour l'instant on force null si pas défini (évite mismatch Int/UUID)
      // Si votre Swagger dit Int pour coverImageId mais que le media est UUID, 
      // il faut soit mettre null, soit le backend doit être corrigé. On met null pour que ça passe.
      imageCouvertureId: payload.imageCouvertureId || null, 
      region: payload.region,
      visible: false,
      statut: payload.statut,
      tagIds: payload.tagIds || [],
      datePublication: payload.datePublication || null, // null pour DRAFT

      // MAPPING BLOCS
      blocsContenu: payload.blocsContenu.map((b, idx) => ({
        type: b.type,
        contenu: b.contenu || "",
        ordre: idx, // Force l'ordre séquentiel
        legende: b.legende || "",
        altText: b.altText || "",
        url: b.url || "",
        // 🔴 Correction Majeure : "0" -> null pour les UUID
        mediaId: (b.mediaId && b.mediaId !== "0") ? b.mediaId : null,
        articleId: 0 // Requis par certaines Logiques DTO
      }))
    };

    const res = await fetch(`${APP_CONFIG.apiUrl}/articles`, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json", 
        "Authorization": `Bearer ${token}` 
      },
      body: JSON.stringify(cleanPayload)
    });

    if (!res.ok) {
        const txt = await res.text();
        console.error("Backend Refusal:", txt);
        throw new Error(`Erreur Création (${res.status}): ${txt}`);
    }
    
    return await res.json();
  },

  // === MODIFICATION ===
  update: async (id: number, payload: ArticlePayloadDto): Promise<ArticleReadDto> => {
    const token = authService.getToken();
    
    // Payload cleaning similaire au Create
    const cleanPayload = {
      ...payload,
      imageCouvertureId: payload.imageCouvertureId ? Number(payload.imageCouvertureId) : null,
      blocsContenu: payload.blocsContenu.map((b, idx) => ({
        ...b,
        ordre: idx,
        mediaId: (b.mediaId && b.mediaId !== "0") ? String(b.mediaId) : null,
        articleId: id 
      }))
    };
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
      body: JSON.stringify(cleanPayload)
    });

    if (res.status === 204) return ArticleService.getById(id);
    if (!res.ok) throw new Error("Erreur modification");
    return await res.json();
  },

  // ==========================================
  // LECTURE ARTICLE
  // ==========================================
  
  getById: async (id: number): Promise<ArticleReadDto> => {
    const token = authService.getToken();
    const headers: HeadersInit = token ? { "Authorization": `Bearer ${token}` } : {};
    
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${id}`, { headers });
    
    if (!res.ok) {
      throw new Error(`Article ${id} introuvable`);
    }
    
    return await res.json();
  },

  // ==========================================
  // SOUMISSION POUR VALIDATION
  // ==========================================
  
  submit: async (articleId: number, redacteurId: number): Promise<ArticleReadDto> => {
    return ArticleService.submitForReview(articleId, redacteurId);
  },

  submitForReview: async (articleId: number, redacteurId: number): Promise<ArticleReadDto> => {
    const token = authService.getToken();
    if (!token) throw new Error("Non authentifié");
    
    const res = await fetch(
      `${APP_CONFIG.apiUrl}/redacteur/${redacteurId}/articles/${articleId}/submit`,
      {
        method: "POST",
        headers: { "Authorization": `Bearer ${token}` }
      }
    );
    
    if (!res.ok) {
      throw new Error("Échec soumission pour validation");
    }
    
    return await res.json();
  },

  // ==========================================
  // ACTIONS ADMIN
  // ==========================================
  
  approve: async (id: number): Promise<void> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${id}/approve`, {
      method: "PATCH",
      headers: { 
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json" 
      },
      body: JSON.stringify({})
    });

    if (!res.ok) {
      const error = await res.json().catch(() => ({}));
      throw new Error(error.message || `Erreur approbation ${id}`);
    }
  },

  publish: async (id: number): Promise<void> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${id}/publish`, {
      method: "PATCH",
      headers: { 
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json" 
      },
      body: JSON.stringify({})
    });
    
    if (!res.ok) {
      throw new Error("Erreur publication");
    }
  },

  reject: async (id: number, motif: string): Promise<void> => {
    const token = authService.getToken();
    const endpoint = `${APP_CONFIG.apiUrl}/articles/${id}/reject?motif=${encodeURIComponent(motif)}`;
    
    const res = await fetch(endpoint, {
      method: "PATCH",
      headers: { "Authorization": `Bearer ${token}` }
    });
    
    if (!res.ok) {
      throw new Error("Échec du rejet");
    }
  },

  archive: async (id: number): Promise<void> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${id}/archive`, {
      method: "PATCH",
      headers: { "Authorization": `Bearer ${token}` }
    });
    
    if (!res.ok) {
      throw new Error("Échec archivage");
    }
  },

  delete: async (id: number): Promise<void> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${id}`, {
      method: "DELETE",
      headers: { "Authorization": `Bearer ${token}` }
    });
    
    if (!res.ok) {
      throw new Error("Suppression impossible");
    }
  },

  // ==========================================
  // RUBRIQUES
  // ==========================================
  
  getRubriquesTree: async (): Promise<Rubrique[]> => {
    try {
      const res = await fetch(`${APP_CONFIG.apiUrl}/rubriques`);
      return res.ok ? await res.json() : [];
    } catch {
      return [];
    }
  },
  
  createRubrique: async (nom: string) => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/rubriques`, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json", 
        "Authorization": `Bearer ${token}` 
      },
      body: JSON.stringify({ nom, visible: true })
    });
    
    return res.ok ? await res.json() : null;
  },

  // ==========================================
  // LISTES RÉDACTEUR
  // ==========================================
  
// DANS : services/article.ts

getRedacteurBrouillons: async (redacteurId: number): Promise<ArticleReadDto[]> => {
    const token = authService.getToken();
    if (!token) throw new Error("Authentification requise pour voir les brouillons");

    try {
        const response = await fetch(
            `${APP_CONFIG.apiUrl}/redacteur/${redacteurId}/articles/brouillons`,
            {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                }
            }
        );

        if (!response.ok) {
            // On peut loguer l'erreur mais on ne throw pas forcément pour ne pas casser l'UI
            console.warn(`Erreur récupération brouillons: ${response.status}`);
            return [];
        }

        const data = await response.json();
        
        // Sécurité : S'assurer que c'est bien un tableau
        return Array.isArray(data) ? data : [];
        
    } catch (error) {
        console.error("❌ Erreur réseau brouillons:", error);
        return [];
    }
},

  getRedacteurPublies: async (redacteurId: number): Promise<ArticleReadDto[]> => {
    const token = authService.getToken();
    const res = await fetch(
      `${APP_CONFIG.apiUrl}/redacteur/${redacteurId}/articles/publies`,
      { headers: { "Authorization": `Bearer ${token}` } }
    );
    
    return res.ok ? await res.json() : [];
  },

  getRedacteurTousArticles: async (redacteurId: number, page = 0, size = 50): Promise<any> => {
    const token = authService.getToken();
    const res = await fetch(
      `${APP_CONFIG.apiUrl}/redacteur/${redacteurId}/articles?page=${page}&size=${size}&sort=updatedAt,desc`,
      { headers: { "Authorization": `Bearer ${token}` } }
    );
    
    return res.ok ? await res.json() : { content: [] };
  },

  // ==========================================
  // LISTES ADMIN
  // ==========================================
  
  getArticlesByStatus: async (status: string, page = 0, size = 20): Promise<any> => {
    const token = authService.getToken();
    const res = await fetch(
      `${APP_CONFIG.apiUrl}/articles/by-status/${status}?page=${page}&size=${size}&sort=updatedAt,desc`,
      { headers: { "Authorization": `Bearer ${token}` } }
    );
    
    if (!res.ok) {
      throw new Error("Erreur chargement liste admin");
    }
    
    return await res.json();
  },

  getAllRedacteurs: async (): Promise<any[]> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/utilisateurs/redacteurs`, {
      headers: { "Authorization": `Bearer ${token}` }
    });
    
    return res.ok ? await res.json() : [];
  },

  getAllUsers: async (): Promise<any[]> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/utilisateurs/all`, {
      headers: { "Authorization": `Bearer ${token}` }
    });
    
    return res.ok ? await res.json() : [];
  },

  getAuthorStats: async (authorId: number): Promise<any> => {
    const token = authService.getToken();
    try {
      const res = await fetch(
        `${APP_CONFIG.apiUrl}/articles/author/${authorId}/stats`,
        { headers: { "Authorization": `Bearer ${token}` } }
      );
      
      return res.ok ? await res.json() : null;
    } catch {
      return null;
    }
  },
    /**
   * ✅ PUBLICATION AVANCÉE
   */
  publishAdvanced: async (id: number, config: ArticlePublicationDto): Promise<void> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${id}/publish-advanced`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify(config)
    });

    if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.message || "Erreur lors de la publication avancée");
    }
  },

  /**
   * ✅ MODE AVANT-PREMIÈRE
   */
  setPreviewMode: async (id: number, config: { dateFinAvantPremiere?: string, accessRestreint?: boolean }) => {
      const token = authService.getToken();
      await fetch(`${APP_CONFIG.apiUrl}/articles/${id}/set-preview`, {
          method: "PATCH",
          headers: { 
              "Content-Type": "application/json", 
              "Authorization": `Bearer ${token}` 
          },
          body: JSON.stringify(config)
      });
  },
    /**
   * ✅ GESTION DES TAGS (NEW)
   */
  
  // Assigner des tags (string[]) à un article
  assignTags: async (articleId: number, tags: string[]): Promise<void> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/tags/article/${articleId}`, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}` 
      },
      body: JSON.stringify(tags)
    });
    if (!res.ok) throw new Error("Erreur assignation tags");
  },

  // Déclencher l'Auto-Tagging par l'IA
  generateAutoTags: async (articleId: number): Promise<string[]> => {
    const token = authService.getToken();
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${articleId}/auto-tag`, {
      method: "POST",
      headers: { "Authorization": `Bearer ${token}` }
    });
    if (!res.ok) throw new Error("Erreur génération auto-tags");
    return await res.json();
  },

  // Récupérer les tags d'un article (utile pour recharger en mode édition)
  getArticleTags: async (articleId: number): Promise<any[]> => {
     try {
         const token = authService.getToken();
         const res = await fetch(`${APP_CONFIG.apiUrl}/tags/article/${articleId}`, {
             headers: { "Authorization": `Bearer ${token}` }
         });
         return res.ok ? await res.json() : [];
     } catch { return []; }
  }
};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\services\api.ts
================================================================================

import axios from 'axios';
import { APP_CONFIG } from "@/lib/constant"; // Import de la config unifiée

// ✅ Utilise l'URL relative configurée (/api/proxy)
const api = axios.create({
  baseURL: APP_CONFIG.apiUrl,
});

api.interceptors.request.use(
  (config) => {
    // Note: Stockage token cohérent avec services/auth.ts
    // Assure-toi que la clé est bien 'tody_jwt_token' partout (auth.ts utilise cette clé)
    if (typeof window !== 'undefined') {
      const token = localStorage.getItem('tody_jwt_token'); 
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
    }
    return config;
  },
  (error) => Promise.reject(error)
);

export default api;


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\services\dashboard.ts
================================================================================

// FICHIER: services/dashboard.ts
import { APP_CONFIG } from "@/lib/constant";
import { authService } from "./auth";
import { ArticleBackend, PageResponse, StatsDashboard } from "@/types/dashboard";

const API_PROXY = APP_CONFIG.apiUrl; 

// --- Endpoints Rédacteur (Nécessite Token) ---
const ENDPOINT_MY_ARTICLES = `${API_PROXY}/articles`; 
const ENDPOINT_STATS = `${API_PROXY}/statistiques/auteur`; // Supposé basé sur ton swagger "statistiquess"

// --- Endpoints Lecteur (Public) ---
const ENDPOINT_PUBLIC_FEATURED = `${API_PROXY}/featureditems`;
const ENDPOINT_PUBLIC_LIST = `${API_PROXY}/public/articles`;
const ENDPOINT_PUBLIC_SEARCH = `${API_PROXY}/public/articles`; // Search via query param ?q=

export const dashboardService = {

  // ============================
  // ESPACE RÉDACTEUR
  // ============================

  // Récupère les articles du rédacteur connecté (API privée)
  getMyArticles: async (): Promise<ArticleBackend[]> => {
    console.log(`📡 [DASHBOARD] Fetching Mes Articles (Privé)...`);
    const token = authService.getToken();
    
    try {
      // NOTE: Par défaut le backend java "/articles" renvoie la liste filtrée si on n'est pas SUPER_ADMIN
      const res = await fetch(`${ENDPOINT_MY_ARTICLES}?page=0&size=50&sort=dateCreation,desc`, {
        headers: { "Authorization": `Bearer ${token}` }
      });

      if (!res.ok) throw new Error("Echec chargement articles");
      
      const data: PageResponse<ArticleBackend> = await res.json();
      console.log(`✅ [DASHBOARD] ${data.content.length} articles récupérés.`);
      return data.content;
    } catch (e) {
      console.error("❌ [DASHBOARD] Erreur Articles:", e);
      return [];
    }
  },

  // Calcul des stats (puisque l'endpoint global stats n'est pas clair dans le log, on calcule en local pour le MVP)
  getMyStats: async (): Promise<StatsDashboard> => {
    const articles = await dashboardService.getMyArticles();
    
    // Aggrégation locale des données (views, comments)
    const stats = articles.reduce((acc, curr) => ({
      totalArticles: acc.totalArticles + 1,
      totalVues: acc.totalVues + (curr.vues || 0),
      totalCommentaires: acc.totalCommentaires + (curr.commentaires || 0)
    }), { totalArticles: 0, totalVues: 0, totalCommentaires: 0 });

    return stats;
  },

  // ============================
  // ESPACE LECTEUR (PUBLIC)
  // ============================

  getFeaturedArticles: async (section: string = "homepage"): Promise<ArticleBackend[]> => {
    console.log(`📡 [READER] Fetching Featured Articles (${section})...`);
    try {
      const res = await fetch(`${ENDPOINT_PUBLIC_FEATURED}?section=${section}`);
      if (!res.ok) throw new Error("Echec featured");
      const data = await res.json();
      // Swagger dit array
      return Array.isArray(data) ? data : data.content || [];
    } catch (e) {
      console.error("❌ [READER] Erreur Featured:", e);
      return [];
    }
  },

  getAllPublicArticles: async (page = 0, size = 10): Promise<PageResponse<ArticleBackend>> => {
    console.log(`📡 [READER] Fetching All Public Articles (Page ${page})...`);
    try {
      const res = await fetch(`${ENDPOINT_PUBLIC_LIST}?page=${page}&size=${size}`);
      if (!res.ok) throw new Error("Echec public list");
      return await res.json();
    } catch (e) {
      console.error("❌ [READER] Erreur List:", e);
      return { content: [], totalElements: 0, totalPages: 0 };
    }
  },

  searchPublicArticles: async (query: string): Promise<ArticleBackend[]> => {
    // Si l'API utilise ?q= ou un filtre specifique, ajuster ici
    // On suppose une implémentation backend qui filtre
    console.log(`🔎 [READER] Recherche: ${query}`);
    return dashboardService.getFeaturedArticles(); // Fallback si route search pas dispo
  }
};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\services\admin.ts
================================================================================

// services/admin.ts
import { APP_CONFIG } from "@/lib/constant";
import { authService } from "./auth";

const API_BASE = APP_CONFIG.apiUrl; // Utilise /api/proxy

export const AdminService = {
  /**
   * RÉCUPÉRER TOUS LES UTILISATEURS (Lecteurs + Staff)
   * Backend : GET /api/v1/utilisateurs/all
   */
  getAllUsers: async (): Promise<any[]> => {
    const token = authService.getToken();
    try {
      const res = await fetch(`${API_BASE}/utilisateurs/all`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      if (!res.ok) throw new Error("Erreur lors de la récupération des utilisateurs");
      return await res.json();
    } catch (e) {
      console.error(e);
      return [];
    }
  },

  /**
   * RÉCUPÉRER L'ÉQUIPE (Uniquement rôle REDACTEUR ou ADMIN)
   * Backend : GET /api/v1/utilisateurs/redacteurs
   */
  getAllRedacteurs: async (): Promise<any[]> => {
    const token = authService.getToken();
    try {
      const res = await fetch(`${API_BASE}/utilisateurs/redacteurs`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      if (!res.ok) throw new Error("Erreur lors de la récupération des rédacteurs");
      return await res.json();
    } catch (e) {
      console.error(e);
      return [];
    }
  },

  /**
   * STATISTIQUES RÉELLES D'UN RÉDACTEUR
   * Backend : GET /api/v1/articles/author/{id}/stats
   */
  getAuthorStats: async (authorId: number): Promise<any> => {
    const token = authService.getToken();
    try {
      const res = await fetch(`${API_BASE}/articles/author/${authorId}/stats`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      if (!res.ok) return null;
      return await res.json();
      // Le backend renvoie souvent : { totalArticles: 10, totalVues: 500, etc. }
    } catch (e) {
      return null;
    }
  }
};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\services\public.ts
================================================================================

// FICHIER: services/public.ts
import { APP_CONFIG } from "@/lib/constant";
import { ArticleReadDto, CommentaireDto, Rubrique } from "@/types/article";
import { PageResponse } from "@/types/dashboard";
import { authService } from "./auth";
import { CreateCommentairePayload } from "@/types/article";

const API_PROXY = APP_CONFIG.apiUrl; 

export const PublicService = {
  
  /**
   * Récupère les rubriques (Menus)
   * Route: GET /api/v1/rubriques
   */
  getRubriques: async (): Promise<Rubrique[]> => {
    try {
      // On utilise l'endpoint root pour éviter d'avoir tout l'arbre si on veut juste les parents
      // Sinon /rubriques renvoie tout l'arbre. Le frontend filtre.
      const res = await fetch(`${API_PROXY}/rubriques`);
      if (!res.ok) throw new Error("Erreur fetch rubriques");
      return await res.json();
    } catch (e) {
      console.error("❌ Erreur Rubriques:", e);
      return [];
    }
  },

  /**
   * FLUX ACTUALITÉS (Landing Page & Listes)
   * Route: GET /api/v1/public/articles
   * Note: Retourne uniquement les articles PUBLISHED
   */
  getAllArticles: async (page = 0, size = 6): Promise<PageResponse<ArticleReadDto>> => {
    try {
      const res = await fetch(`${API_PROXY}/public/articles?page=${page}&size=${size}&sort=datePublication,desc`, { 
        cache: 'no-store' 
      });
      if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
      return await res.json();
    } catch (e) {
      console.error("❌ Erreur Flux Public:", e);
      return { content: [], totalElements: 0, totalPages: 0 };
    }
  },

  /**
   * ARTICLES PAR CATÉGORIE
   * Route: GET /api/v1/rubriques/{id}/articles
   * (Plus précis que le filtrage client)
   */
  getArticlesByRubrique: async (id: number): Promise<ArticleReadDto[]> => {
    try {
        const res = await fetch(`${API_PROXY}/rubriques/${id}/articles`); 
        if (!res.ok) return [];
        return await res.json();
    } catch(e) { return []; }
  },
  /**
   * Récupère un article complet avec ses blocs
   */
  getArticleById: async (id: number): Promise<ArticleReadDto | null> => {
    try {
      // Endpoint public. Note : S'assurer que le backend renvoie bien les "blocsContenu" sur ce endpoint public.
      // Sinon, on pourrait avoir besoin d'un endpoint spécifique sans auth.
      const res = await fetch(`${API_PROXY}/public/articles/${id}`, { cache: 'no-store' });
      if (!res.ok) return null;
      return await res.json();
    } catch (e) { 
        console.error("❌ Erreur Article Detail:", e);
        return null; 
    }
  },
  // 1. Incrémenter la vue (Route /api/v1/public/articles/{id}/vue)
  incrementView: async (id: number): Promise<void> => {
    try {
        // Envoi simple d'une vue (duree 0, scroll 0 pour marquer le "hit")
        // La méthode POST attend des query params selon votre Swagger
        await fetch(`${API_PROXY}/public/articles/${id}/vue?dureeVue=1&scrollDepth=10`, {
            method: 'POST'
        });
    } catch (e) {
        console.warn("View tracking failed", e);
    }
  },

  getTrendingArticles: async (): Promise<ArticleReadDto[]> => {
    try {
      // Utilisation d'un endpoint featureditems ou fallback
      const res = await fetch(`${API_PROXY}/featureditems?page=0&size=3`);
      if (!res.ok) {
         // Fallback sur public/articles si endpoint spécifique indispo
         const latest = await PublicService.getAllArticles(0, 3);
         return latest.content;
      }
      const data = await res.json();
      return Array.isArray(data) ? data : data.content || [];
    } catch (e) {
      return []; 
    }
  },
    /**
   * Tracking Analytics (Vue + Scroll)
   */
  trackView: async (id: number, duration: number, scrollDepth: number) => {
      // Mode "fire and forget" pour ne pas bloquer l'UI
      try {
          fetch(`${API_PROXY}/public/articles/${id}/vue?dureeVue=${duration}&scrollDepth=${scrollDepth}`, { 
              method: 'POST',
              headers: { 'Content-Type': 'application/json' }
          }).catch(err => console.warn("Analytics fail silently", err));
      } catch {}
  },
    /**
   * Gestion Favoris (Like/Bookmark) - Nécessite Auth
   */
  toggleFavori: async (userId: number, articleId: number, isCurrentlyFavori: boolean) => {
      const token = authService.getToken();
      if (!token) throw new Error("Connexion requise");

      const method = isCurrentlyFavori ? "DELETE" : "POST";
      const res = await fetch(`${API_PROXY}/user/${userId}/favoris/${articleId}`, {
          method,
          headers: { "Authorization": `Bearer ${token}` }
      });
      
      if (!res.ok) throw new Error("Erreur action favori");
      return !isCurrentlyFavori;
  },

    // 2. Gestion des Commentaires
  getComments: async (articleId: number): Promise<CommentaireDto[]> => {
    try {
        // On récupère tout et on filtre (le backend Java standard)
        // Idéalement : le backend devrait avoir /commentaires/article/{id}
        const res = await fetch(`${API_PROXY}/commentaires/all`);
        if (!res.ok) return [];
        const all: CommentaireDto[] = await res.json();
        // Filtrage client faute d'endpoint dédié visible dans le swagger pour le filtrage
        return all.filter(c => c.articleId === articleId && c.status === 'APPROVED'); 
    } catch {
        return [];
    }
  },

  /**
   * Vérifier statut Favori initial
   */
  checkIsFavori: async (userId: number, articleId: number): Promise<boolean> => {
      const token = authService.getToken();
      if (!token) return false;
      try {
          const res = await fetch(`${API_PROXY}/user/${userId}/favoris`, {
              headers: { "Authorization": `Bearer ${token}` }
          });
          if (!res.ok) return false;
          const favoris: any[] = await res.json();
          return favoris.some(f => f.id === articleId);
      } catch { return false; }
  },

    // 3. Gestion des Likes / Favoris
  toggleLike: async (articleId: number, isCurrentlyLiked: boolean): Promise<void> => {
      const user = authService.getUserFromStorage();
      if (!user) throw new Error("Connectez-vous pour liker");
      const token = authService.getToken();

      if (!isCurrentlyLiked) {
          // Ajouter aux favoris
          await fetch(`${API_PROXY}/user/${user.id}/favoris/${articleId}`, {
              method: 'POST',
              headers: { "Authorization": `Bearer ${token}` }
          });
      } else {
          // Retirer
          await fetch(`${API_PROXY}/user/${user.id}/favoris/${articleId}`, {
              method: 'DELETE',
              headers: { "Authorization": `Bearer ${token}` }
          });
      }
  },

  checkIfLiked: async (articleId: number): Promise<boolean> => {
      const user = authService.getUserFromStorage();
      if (!user) return false;
      const token = authService.getToken();

      try {
          const res = await fetch(`${API_PROXY}/user/${user.id}/favoris`, {
              headers: { "Authorization": `Bearer ${token}` }
          });
          if (!res.ok) return false;
          const favoris: any[] = await res.json();
          // Vérifie si l'article est dans la liste
          return favoris.some((f: any) => f.id === articleId);
      } catch {
          return false;
      }
  },
    // ==========================================
  // LECTURE ARTICLE
  // ==========================================
  
  getById: async (id: number): Promise<ArticleReadDto> => {
    const token = authService.getToken();
    const headers: HeadersInit = token ? { "Authorization": `Bearer ${token}` } : {};
    
    const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${id}`, { headers });
    
    if (!res.ok) {
      throw new Error(`Article ${id} introuvable`);
    }
    
    return await res.json();
  },

  // === ARTICLES ADMIN ===
  getAdminArticles: async (page = 0, size = 10): Promise<PageResponse<ArticleReadDto>> => {
    try {
      const res = await fetch(`${API_PROXY}/articles/by-admin?page=${page}&size=${size}&sort=datePublication,desc`, { cache: 'no-store' });
      if (!res.ok) throw new Error(`Erreur ${res.status}`);
      
      const data = await res.json();
      
      // Si l'API renvoie un tableau simple
      if (Array.isArray(data)) {
         return {
            content: data.slice(0, size),
            totalElements: data.length,
            totalPages: Math.ceil(data.length / size)
         };
      }
      
      return data;
    } catch (e) {
      console.error("❌ Erreur Fetch Admin Articles:", e);
      return { content: [], totalElements: 0, totalPages: 0 };
    }
  },

    /**
   * ✅ TRACKING VUE SOPHISTIQUÉ
   * Enregistre durée + scroll + user
   */
  recordView: async (articleId: number, metrics: { dureeVue: number; scrollDepth: number; userId?: number }) => {
    try {
      const queryParams = new URLSearchParams({
        dureeVue: metrics.dureeVue.toString(),
        scrollDepth: metrics.scrollDepth.toString()
      });
      
      if (metrics.userId) queryParams.append("userId", metrics.userId.toString());

      // Fire and forget (on n'attend pas forcément le résultat pour ne pas bloquer l'UI)
      fetch(`${API_PROXY}/articles/${articleId}/view?${queryParams.toString()}`, {
        method: 'POST'
      }).catch(e => console.warn("Analytics Error", e));
    } catch (e) {
      console.error(e);
    }
  },

  /**
   * ✅ COMMENTAIRES
   */
  getCommentsByArticle: async (articleId: number): Promise<any[]> => {
    try {
      const res = await fetch(`${API_PROXY}/commentaires/article/${articleId}`);
      if (!res.ok) return [];
      const comments = await res.json();
      // On ne retourne que les approuvés pour le public, sauf logique contraire
      return Array.isArray(comments) ? comments.filter((c: any) => c.status === 'APPROVED') : [];
    } catch { return []; }
  },
   /**
   * ✅ Récupère UNIQUEMENT les commentaires approuvés pour l'article
   * GET /api/v1/commentaires/article/{id}/approved
   */
  getApprovedComments: async (articleId: number): Promise<CommentaireDto[]> => {
    try {
      // Si la route "approved" n'existe pas encore, on peut filtrer côté client temporairement
      // mais le document spécifie /approved, donc on l'utilise :
      const res = await fetch(`${API_PROXY}/commentaires/article/${articleId}/approved`);
      
      if (!res.ok) {
         // Fallback sur tous les commentaires si endpoint spécifique manque
         const fallbackRes = await fetch(`${API_PROXY}/commentaires/article/${articleId}`);
         if(!fallbackRes.ok) return [];
         const all: CommentaireDto[] = await fallbackRes.json();
         return all.filter(c => c.status === 'APPROVED');
      }

      return await res.json();
    } catch (e) {
      console.error("Comment fetch error:", e);
      return [];
    }
  },

  /**
   * ✅ Poste un commentaire (crée en statut PENDING)
   * POST /api/v1/commentaires
   */
  postComment: async (payload: CreateCommentairePayload): Promise<CommentaireDto> => {
    const token = authService.getToken();
    // Note: Bien que le backend demande auteurId dans le body, 
    // passer le token est crucial pour que le backend valide l'identité.
    
    const res = await fetch(`${API_PROXY}/commentaires`, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}` 
      },
      body: JSON.stringify(payload),
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.message || "Erreur lors de l'envoi du commentaire");
    }

    return await res.json();
  },
    /**
   * ✅ ARTICLES SIMILAIRES (NEW)
   * GET /api/v1/articles/{id}/similar
   */
  getSimilarArticles: async (articleId: number, limit = 4): Promise<ArticleReadDto[]> => {
    try {
      const res = await fetch(`${APP_CONFIG.apiUrl}/articles/${articleId}/similar?limit=${limit}`);
      if (!res.ok) return [];
      const data = await res.json();
      return Array.isArray(data) ? data : [];
    } catch (e) {
      console.error("Similar fetch error", e);
      return [];
    }
  }

};


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\types\dashboard.ts
================================================================================

// FICHIER: types/dashboard.ts

export interface ArticleBackend {
  id: number; // Swagger dit int32
  titre: string;
  slug?: string;
  description: string;
  imageCouvertureUrl?: string;
  statut: "BROUILLON" | "EN_ATTENTE" | "PUBLIE" | "REJETE";
  datePublication?: string;
  auteurNom?: string;
  vues: number;
  commentaires: number;
  rubriqueNom?: string;
  tags?: string[];
}

export interface StatsDashboard {
  totalArticles: number;
  totalVues: number;
  totalCommentaires: number;
}

export interface PageResponse<T> {
  content: T[];
  totalElements: number;
  totalPages: number;
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\types\article.ts
================================================================================

// FICHIER: types/article.ts - VERSION CORRIGÉE

// ==========================================
// MÉDIAS
// ==========================================
export interface MediaResponseDto {
  id: string | number;
  urlAcces: string;
  nomOriginal: string;
  typeMime: string;
  hashSha256?: string;
}

// ==========================================
// BLOCS DE CONTENU
// ==========================================
// Mise à jour pour inclure VIDEO et AUDIO/FICHIER si nécessaire
export type BlockType = 'TEXTE' | 'IMAGE' | 'VIDEO' | 'CITATION' | 'PDF';

/**
 * DTO pour création/envoi au backend
 * Tous les champs REQUIS par le backend doivent être présents
 */
export interface BlocContenuDto {
  type: BlockType;
  contenu: string;        // Texte HTML ou URL selon type
  ordre: number;
  legende: string;        // Obligatoire (string vide si absent)
  altText: string;        // Obligatoire (string vide si absent)
  url: string;            // Obligatoire (string vide si absent)
  mediaId: string | null;        // Obligatoire (0 si absent)
  articleId: number;      // Obligatoire (0 si absent)
}

/**
 * DTO retourné par le backend (lecture)
 */
export interface BlocContenuReadDto {
  id: number;
  type: BlockType;
  contenu: string;
  ordre: number;
  legende: string;
  altText: string;
  url: string;
  mediaId: string | null;
  articleId: number;
}

// ==========================================
// ARTICLE
// ==========================================

/**
 * Payload strict pour création/modification
 * CONFORME au Swagger et aux attentes du backend
 */
export interface ArticlePayloadDto {
  titre: string;                      // Min 10, Max 200 caractères
  description: string;                // Min 50, Max 500 caractères
  rubriqueId: number;                 // ID de rubrique valide
  auteurId: number;                   // ID auteur connecté
  imageCouvertureId: number | null;   // ID média ou null
  imageCouvertureUrl?: string | null; // Pour le transport front, parfois utile
  region: string;                     // Ex: "GLOBAL", "AFRIQUE_OUEST"
  blocsContenu: BlocContenuDto[];     // Liste de blocs complète
  tagIds: number[];                   // Liste d'IDs (peut être vide [])
  statut: string;                     // "DRAFT", "PENDING_REVIEW", etc.
  visible: boolean;                   // false par défaut
  datePublication?: string | null;    // ISO 8601 ou null
}

/**
 * Article retourné par le backend
 */
export interface ArticleReadDto {
  id: number;
  titre: string;
  slug: string;
  description: string;
  rubriqueNom?: string;
  rubriqueId?: number;
  auteurNom?: string;
  auteurId?: number;
  imageCouvertureUrl?: string | null;
  imageCouvertureId?: number | null;
  blocsContenu: BlocContenuReadDto[];
  tags?: string[];
  statut: string;
  datePublication?: string;
  dateCreation: string;
  dateModification?: string;
  vues?: number;
  telechargements?: number;
  partages?: number;
  commentaires?: number;
  enAvantPremiere?: boolean;
  dateFinAvantPremiere?: string;
  region?: string;
  visible?: boolean;
}

// ==========================================
// RUBRIQUES
// ==========================================
export interface Rubrique {
  id: number;
  nom: string;
  description?: string;
  slug?: string;
  parentId?: number | null;
  ordre?: number;
  icone?: string;
  couleur?: string;
  visible?: boolean;
  status?: string;
  createdAt?: string;
  updatedAt?: string;
  enfants?: Rubrique[];
  nombreArticles?: number;
}

// ==========================================
// HELPERS DE VALIDATION
// ==========================================

// Validation simplifiée
export function validateArticlePayload(payload: ArticlePayloadDto): string[] {
  const errors: string[] = [];
  if (payload.titre.trim().length < 5) errors.push("Titre trop court");
  if (!payload.rubriqueId) errors.push("Rubrique obligatoire");
  if (payload.blocsContenu.length === 0) errors.push("L'article ne peut pas être vide");
  return errors;
}

/**
 * Normalise un bloc avant envoi
 */
export function normalizeBlocContenu(
  bloc: Partial<BlocContenuDto>,
  ordre: number,
  articleId: number
): BlocContenuDto {
  return {
    type: bloc.type || 'TEXTE',
    contenu: bloc.contenu || '',
    ordre: ordre,
    legende: bloc.legende || '',
    altText: bloc.altText || '',
    url: bloc.url || '',
    mediaId: bloc.mediaId || null, // ✅ CORRECTION: Utiliser null
    articleId: articleId || 0
  };
}

// === COMMENTAIRES ===
export interface CommentaireDto {
  id: number;
  contenu: string;
  articleId: number;
  auteurId: number;
  auteurNom?: string; // Peut être null si non joint, à gérer
  dateCreation: string; // ISO String
  dateModification?: string;
  status: 'PENDING' | 'APPROVED' | 'REJECTED' | 'SUSPENDED' | 'DELETED';
  likes?: number;
  parentId?: number | null; // Pour les réponses
  replies?: CommentaireDto[]; // Si le backend groupe, sinon on le fait en front
}

export interface CreateCommentairePayload {
  contenu: string;
  articleId: number;
  auteurId: number;
  parentId?: number | null;
}

export interface PreviewConfigDto {
  dateFinAvantPremiere?: string;
  accessRestreint?: boolean;
}

// === NOUVEAUX DTOs POUR PUBLICATION AVANCÉE ===

export interface ArticlePublicationDto {
  datePublication?: string | null;     // ISO 8601
  enAvantPremiere: boolean;
  dateFinAvantPremiere?: string | null;
  regionsTargetees?: string[];         // ["FR", "BE", "US", etc.]
  notifierAbonnes: boolean;
  messageNotification?: string;
  publierReseauxSociaux: boolean;
  plateformesSociales?: string[];      // ["FACEBOOK", "LINKEDIN", "X"]
  forcerVisibilite: boolean;
}




================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\eslint.config.mjs
================================================================================

import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;



================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\next-env.d.ts
================================================================================

/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.



================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\tsconfig.json
================================================================================

{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}



================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\postcss.config.mjs
================================================================================

const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;



================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\package.json
================================================================================

{
  "name": "tody-africa",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@tiptap/extension-image": "^3.13.0",
    "@tiptap/extension-link": "^3.13.0",
    "@tiptap/extension-placeholder": "^3.13.0",
    "@tiptap/pm": "^3.13.0",
    "@tiptap/react": "^3.13.0",
    "@tiptap/starter-kit": "^3.13.0",
    "axios": "^1.13.2",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "framer-motion": "^12.23.26",
    "lucide-react": "^0.556.0",
    "next": "16.0.8",
    "react": "19.2.1",
    "react-dom": "19.2.1",
    "tailwind-merge": "^3.4.0"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.0.8",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\Dockerfile
================================================================================

# Multi-stage build pour Next.js
FROM node:20-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

# Install dependencies based on the preferred package manager
COPY package.json package-lock.json* ./
RUN npm install

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Build the application
RUN npm run build

# Production image, copy all the files and run next
FROM base AS runner
WORKDIR /app

ENV NODE_ENV=production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public

# Set the correct permission for prerender cache
RUN mkdir .next
RUN chown nextjs:nodejs .next

# Automatically leverage output traces to reduce image size
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

CMD ["node", "server.js"]


================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\README.md
================================================================================

This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.



================================================================================
FICHIER: D:\Projet Business\TODY\tody-africa\next.config.ts
================================================================================

import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  reactStrictMode: false,
  output: 'standalone', 
  images: {
    remotePatterns: [
      { protocol: 'https', hostname: 'images.unsplash.com' },
      { protocol: 'https', hostname: 'totayafrica.onrender.com' },
      { protocol: 'http', hostname: 'localhost' },
      { protocol: 'http', hostname: '194.163.175.53' }, // Autoriser l'IP backend pour les images
    ],
  },
  // ✅ CONFIGURATION DU PROXY CORS
  async rewrites() {
    return [
      {
        source: '/api/proxy/:path*',
        // On mappe vers ton API Backend Java
        destination: 'http://194.163.175.53:8080/api/v1/:path*', 
      },
    ]
  },
};

export default nextConfig;


